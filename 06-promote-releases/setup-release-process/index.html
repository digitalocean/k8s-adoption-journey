<!DOCTYPE html><html class=no-js lang=en> <head><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><meta content="Hands-on tutorial for going from day-1 to production on DigitalOcean Kubernetes." name=description><link href=https://digitalocean.github.io/k8s-adoption-journey/06-promote-releases/setup-release-process/ rel=canonical><link href=../../assets/images/favicon.png rel=icon><meta content="mkdocs-1.4.0, mkdocs-material-8.5.8" name=generator><title>Set up release process - Kubernetes Adoption Journey</title><link href=../../assets/stylesheets/main.20d9efc8.min.css rel=stylesheet><link href=../../assets/stylesheets/palette.815d1a91.min.css rel=stylesheet><link crossorigin href=https://fonts.gstatic.com rel=preconnect><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback" rel=stylesheet><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><link href=../../assets/stylesheets/glightbox.min.css rel=stylesheet><style>
            html.glightbox-open { overflow: initial; height: 100%; }
            .gdesc-inner { font-size: 0.75rem; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            
                .gscrollbar-fixer { padding-right: 15px; }
                </style><script src=../../assets/javascripts/glightbox.min.js></script></head> <body data-md-color-accent data-md-color-primary data-md-color-scheme=default dir=ltr> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input autocomplete=off class=md-toggle data-md-toggle=drawer id=__drawer type=checkbox> <input autocomplete=off class=md-toggle data-md-toggle=search id=__search type=checkbox> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a class=md-skip href=#introduction> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav aria-label=Header class="md-header__inner md-grid"> <a aria-label="Kubernetes Adoption Journey" class="md-header__button md-logo" data-md-component=logo href=../.. title="Kubernetes Adoption Journey"> <img alt=logo src=../../assets/do_logo.png> </a> <label class="md-header__button md-icon" for=__drawer> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Kubernetes Adoption Journey </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Set up release process </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input aria-label="Switch to dark mode" class=md-option data-md-color-accent data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary data-md-color-scheme=default id=__palette_1 name=__palette type=radio> <label class="md-header__button md-icon" for=__palette_2 hidden title="Switch to dark mode"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"></path></svg> </label> <input aria-label="Switch to light mode" class=md-option data-md-color-accent data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary data-md-color-scheme=slate id=__palette_2 name=__palette type=radio> <label class="md-header__button md-icon" for=__palette_1 hidden title="Switch to light mode"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 18a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-2.69L23.31 12 20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69Z"></path></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input aria-label=Search autocapitalize=off autocomplete=off autocorrect=off class=md-search__input data-md-component=search-query name=query placeholder=Search required spellcheck=false type=text> <label class="md-search__icon md-icon" for=__search> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg> </label> <nav aria-label=Search class=md-search__options> <button aria-label=Clear class="md-search__icon md-icon" tabindex=-1 title=Clear type=reset> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a class=md-source data-md-component=source href=https://github.com/digitalocean/k8s-adoption-journey title="Go to repository"> <div class="md-source__icon md-icon"> <svg viewbox="0 0 448 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav aria-label=Navigation class="md-nav md-nav--primary" data-md-level=0> <label class=md-nav__title for=__drawer> <a aria-label="Kubernetes Adoption Journey" class="md-nav__button md-logo" data-md-component=logo href=../.. title="Kubernetes Adoption Journey"> <img alt=logo src=../../assets/do_logo.png> </a> Kubernetes Adoption Journey </label> <div class=md-nav__source> <a class=md-source data-md-component=source href=https://github.com/digitalocean/k8s-adoption-journey title="Go to repository"> <div class="md-source__icon md-icon"> <svg viewbox="0 0 448 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=../..> Intro </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 id=__nav_2 type=checkbox> <label class=md-nav__link for=__nav_2> Getting started <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Getting started" class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Getting started </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../01-getting-started/installing-required-tools/ class=md-nav__link> Installing required tools </a> </li> <li class=md-nav__item> <a href=../../01-getting-started/do-api-auth/ class=md-nav__link> Authenticating with the DigitalOcean API </a> </li> <li class=md-nav__item> <a href=../../01-getting-started/setup-docr/ class=md-nav__link> Set up a Digital Ocean container registry </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_4 id=__nav_2_4 type=checkbox> <label class=md-nav__link for=__nav_2_4> Preparing the demo application <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Preparing the demo application" class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_2_4> <span class="md-nav__icon md-icon"></span> Preparing the demo application </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../01-getting-started/building-and-pushing-docker-images/introduction-and-repository-setup/ class=md-nav__link> Repository setup </a> </li> <li class=md-nav__item> <a href=../../01-getting-started/building-and-pushing-docker-images/building-and-pushing-images-using-docker/ class=md-nav__link> Building and pushing images with Docker </a> </li> <li class=md-nav__item> <a href=../../01-getting-started/building-and-pushing-docker-images/building-and-pushing-images-using-cnb/ class=md-nav__link> Building and pushing images with Cloud Native Buildpacks </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 id=__nav_3 type=checkbox> <label class=md-nav__link for=__nav_3> Development environment <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Development environment" class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Development environment </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../02-development/setup-doks-dev/ class=md-nav__link> Set up Development DOKS </a> </li> <li class=md-nav__item> <a href=../../02-development/tilt-local/ class=md-nav__link> Tilt for local development </a> </li> <li class=md-nav__item> <a href=../../02-development/tilt-remote/ class=md-nav__link> Tilt for remote development </a> </li> <li class=md-nav__item> <a href=../../02-development/setup-ingress-dev/ class=md-nav__link> Set up ingress </a> </li> <li class=md-nav__item> <a href=../../02-development/observability-dev/ class=md-nav__link> Observability </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 id=__nav_4 type=checkbox> <label class=md-nav__link for=__nav_4> Staging environment <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Staging environment" class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Staging environment </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../03-staging/setup-doks-staging/ class=md-nav__link> Set up Staging DOKS </a> </li> <li class=md-nav__item> <a href=../../03-staging/deploying-the-online-boutique-sample-application-staging/ class=md-nav__link> Deploying the online boutique sample application </a> </li> <li class=md-nav__item> <a href=../../03-staging/setup-ingress-staging/ class=md-nav__link> Set up ingress </a> </li> <li class=md-nav__item> <a href=../../03-staging/observability-staging/ class=md-nav__link> Observability </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 id=__nav_5 type=checkbox> <label class=md-nav__link for=__nav_5> Production environment <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Production environment" class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Production environment </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../04-production/setup-doks-production/ class=md-nav__link> Set up Production DOKS </a> </li> <li class=md-nav__item> <a href=../../04-production/deploying-the-online-boutique-sample-application-production/ class=md-nav__link> Deploying the online boutique sample application </a> </li> <li class=md-nav__item> <a href=../../04-production/setup-ingress-production/ class=md-nav__link> Set up ingress </a> </li> <li class=md-nav__item> <a href=../../04-production/observability-production/ class=md-nav__link> Observability </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6 id=__nav_6 type=checkbox> <label class=md-nav__link for=__nav_6> Continuous integration and deployments <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Continuous integration and deployments" class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Continuous integration and deployments </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../05-ci-cd/setup-continuous-integration/ class=md-nav__link> Set up continuous integration </a> </li> <li class=md-nav__item> <a href=../../05-ci-cd/setup-continuous-deployments/ class=md-nav__link> Set up continuous deployments </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input checked class="md-nav__toggle md-toggle" data-md-toggle=__nav_7 id=__nav_7 type=checkbox> <label class=md-nav__link for=__nav_7> Promote releases <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Promote releases" class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Promote releases </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc id=__toc type=checkbox> <label class="md-nav__link md-nav__link--active" for=__toc> Set up release process <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Set up release process </a> <nav aria-label="Table of contents" class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=#introduction> Introduction </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#prerequisites> Prerequisites </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#managing-application-releases> Managing Application Releases </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#setting-up-the-release-process-github-workflow> Setting Up the Release Process GitHub Workflow </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#releasing-a-new-version-for-the-online-boutique-application> Releasing a New Version for the Online Boutique Application </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#reverting-a-bad-release> Reverting a Bad Release </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../promote-releases-to-upper-envs/ class=md-nav__link> Promote releases to upper environments </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_8 id=__nav_8 type=checkbox> <label class=md-nav__link for=__nav_8> Security <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Security class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> Security </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../07-security/software-supply-chain/ class=md-nav__link> Securing the software supply chain </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav aria-label="Table of contents" class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=#introduction> Introduction </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#prerequisites> Prerequisites </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#managing-application-releases> Managing Application Releases </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#setting-up-the-release-process-github-workflow> Setting Up the Release Process GitHub Workflow </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#releasing-a-new-version-for-the-online-boutique-application> Releasing a New Version for the Online Boutique Application </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#reverting-a-bad-release> Reverting a Bad Release </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a class="md-content__button md-icon" href=https://github.com/digitalocean/k8s-adoption-journey/edit/master/docs/06-promote-releases/setup-release-process.md title="Edit this page"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"></path></svg> </a> <h1>Set up release process</h1> <h2 id=introduction>Introduction</h2> <p>Releasing a new version for a project is a separate process, and it is usually triggered manually by a release engineer (or project owner). GitHub offers the possibility to create and manage releases via the web interface in a very straightforward manner.</p> <p>GitHub helps you in the release process with creating new tags, generating changelogs, and packing application assets for the specific version. Next, after a new version of the application is released, a dedicated GitHub workflow runs which builds and tags application artifacts. Optionally, trigger a rollout for the new application version in the staging environment.</p> <p>Depending on your setup (as well as internal policies), the staging environment is set to automatically receive new application versions or not. In general, it's safe to automatically deploy a new release to the staging environment. The staging environment acts as a buffer between the development environment and the final production stage. This environment is used by QA teams to perform additional testing, and in some cases is shared with your customers to check pre-releases or new features before releasing the final product.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>This guide enables <strong>automated deployments</strong> for <strong>staging environment</strong> on each release.</p> </div> <h2 id=prerequisites>Prerequisites</h2> <p>To complete this section you will need:</p> <ol> <li>A container registry already set up as explained in the <a href=../../01-getting-started/setup-docr/ >Getting Started -&gt; Set up DOCR</a> section.</li> <li>A DOKS cluster set up and running for the <a href=../../03-staging/setup-doks-staging/ >staging environment</a>.</li> <li>The <code>microservices-demo</code> GitHub repository already prepared as explained in the <a href=../../01-getting-started/building-and-pushing-docker-images/introduction-and-repository-setup/ >Preparing demo application GitHub repository</a> section.</li> <li>Your <a href=../../01-getting-started/do-api-auth/ >DigitalOcean authentication token</a> stored as a GitHub secret named <code>DIGITALOCEAN_ACCESS_TOKEN</code> in the <code>microservices-demo</code> repository. Follow <a href=https://docs.github.com/en/actions/security-guides/encrypted-secrets#creating-encrypted-secrets-for-a-repository>this guide</a> to learn more about creating GitHub secrets.</li> </ol> <h2 id=managing-application-releases>Managing Application Releases</h2> <p>The release process is pretty straightforward, and follows below rules:</p> <ol> <li><a href=https://semver.org/ >Semantic versioning</a> is used to distinguish between each release. First version starts at <code>v1.0.0</code>.</li> <li>On each release, application version is increased by a <code>single value</code>. For example if previous application version was <code>v1.0.0</code>, new version will be <code>v1.0.1</code>, and so on.</li> <li>A corresponding <code>git tag</code> is created on each release. Git tags help you identify changes introduced by a specific version in time. Put it other way, you get a snapshot for a set of application changes in time. Also, in case something goes wrong you should be able to rollback easily to previous application version.</li> <li>A dedicated workflow runs on each git tag event. Main purpose is to build and push project images tagged with the release version. Optionally, it can push new application version to the staging environment.</li> </ol> <div class="admonition note"> <p class=admonition-title>Note</p> <p>This guide (and associated examples) uses a simple release process which doesn't cover release candidates, beta releases, hotfixes or other advanced strategies.</p> </div> <p>Releasing a new version for the online boutique sample application consists of:</p> <ol> <li>Create a new GitHub release using the web interface:<ul> <li>Tag the new release based on semantic versioning (e.g. v1.0.0).</li> <li>Generate release changelog.</li> </ul> </li> <li>Automatically trigger the release GitHub workflow which does the following:<ul> <li>Checks the latest release tag and corresponding version.</li> <li>Builds and tags images for application components.</li> <li>Pushes release artifacts to registry (docker images).</li> </ul> </li> <li>Optionally, push new release version to staging environment.</li> </ol> <p>The release process flow is depicted below:</p> <pre class=mermaid><code>graph TD
A(Create New GitHub Release) -- Trigger --&gt; B(Release GitHub Workflow)
B --&gt; C(Release Validation Tests)
C --&gt; D{Tests Passing?}
D -- No --&gt; E(Reject release)
D -- Yes --&gt; F(Build and Push Release Images)
F --&gt; G(Kustomize Staging Env Images Tag)
G --&gt; H(Commit Kustomize Changes)
H -. Trigger .-&gt; I(Argo CD Staging Sync)
style I stroke-dasharray: 5 5</code></pre> <p>Next, you will learn how to configure and enable the GitHub workflow which automatically triggers on each application release.</p> <h2 id=setting-up-the-release-process-github-workflow>Setting Up the Release Process GitHub Workflow</h2> <p>Before jumping to a real world example, the GitHub workflow associated with the release process needs to be configured. The workflow is automatically triggered whenever a new Git tag is created using the following naming convention - <strong><code>v[MAJOR].[MINOR].[PATCH]</code></strong>.</p> <p>Follow below steps to perform enable the release workflow:</p> <ol> <li> <p>Clone the <code>microservices-demo</code> repository on your local machine, if not already (make sure to replace the <code>&lt;&gt;</code> placeholders accordingly):</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-0-1 id=__codelineno-0-1 name=__codelineno-0-1></a>git clone https://github.com/&lt;YOUR_GITHUB_ACCOUNT_USERNAME&gt;/microservices-demo.git
</code></pre></div> </li> <li> <p>Change directory to your local copy:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-1-1 id=__codelineno-1-1 name=__codelineno-1-1></a><span class=nb>cd</span> microservices-demo
</code></pre></div> </li> <li> <p>Fetch the <code>online-boutique-release.yaml</code> workflow file from the <a href=https://github.com/digitalocean/kubernetes-sample-apps>kubernetes-sample-apps</a> repo:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-2-1 id=__codelineno-2-1 name=__codelineno-2-1></a>curl https://raw.githubusercontent.com/digitalocean/kubernetes-sample-apps/master/.github/workflows/online-boutique-release.yaml <span class=se>\</span>
<a href=#__codelineno-2-2 id=__codelineno-2-2 name=__codelineno-2-2></a>  -o .github/workflows/online-boutique-release.yaml <span class=se>\</span>
<a href=#__codelineno-2-3 id=__codelineno-2-3 name=__codelineno-2-3></a>  --create-dirs
</code></pre></div> </li> <li> <p>Edit the <code>.github/workflows/online-boutique-release.yaml</code> file using a text editor of your choice, preferably with YAML lint support. For example, you can use <a href=https://code.visualstudio.com/ >VS Code</a>:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-3-1 id=__codelineno-3-1 name=__codelineno-3-1></a>code .github/workflows/online-boutique-release.yaml
</code></pre></div> </li> <li> <p>Uncomment the lines prefixed with a hash mark at the top of the workflow file. The resulting file should look like:</p> <details class=note> <summary>Click to expand the <code>Online Boutique Release</code> workflow file</summary> <div class=highlight><pre><span></span><code><a href=#__codelineno-4-1 id=__codelineno-4-1 name=__codelineno-4-1></a><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Online Boutique Release</span><span class=w></span>
<a href=#__codelineno-4-2 id=__codelineno-4-2 name=__codelineno-4-2></a>
<a href=#__codelineno-4-3 id=__codelineno-4-3 name=__codelineno-4-3></a><span class=nt>on</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-4 id=__codelineno-4-4 name=__codelineno-4-4></a><span class=w>  </span><span class=nt>workflow_dispatch</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-5 id=__codelineno-4-5 name=__codelineno-4-5></a><span class=w>  </span><span class=nt>push</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-6 id=__codelineno-4-6 name=__codelineno-4-6></a><span class=w>    </span><span class=c1># Trigger on push events to any tag matching semantic versioning</span><span class=w></span>
<a href=#__codelineno-4-7 id=__codelineno-4-7 name=__codelineno-4-7></a><span class=w>    </span><span class=nt>tags</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-8 id=__codelineno-4-8 name=__codelineno-4-8></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>'v[0-9]+\.[0-9]+\.[0-9]+'</span><span class=w></span>
<a href=#__codelineno-4-9 id=__codelineno-4-9 name=__codelineno-4-9></a>
<a href=#__codelineno-4-10 id=__codelineno-4-10 name=__codelineno-4-10></a><span class=nt>env</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-11 id=__codelineno-4-11 name=__codelineno-4-11></a><span class=w>  </span><span class=nt>RELEASE_COMMIT_AUTHOR</span><span class=p>:</span><span class=w> </span><span class=s>"GitHub</span><span class=nv> </span><span class=s>Release</span><span class=nv> </span><span class=s>Actions"</span><span class=w></span>
<a href=#__codelineno-4-12 id=__codelineno-4-12 name=__codelineno-4-12></a><span class=w>  </span><span class=nt>RELEASE_COMMIT_AUTHOR_EMAIL</span><span class=p>:</span><span class=w> </span><span class=s>"gh-release-actions@noreply.github.com"</span><span class=w></span>
<a href=#__codelineno-4-13 id=__codelineno-4-13 name=__codelineno-4-13></a><span class=w>  </span><span class=nt>DOCR_ENDPOINT</span><span class=p>:</span><span class=w> </span><span class=s>"registry.digitalocean.com/microservices-demo"</span><span class=w></span>
<a href=#__codelineno-4-14 id=__codelineno-4-14 name=__codelineno-4-14></a><span class=w>  </span><span class=nt>PROJECT_NAME</span><span class=p>:</span><span class=w> </span><span class=s>"online-boutique"</span><span class=w></span>
<a href=#__codelineno-4-15 id=__codelineno-4-15 name=__codelineno-4-15></a>
<a href=#__codelineno-4-16 id=__codelineno-4-16 name=__codelineno-4-16></a><span class=nt>jobs</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-17 id=__codelineno-4-17 name=__codelineno-4-17></a><span class=w>  </span><span class=nt>validation-tests</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-18 id=__codelineno-4-18 name=__codelineno-4-18></a><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span><span class=w></span>
<a href=#__codelineno-4-19 id=__codelineno-4-19 name=__codelineno-4-19></a><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-20 id=__codelineno-4-20 name=__codelineno-4-20></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">echo "[INFO] Not implemented yet!"</span><span class=w></span>
<a href=#__codelineno-4-21 id=__codelineno-4-21 name=__codelineno-4-21></a>
<a href=#__codelineno-4-22 id=__codelineno-4-22 name=__codelineno-4-22></a><span class=w>  </span><span class=nt>build-and-push-release-images</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-23 id=__codelineno-4-23 name=__codelineno-4-23></a><span class=w>    </span><span class=nt>needs</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">validation-tests</span><span class=w></span>
<a href=#__codelineno-4-24 id=__codelineno-4-24 name=__codelineno-4-24></a><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span><span class=w></span>
<a href=#__codelineno-4-25 id=__codelineno-4-25 name=__codelineno-4-25></a><span class=w>    </span><span class=nt>strategy</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-26 id=__codelineno-4-26 name=__codelineno-4-26></a><span class=w>      </span><span class=nt>matrix</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-27 id=__codelineno-4-27 name=__codelineno-4-27></a><span class=w>        </span><span class=nt>project</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-28 id=__codelineno-4-28 name=__codelineno-4-28></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">cartservice</span><span class=w></span>
<a href=#__codelineno-4-29 id=__codelineno-4-29 name=__codelineno-4-29></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">checkoutservice</span><span class=w></span>
<a href=#__codelineno-4-30 id=__codelineno-4-30 name=__codelineno-4-30></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">currencyservice</span><span class=w></span>
<a href=#__codelineno-4-31 id=__codelineno-4-31 name=__codelineno-4-31></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">emailservice</span><span class=w></span>
<a href=#__codelineno-4-32 id=__codelineno-4-32 name=__codelineno-4-32></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">frontend</span><span class=w></span>
<a href=#__codelineno-4-33 id=__codelineno-4-33 name=__codelineno-4-33></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">paymentservice</span><span class=w></span>
<a href=#__codelineno-4-34 id=__codelineno-4-34 name=__codelineno-4-34></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">productcatalogservice</span><span class=w></span>
<a href=#__codelineno-4-35 id=__codelineno-4-35 name=__codelineno-4-35></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">recommendationservice</span><span class=w></span>
<a href=#__codelineno-4-36 id=__codelineno-4-36 name=__codelineno-4-36></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">shippingservice</span><span class=w></span>
<a href=#__codelineno-4-37 id=__codelineno-4-37 name=__codelineno-4-37></a><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-38 id=__codelineno-4-38 name=__codelineno-4-38></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Checkout code</span><span class=w></span>
<a href=#__codelineno-4-39 id=__codelineno-4-39 name=__codelineno-4-39></a><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span><span class=w></span>
<a href=#__codelineno-4-40 id=__codelineno-4-40 name=__codelineno-4-40></a>
<a href=#__codelineno-4-41 id=__codelineno-4-41 name=__codelineno-4-41></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Install doctl</span><span class=w></span>
<a href=#__codelineno-4-42 id=__codelineno-4-42 name=__codelineno-4-42></a><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">digitalocean/action-doctl@v2</span><span class=w></span>
<a href=#__codelineno-4-43 id=__codelineno-4-43 name=__codelineno-4-43></a><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-44 id=__codelineno-4-44 name=__codelineno-4-44></a><span class=w>          </span><span class=nt>token</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.DIGITALOCEAN_ACCESS_TOKEN }}</span><span class=w></span>
<a href=#__codelineno-4-45 id=__codelineno-4-45 name=__codelineno-4-45></a>
<a href=#__codelineno-4-46 id=__codelineno-4-46 name=__codelineno-4-46></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Log in to DOCR with short-lived credentials</span><span class=w></span>
<a href=#__codelineno-4-47 id=__codelineno-4-47 name=__codelineno-4-47></a><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">doctl registry login --expiry-seconds 600</span><span class=w></span>
<a href=#__codelineno-4-48 id=__codelineno-4-48 name=__codelineno-4-48></a>
<a href=#__codelineno-4-49 id=__codelineno-4-49 name=__codelineno-4-49></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Build and push image</span><span class=w></span>
<a href=#__codelineno-4-50 id=__codelineno-4-50 name=__codelineno-4-50></a><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">docker/build-push-action@v3</span><span class=w></span>
<a href=#__codelineno-4-51 id=__codelineno-4-51 name=__codelineno-4-51></a><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-52 id=__codelineno-4-52 name=__codelineno-4-52></a><span class=w>          </span><span class=c1># cartservice is an exception - Dockerfile is placed in src/cartservice/src subfolder</span><span class=w></span>
<a href=#__codelineno-4-53 id=__codelineno-4-53 name=__codelineno-4-53></a><span class=w>          </span><span class=nt>context</span><span class=p>:</span><span class=w> </span><span class=s>"src/${{</span><span class=nv> </span><span class=s>matrix.project</span><span class=nv> </span><span class=s>}}/${{</span><span class=nv> </span><span class=s>matrix.project</span><span class=nv> </span><span class=s>==</span><span class=nv> </span><span class=s>'cartservice'</span><span class=nv> </span><span class=s>&amp;&amp;</span><span class=nv> </span><span class=s>'src'</span><span class=nv> </span><span class=s>||</span><span class=nv> </span><span class=s>''}}"</span><span class=w></span>
<a href=#__codelineno-4-54 id=__codelineno-4-54 name=__codelineno-4-54></a><span class=w>          </span><span class=nt>push</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class=w></span>
<a href=#__codelineno-4-55 id=__codelineno-4-55 name=__codelineno-4-55></a><span class=w>          </span><span class=nt>tags</span><span class=p>:</span><span class=w> </span><span class=s>"${{</span><span class=nv> </span><span class=s>env.DOCR_ENDPOINT</span><span class=nv> </span><span class=s>}}/${{</span><span class=nv> </span><span class=s>matrix.project</span><span class=nv> </span><span class=s>}}:${{</span><span class=nv> </span><span class=s>github.ref_name</span><span class=nv> </span><span class=s>}}"</span><span class=w></span>
<a href=#__codelineno-4-56 id=__codelineno-4-56 name=__codelineno-4-56></a>
<a href=#__codelineno-4-57 id=__codelineno-4-57 name=__codelineno-4-57></a><span class=w>  </span><span class=c1># Kustomize image field for each microservice present in the `src/` dir</span><span class=w></span>
<a href=#__codelineno-4-58 id=__codelineno-4-58 name=__codelineno-4-58></a><span class=w>  </span><span class=c1># Finally, commit changes to main branch and let ArgoCD take over afterwards</span><span class=w></span>
<a href=#__codelineno-4-59 id=__codelineno-4-59 name=__codelineno-4-59></a><span class=w>  </span><span class=nt>apply-kustomize-changes</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-60 id=__codelineno-4-60 name=__codelineno-4-60></a><span class=w>    </span><span class=nt>needs</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">build-and-push-release-images</span><span class=w></span>
<a href=#__codelineno-4-61 id=__codelineno-4-61 name=__codelineno-4-61></a><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span><span class=w></span>
<a href=#__codelineno-4-62 id=__codelineno-4-62 name=__codelineno-4-62></a><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-63 id=__codelineno-4-63 name=__codelineno-4-63></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Checkout code</span><span class=w></span>
<a href=#__codelineno-4-64 id=__codelineno-4-64 name=__codelineno-4-64></a><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span><span class=w></span>
<a href=#__codelineno-4-65 id=__codelineno-4-65 name=__codelineno-4-65></a>
<a href=#__codelineno-4-66 id=__codelineno-4-66 name=__codelineno-4-66></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Set up K8S tools</span><span class=w></span>
<a href=#__codelineno-4-67 id=__codelineno-4-67 name=__codelineno-4-67></a><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">yokawasa/action-setup-kube-tools@v0.8.2</span><span class=w></span>
<a href=#__codelineno-4-68 id=__codelineno-4-68 name=__codelineno-4-68></a><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-69 id=__codelineno-4-69 name=__codelineno-4-69></a><span class=w>          </span><span class=nt>kustomize</span><span class=p>:</span><span class=w> </span><span class=s>"4.5.7"</span><span class=w></span>
<a href=#__codelineno-4-70 id=__codelineno-4-70 name=__codelineno-4-70></a>
<a href=#__codelineno-4-71 id=__codelineno-4-71 name=__codelineno-4-71></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Kustomize staging environment images</span><span class=w></span>
<a href=#__codelineno-4-72 id=__codelineno-4-72 name=__codelineno-4-72></a><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span><span class=w></span>
<a href=#__codelineno-4-73 id=__codelineno-4-73 name=__codelineno-4-73></a><span class=w>          </span><span class=no>for microservice in src/*/; do</span><span class=w></span>
<a href=#__codelineno-4-74 id=__codelineno-4-74 name=__codelineno-4-74></a><span class=w>            </span><span class=no>microservice="$(basename $microservice)"</span><span class=w></span>
<a href=#__codelineno-4-75 id=__codelineno-4-75 name=__codelineno-4-75></a><span class=w>            </span><span class=no>if [[ "$microservice" == "loadgenerator" ]]; then</span><span class=w></span>
<a href=#__codelineno-4-76 id=__codelineno-4-76 name=__codelineno-4-76></a><span class=w>              </span><span class=no>continue</span><span class=w></span>
<a href=#__codelineno-4-77 id=__codelineno-4-77 name=__codelineno-4-77></a><span class=w>            </span><span class=no>fi</span><span class=w></span>
<a href=#__codelineno-4-78 id=__codelineno-4-78 name=__codelineno-4-78></a><span class=w>            </span><span class=no>(</span><span class=w></span>
<a href=#__codelineno-4-79 id=__codelineno-4-79 name=__codelineno-4-79></a><span class=w>              </span><span class=no>cd kustomize/staging/</span><span class=w></span>
<a href=#__codelineno-4-80 id=__codelineno-4-80 name=__codelineno-4-80></a><span class=w>              </span><span class=no>kustomize edit set image $microservice=${{ env.DOCR_ENDPOINT }}/${microservice}:${{ github.ref_name }}</span><span class=w></span>
<a href=#__codelineno-4-81 id=__codelineno-4-81 name=__codelineno-4-81></a><span class=w>            </span><span class=no>)</span><span class=w></span>
<a href=#__codelineno-4-82 id=__codelineno-4-82 name=__codelineno-4-82></a><span class=w>          </span><span class=no>done</span><span class=w></span>
<a href=#__codelineno-4-83 id=__codelineno-4-83 name=__codelineno-4-83></a>
<a href=#__codelineno-4-84 id=__codelineno-4-84 name=__codelineno-4-84></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Commit Kustomize manifests for staging env</span><span class=w></span>
<a href=#__codelineno-4-85 id=__codelineno-4-85 name=__codelineno-4-85></a><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span><span class=w></span>
<a href=#__codelineno-4-86 id=__codelineno-4-86 name=__codelineno-4-86></a><span class=w>          </span><span class=no>git config --global user.name "${{ env.RELEASE_COMMIT_AUTHOR }}"</span><span class=w></span>
<a href=#__codelineno-4-87 id=__codelineno-4-87 name=__codelineno-4-87></a><span class=w>          </span><span class=no>git config --global user.email "${{ env.RELEASE_COMMIT_AUTHOR_EMAIL }}"</span><span class=w></span>
<a href=#__codelineno-4-88 id=__codelineno-4-88 name=__codelineno-4-88></a><span class=w>          </span><span class=no>git add kustomize/staging/</span><span class=w></span>
<a href=#__codelineno-4-89 id=__codelineno-4-89 name=__codelineno-4-89></a><span class=w>          </span><span class=no>git commit -m "[Release] Bump docker images tag to ${{ github.ref_name }}"</span><span class=w></span>
<a href=#__codelineno-4-90 id=__codelineno-4-90 name=__codelineno-4-90></a>
<a href=#__codelineno-4-91 id=__codelineno-4-91 name=__codelineno-4-91></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Push changes</span><span class=w></span>
<a href=#__codelineno-4-92 id=__codelineno-4-92 name=__codelineno-4-92></a><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ad-m/github-push-action@master</span><span class=w></span>
<a href=#__codelineno-4-93 id=__codelineno-4-93 name=__codelineno-4-93></a><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-94 id=__codelineno-4-94 name=__codelineno-4-94></a><span class=w>          </span><span class=nt>github_token</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.GITHUB_TOKEN }}</span><span class=w></span>
</code></pre></div> </details> </li> <li> <p>Save the workflow file, commit, and push changes to your git repository <code>main</code> branch (<strong>you may need to temporarily disable <code>main</code> branch protection first</strong>).</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Depending on your setup, you may want to change the following environment variables at the top of your workflow file: <div class=highlight><pre><span></span><code><a href=#__codelineno-5-1 id=__codelineno-5-1 name=__codelineno-5-1></a><span class=nt>env</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-5-2 id=__codelineno-5-2 name=__codelineno-5-2></a><span class=w>  </span><span class=nt>RELEASE_COMMIT_AUTHOR</span><span class=p>:</span><span class=w> </span><span class=s>"GitHub</span><span class=nv> </span><span class=s>Release</span><span class=nv> </span><span class=s>Actions"</span><span class=w></span>
<a href=#__codelineno-5-3 id=__codelineno-5-3 name=__codelineno-5-3></a><span class=w>  </span><span class=nt>RELEASE_COMMIT_AUTHOR_EMAIL</span><span class=p>:</span><span class=w> </span><span class=s>"gh-release-actions@noreply.github.com"</span><span class=w></span>
<a href=#__codelineno-5-4 id=__codelineno-5-4 name=__codelineno-5-4></a><span class=w>  </span><span class=nt>DOCR_ENDPOINT</span><span class=p>:</span><span class=w> </span><span class=s>"registry.digitalocean.com/&lt;YOUR_REGISTRY_NAME_HERE&gt;"</span><span class=w></span>
</code></pre></div></p> </div> </li> </ol> <p>Explanation for the above configuration:</p> <ul> <li><code>on.push.tags</code> - triggers the <code>Online Boutique Release</code> workflow whenever a push event is detected for the specified list of tags. In this case only tags matching the following regex expression - <code>v[0-9]+\.[0-9]+\.[0-9]+</code> are desired. The regex expression matches any tag name corresponding to the <code>v[MAJOR].[MINOR].[PATCH]</code> convention - e.g. <code>v1.0.0</code>, <code>v1.0.1</code>, and so on.</li> <li><code>env</code> - sets environment variables to use for the whole pipeline. Usually, environment variables control workflow logic.</li> <li><code>jobs</code> - defines list of job to run inside the pipeline such as validation tests, build and push release docker images, apply Kustomize changes, etc.</li> <li><code>steps</code> - list of steps implementing workflow jobs logic.</li> </ul> <p>Next, you will learn how to create a new release version for the online boutique sample application used in this guide.</p> <h2 id=releasing-a-new-version-for-the-online-boutique-application>Releasing a New Version for the Online Boutique Application</h2> <p>In this section, you will learn how to create a new GitHub release using the web interface. GitHub provides a neat UI experience and helps you create and manage releases for your application using a straightforward process.</p> <div class="admonition tip"> <p class=admonition-title>Tip</p> <p>It's best practice to <strong>announce and enforce code freeze</strong> for your repository before each release. This procedure ensures that no changes are pushed to your repository during the release process.</p> <p>You can automate this behavior by setting <strong><code>pull/triage/push/maintain/admin</code></strong> permissions for your GitHub repository via the <strong>REST API</strong>. Bellow snippet allows collaborators to pull code only, thus dissallowing code push to your repository (make sure to replace the <code>&lt;&gt;</code> placeholders first):</p> <div class="tabbed-set tabbed-alternate" data-tabs=1:2><input checked=checked id=__tabbed_1_1 name=__tabbed_1 type=radio><input id=__tabbed_1_2 name=__tabbed_1 type=radio><div class=tabbed-labels><label for=__tabbed_1_1>cURL</label><label for=__tabbed_1_2>GitHub CLI</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><a href=#__codelineno-6-1 id=__codelineno-6-1 name=__codelineno-6-1></a>curl <span class=se>\</span>
<a href=#__codelineno-6-2 id=__codelineno-6-2 name=__codelineno-6-2></a>  -X PUT <span class=se>\</span>
<a href=#__codelineno-6-3 id=__codelineno-6-3 name=__codelineno-6-3></a>  -H <span class=s2>"Accept: application/vnd.github+json"</span> <span class=se>\</span>
<a href=#__codelineno-6-4 id=__codelineno-6-4 name=__codelineno-6-4></a>  -H <span class=s2>"Authorization: Bearer &lt;YOUR_TOKEN&gt;"</span> <span class=se>\</span>
<a href=#__codelineno-6-5 id=__codelineno-6-5 name=__codelineno-6-5></a>  https://api.github.com/repos/&lt;OWNER&gt;/&lt;REPO&gt;/collaborators/&lt;USERNAME&gt; <span class=se>\</span>
<a href=#__codelineno-6-6 id=__codelineno-6-6 name=__codelineno-6-6></a>  -d <span class=s1>'{"permission":"pull"}'</span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><a href=#__codelineno-7-1 id=__codelineno-7-1 name=__codelineno-7-1></a>gh api <span class=se>\</span>
<a href=#__codelineno-7-2 id=__codelineno-7-2 name=__codelineno-7-2></a>  --method PUT <span class=se>\</span>
<a href=#__codelineno-7-3 id=__codelineno-7-3 name=__codelineno-7-3></a>  -H <span class=s2>"Accept: application/vnd.github+json"</span> <span class=se>\</span>
<a href=#__codelineno-7-4 id=__codelineno-7-4 name=__codelineno-7-4></a>  /repos/&lt;OWNER&gt;/&lt;REPO&gt;/collaborators/&lt;USERNAME&gt; <span class=se>\</span>
<a href=#__codelineno-7-5 id=__codelineno-7-5 name=__codelineno-7-5></a>  -f <span class=nv>permission</span><span class=o>=</span><span class=s1>'pull'</span>
</code></pre></div> </div> </div> </div> <p>Find out more by visiting the <a href=https://docs.github.com/en/rest/collaborators/collaborators/ >Collaborators REST API</a> page from the official GitHub documentation website.</p> </div> <p>Follow below steps to create and tag a new release for the sample application used in this guide:</p> <ol> <li>Prepare a few major changes for the application, open and merge required pull requests to commit all changes to your <code>microservices-demo</code> repository.</li> <li>Open a web browser, and navigate to your Github repository hosting the <code>microservices-demo</code> sample application.</li> <li> <p>Open the release wizard by clicking the <code>Create a new release</code> link on the right side:</p> <p><a class=glightbox data-desc-position=bottom data-description data-height=auto data-title data-width=100% href=../assets/images/releases/gh-start-new-release.png><img alt="Start New Release Wizard" src=../assets/images/releases/gh-start-new-release.png></a></p> </li> <li> <p>Complete the <code>Choose a tag</code> input field using <code>v1.0.1</code> for new tag name. Then, click on the <code>Generate release notes</code> button, followed by the <code>Publish release</code> green button down below:</p> <p><a class=glightbox data-desc-position=bottom data-description data-height=auto data-title data-width=100% href=../assets/images/releases/create-new-gh-release-page.png><img alt="Create new GitHub Release Page" src=../assets/images/releases/create-new-gh-release-page.png></a></p> </li> <li> <p>Next, the <a href=#setting-up-the-release-process-github-workflow>Release Process GitHub Workflow</a> configured earlier is triggered. Navigate to the actions tab to see it progressing:</p> <p><a class=glightbox data-desc-position=bottom data-description data-height=auto data-title data-width=100% href=../assets/images/releases/new-release-wf-progress.png><img alt="New Release GitHub Workflow Progress" src=../assets/images/releases/new-release-wf-progress.png></a></p> </li> </ol> <p>If everything goes well, the release process GitHub workflow should finish successfully, and push application images to your DOCR tagged using the <code>v1.0.1</code> release version:</p> <p><a class=glightbox data-desc-position=bottom data-description data-height=auto data-title data-width=100% href=../assets/images/releases/docr_new_release_assets.png><img alt="DOCR - New Release Images" src=../assets/images/releases/docr_new_release_assets.png></a></p> <p>Next, a new commit should be present in your microservices-demo repo with the following signature:</p> <p><a class=glightbox data-desc-position=bottom data-description data-height=auto data-title data-width=100% href=../assets/images/releases/new-release-git-commit.png><img alt="New Release Git Commit Signature" src=../assets/images/releases/new-release-git-commit.png></a></p> <p>Navigate to the respective commit ID, and see what changed - you should see new release version set for all staging env docker images:</p> <p><a class=glightbox data-desc-position=bottom data-description data-height=auto data-title data-width=100% href=../assets/images/releases/new-release-kustomize-changes.png><img alt="New Release Kustomize Images Tag" src=../assets/images/releases/new-release-kustomize-changes.png></a></p> <p>Finally, check if Argo CD synced the new application version to the staging environment. After port-forwarding the Argo web console, you should see new application version deployed to your staging environment automatically.</p> <h2 id=reverting-a-bad-release>Reverting a Bad Release</h2> <p>Reverting a bad release goes the same way as you learned in the <a href=../../05-ci-cd/setup-continuous-deployments/#reverting-bad-application-deployments>Set up continuous deployments -&gt; Reverting bad application deployments</a> chapter.</p> <p>Next, you will learn how to promote releases to the production environment. This is a step performed manually for obvious reasons, discussed in more detail in the respective chapter.</p> </article> </div> </div> </main> <footer class=md-footer> <nav aria-label=Footer class="md-footer__inner md-grid"> <a aria-label="Previous: Set up continuous deployments" class="md-footer__link md-footer__link--prev" href=../../05-ci-cd/setup-continuous-deployments/ rel=prev> <div class="md-footer__button md-icon"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Set up continuous deployments </div> </div> </a> <a aria-label="Next: Promote releases to upper environments" class="md-footer__link md-footer__link--next" href=../promote-releases-to-upper-envs/ rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Promote releases to upper environments </div> </div> <div class="md-footer__button md-icon"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"></path></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> DigitalOcean </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ rel=noopener target=_blank> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script> <script src=../../assets/javascripts/bundle.d6c3db9e.min.js></script> <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom"});})</script></body> </html>