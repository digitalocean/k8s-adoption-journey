<!DOCTYPE html><html class=no-js lang=en> <head><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><meta content="Hands-on tutorial for going from day-1 to production on DigitalOcean Kubernetes." name=description><link href=https://digitalocean.github.io/k8s-adoption-journey/07-security/software-supply-chain/ rel=canonical><link href=../../assets/images/favicon.png rel=icon><meta content="mkdocs-1.4.0, mkdocs-material-8.5.8" name=generator><title>Securing the software supply chain - Kubernetes Adoption Journey</title><link href=../../assets/stylesheets/main.20d9efc8.min.css rel=stylesheet><link href=../../assets/stylesheets/palette.815d1a91.min.css rel=stylesheet><link crossorigin href=https://fonts.gstatic.com rel=preconnect><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback" rel=stylesheet><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><link href=../../assets/stylesheets/glightbox.min.css rel=stylesheet><style>
            html.glightbox-open { overflow: initial; height: 100%; }
            .gdesc-inner { font-size: 0.75rem; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            
                .gscrollbar-fixer { padding-right: 15px; }
                </style><script src=../../assets/javascripts/glightbox.min.js></script></head> <body data-md-color-accent data-md-color-primary data-md-color-scheme=default dir=ltr> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input autocomplete=off class=md-toggle data-md-toggle=drawer id=__drawer type=checkbox> <input autocomplete=off class=md-toggle data-md-toggle=search id=__search type=checkbox> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a class=md-skip href=#introduction> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav aria-label=Header class="md-header__inner md-grid"> <a aria-label="Kubernetes Adoption Journey" class="md-header__button md-logo" data-md-component=logo href=../.. title="Kubernetes Adoption Journey"> <img alt=logo src=../../assets/do_logo.png> </a> <label class="md-header__button md-icon" for=__drawer> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Kubernetes Adoption Journey </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Securing the software supply chain </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input aria-label="Switch to dark mode" class=md-option data-md-color-accent data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary data-md-color-scheme=default id=__palette_1 name=__palette type=radio> <label class="md-header__button md-icon" for=__palette_2 hidden title="Switch to dark mode"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"></path></svg> </label> <input aria-label="Switch to light mode" class=md-option data-md-color-accent data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary data-md-color-scheme=slate id=__palette_2 name=__palette type=radio> <label class="md-header__button md-icon" for=__palette_1 hidden title="Switch to light mode"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 18a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-2.69L23.31 12 20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69Z"></path></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input aria-label=Search autocapitalize=off autocomplete=off autocorrect=off class=md-search__input data-md-component=search-query name=query placeholder=Search required spellcheck=false type=text> <label class="md-search__icon md-icon" for=__search> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg> </label> <nav aria-label=Search class=md-search__options> <button aria-label=Clear class="md-search__icon md-icon" tabindex=-1 title=Clear type=reset> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a class=md-source data-md-component=source href=https://github.com/digitalocean/k8s-adoption-journey title="Go to repository"> <div class="md-source__icon md-icon"> <svg viewbox="0 0 448 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav aria-label=Navigation class="md-nav md-nav--primary" data-md-level=0> <label class=md-nav__title for=__drawer> <a aria-label="Kubernetes Adoption Journey" class="md-nav__button md-logo" data-md-component=logo href=../.. title="Kubernetes Adoption Journey"> <img alt=logo src=../../assets/do_logo.png> </a> Kubernetes Adoption Journey </label> <div class=md-nav__source> <a class=md-source data-md-component=source href=https://github.com/digitalocean/k8s-adoption-journey title="Go to repository"> <div class="md-source__icon md-icon"> <svg viewbox="0 0 448 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=../..> Intro </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 id=__nav_2 type=checkbox> <label class=md-nav__link for=__nav_2> Getting started <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Getting started" class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Getting started </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../01-getting-started/installing-required-tools/ class=md-nav__link> Installing required tools </a> </li> <li class=md-nav__item> <a href=../../01-getting-started/do-api-auth/ class=md-nav__link> Authenticating with the DigitalOcean API </a> </li> <li class=md-nav__item> <a href=../../01-getting-started/setup-docr/ class=md-nav__link> Set up a Digital Ocean container registry </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_4 id=__nav_2_4 type=checkbox> <label class=md-nav__link for=__nav_2_4> Preparing the demo application <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Preparing the demo application" class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_2_4> <span class="md-nav__icon md-icon"></span> Preparing the demo application </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../01-getting-started/building-and-pushing-docker-images/introduction-and-repository-setup/ class=md-nav__link> Repository setup </a> </li> <li class=md-nav__item> <a href=../../01-getting-started/building-and-pushing-docker-images/building-and-pushing-images-using-docker/ class=md-nav__link> Building and pushing images with Docker </a> </li> <li class=md-nav__item> <a href=../../01-getting-started/building-and-pushing-docker-images/building-and-pushing-images-using-cnb/ class=md-nav__link> Building and pushing images with Cloud Native Buildpacks </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 id=__nav_3 type=checkbox> <label class=md-nav__link for=__nav_3> Development environment <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Development environment" class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Development environment </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../02-development/setup-doks-dev/ class=md-nav__link> Set up Development DOKS </a> </li> <li class=md-nav__item> <a href=../../02-development/tilt-local/ class=md-nav__link> Tilt for local development </a> </li> <li class=md-nav__item> <a href=../../02-development/tilt-remote/ class=md-nav__link> Tilt for remote development </a> </li> <li class=md-nav__item> <a href=../../02-development/setup-ingress-dev/ class=md-nav__link> Set up ingress </a> </li> <li class=md-nav__item> <a href=../../02-development/observability-dev/ class=md-nav__link> Observability </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 id=__nav_4 type=checkbox> <label class=md-nav__link for=__nav_4> Staging environment <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Staging environment" class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Staging environment </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../03-staging/setup-doks-staging/ class=md-nav__link> Set up Staging DOKS </a> </li> <li class=md-nav__item> <a href=../../03-staging/deploying-the-online-boutique-sample-application-staging/ class=md-nav__link> Deploying the online boutique sample application </a> </li> <li class=md-nav__item> <a href=../../03-staging/setup-ingress-staging/ class=md-nav__link> Set up ingress </a> </li> <li class=md-nav__item> <a href=../../03-staging/observability-staging/ class=md-nav__link> Observability </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 id=__nav_5 type=checkbox> <label class=md-nav__link for=__nav_5> Production environment <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Production environment" class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Production environment </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../04-production/setup-doks-production/ class=md-nav__link> Set up Production DOKS </a> </li> <li class=md-nav__item> <a href=../../04-production/deploying-the-online-boutique-sample-application-production/ class=md-nav__link> Deploying the online boutique sample application </a> </li> <li class=md-nav__item> <a href=../../04-production/setup-ingress-production/ class=md-nav__link> Set up ingress </a> </li> <li class=md-nav__item> <a href=../../04-production/observability-production/ class=md-nav__link> Observability </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6 id=__nav_6 type=checkbox> <label class=md-nav__link for=__nav_6> Continuous integration and deployments <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Continuous integration and deployments" class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Continuous integration and deployments </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../05-ci-cd/setup-continuous-integration/ class=md-nav__link> Set up continuous integration </a> </li> <li class=md-nav__item> <a href=../../05-ci-cd/setup-continuous-deployments/ class=md-nav__link> Set up continuous deployments </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7 id=__nav_7 type=checkbox> <label class=md-nav__link for=__nav_7> Promote releases <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Promote releases" class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Promote releases </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../06-promote-releases/setup-release-process/ class=md-nav__link> Set up release process </a> </li> <li class=md-nav__item> <a href=../../06-promote-releases/promote-releases-to-upper-envs/ class=md-nav__link> Promote releases to upper environments </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input checked class="md-nav__toggle md-toggle" data-md-toggle=__nav_8 id=__nav_8 type=checkbox> <label class=md-nav__link for=__nav_8> Security <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Security class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> Security </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc id=__toc type=checkbox> <label class="md-nav__link md-nav__link--active" for=__toc> Securing the software supply chain <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Securing the software supply chain </a> <nav aria-label="Table of contents" class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=#introduction> Introduction </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#prerequisites> Prerequisites </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#configuring-snyk-for-ides> Configuring Snyk for IDEs </a> <nav aria-label="Configuring Snyk for IDEs" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#installing-snyk-ide-extension> Installing Snyk IDE Extension </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#scanning-online-boutique-demo-application> Scanning Online Boutique Demo Application </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#configuring-snyk-for-ci-pipelines> Configuring Snyk for CI Pipelines </a> <nav aria-label="Configuring Snyk for CI Pipelines" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#application-source-code-scanning> Application Source Code Scanning </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#iac-manifests-scanning> IAC Manifests Scanning </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#docker-containers-scanning> Docker Containers Scanning </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#testing-the-final-setup> Testing the Final Setup </a> <nav aria-label="Testing the Final Setup" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#inspecting-and-fixing-application-source-code-vulnerabilities> Inspecting and Fixing Application Source Code Vulnerabilities </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#inspecting-and-fixing-iac-vulnerabilities> Inspecting and Fixing IAC Vulnerabilities </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#inspecting-and-fixing-docker-containers-vulnerabilities> Inspecting and Fixing Docker Containers Vulnerabilities </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#configuring-snyk-for-docker-registry-scanning> Configuring Snyk for Docker Registry Scanning </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#continuous-monitoring-of-applications> Continuous Monitoring of Applications </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#configuring-slack-notifications> Configuring Slack Notifications </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#additional-best-practices-and-resources> Additional Best Practices and Resources </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav aria-label="Table of contents" class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=#introduction> Introduction </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#prerequisites> Prerequisites </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#configuring-snyk-for-ides> Configuring Snyk for IDEs </a> <nav aria-label="Configuring Snyk for IDEs" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#installing-snyk-ide-extension> Installing Snyk IDE Extension </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#scanning-online-boutique-demo-application> Scanning Online Boutique Demo Application </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#configuring-snyk-for-ci-pipelines> Configuring Snyk for CI Pipelines </a> <nav aria-label="Configuring Snyk for CI Pipelines" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#application-source-code-scanning> Application Source Code Scanning </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#iac-manifests-scanning> IAC Manifests Scanning </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#docker-containers-scanning> Docker Containers Scanning </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#testing-the-final-setup> Testing the Final Setup </a> <nav aria-label="Testing the Final Setup" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#inspecting-and-fixing-application-source-code-vulnerabilities> Inspecting and Fixing Application Source Code Vulnerabilities </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#inspecting-and-fixing-iac-vulnerabilities> Inspecting and Fixing IAC Vulnerabilities </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#inspecting-and-fixing-docker-containers-vulnerabilities> Inspecting and Fixing Docker Containers Vulnerabilities </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#configuring-snyk-for-docker-registry-scanning> Configuring Snyk for Docker Registry Scanning </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#continuous-monitoring-of-applications> Continuous Monitoring of Applications </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#configuring-slack-notifications> Configuring Slack Notifications </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#additional-best-practices-and-resources> Additional Best Practices and Resources </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a class="md-content__button md-icon" href=https://github.com/digitalocean/k8s-adoption-journey/edit/master/docs/07-security/software-supply-chain.md title="Edit this page"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"></path></svg> </a> <h1>Securing the software supply chain</h1> <h2 id=introduction>Introduction</h2> <p>Securing the Kubernetes software supply chain is a challenging task because of the multiple layers and components involved. In the end, it doesn't have to be so. By following a set of best practices and recommendations the process gets easier to implement and manage afterwards.</p> <p>Below is a set of best practices that will help you achieve a more secure supply chain:</p> <ol> <li>Early adoption of security scanning tools right within your IDE. Usually, you get this kind of support via extensions (or plugins) that can be installed right in your preferred IDE. It's best to adopt security best practices in the early stages of development thus preventing breaches at a later time when costs get really high.</li> <li>Use security gates with CI pipelines. Basically, you enable security tools to perform static code analysis for each pull request targeting your GitHub repository.</li> <li>Container registry periodic scans. New vulnerabilities are reported each day so you need to make sure that your registry is scanned on a regular basis and get notified in due time. Even though project images are automatically scanned in the CI process and pass all security checks at that point in time, it doesn't mean they are still safe today. What's important to understand is that any external dependency you source in your project is subject to new threats. Docker base images, 3rd party libraries, etc you fetch and use in your projects add to the list of vulnerabilities.</li> <li>Post-deployment and Kubernetes cluster periodic scans. Same idea as with registry scans. You already deployed application workloads to your cluster but because new vulnerabilities are discovered each day, yet again your system becomes sensible to attacks pretty soon. Enabling continuous scans for Kubernetes workloads (Pods, Deployments, etc), worker nodes, etc, decreases the overall risk. Kubernetes is a multi-tenant system - what if someone bypasses all security checks presented earlier? This is another reason why continuous scanning of your Kubernetes cluster is important.</li> </ol> <p>Because of the multitude of vulnerabilities found each day, this process should be approached systematically. On the other hand, each team or organization decides the level of acceptance considered to be safe for each project internally. Usually, you take care of vulnerabilities reported as high/critical first. Later on, at a fixed interval or even earlier depending on the severity level of newly disclosed vulnerabilities you repeat the process, and so on.</p> <p>There are several tools available to help you along the way two of the most valuable today being <a href=https://hub.armosec.io/docs/ >Kubescape</a> and <a href=https://snyk.io/ >Snyk</a>. In this guide, Snyk is picked because it provides more options and it's more flexible. Either tool you choose the basic idea is the same.</p> <p><strong>Why Snyk?</strong></p> <p>Snyk provides very good support for the following:</p> <ol> <li>IDE integration (e.g. <a href="https://marketplace.visualstudio.com/items?itemName=snyk-security.snyk-vulnerability-scanner">Visual Studio Code</a>).</li> <li>User application code base scanning.</li> <li>IAC manifests scanning (Kubernetes, Terraform, etc).</li> <li>Third party libraries and open source projects scanning.</li> <li>Application Docker images scanning.</li> <li>Docker registry integration for periodic scanning (including private registries such as <a href=https://docs.snyk.io/products/snyk-container/image-scanning-library/digitalocean-image-scanning/container-security-with-digitalocean-integration>DOCR</a>).</li> <li>CI pipelines integration via the CLI binary, or <a href=https://github.com/snyk/actions>GitHub Actions</a>.</li> <li>GitHub repository integration for continuous scans of your application repository.</li> <li>Dedicated web portal to investigate reported issues and take appropriate actions to remediate the situation.</li> </ol> <p>All of the above is available in the free version. For small startups and business the <a href=https://snyk.io/plans/ >free tier</a> should be more than enough.</p> <p>For an in-depth explanations and comparison, please visit DigitalOcean's tutorials dedicated to both <a href=https://github.com/digitalocean/container-blueprints/tree/main/DOKS-supply-chain-security>Kubescape and Snyk</a>. Also, the official documentation for each tool is very valuable and provides more insight.</p> <h2 id=prerequisites>Prerequisites</h2> <p>To complete this section you will need:</p> <ol> <li>A free <a href=https://app.snyk.io>Snyk cloud account</a> account used to periodically publish scan results for your Kubernetes cluster to a nice dashboard. Also, the Snyk web interface helps you with investigations and risk analysis. Please follow <a href=https://docs.snyk.io/tutorials/getting-started/snyk-integrations/snyk-account>How to Create a Snyk Account</a> documentation page.</li> <li>The <code>microservices-demo</code> GitHub repository already prepared as explained in the <a href=../../01-getting-started/building-and-pushing-docker-images/introduction-and-repository-setup/ >Preparing demo application GitHub repository</a> section.</li> <li>A <a href=https://docs.github.com/en/actions/security-guides/encrypted-secrets#creating-encrypted-secrets-for-a-repository>GitHub secret</a> named <code>SNYK_TOKEN</code> which holds your Snyk user account ID. Run <code>snyk config get api</code> in a terminal to get your ID. If that doesn't work, you should be able to retrieve the token from your <a href=https://docs.snyk.io/snyk-web-ui/getting-started-with-the-snyk-web-ui#manage-account-preferences-and-settings>user account settings</a> page.</li> <li>The <a href=https://docs.snyk.io/products/snyk-code/getting-started-with-snyk-code/activating-snyk-code-using-the-web-ui/step-1-enabling-the-snyk-code-option>Snyk Code option enabled</a> in your Snyk Org Setting.</li> <li>A Slack workspace you own, and a dedicated <a href=https://api.slack.com/authentication/basics>Slack app</a> to get notified of vulnerability scan issues reported by Snyk.</li> </ol> <h2 id=configuring-snyk-for-ides>Configuring Snyk for IDEs</h2> <p>It's very important to discover security issues right from the early stages of development. Integrating vulnerabilities scanning tool with your preferred IDE is a good start. Doing so, you will get security reports right in your IDE for each project you're working on. Fixing security issues in the development stage avoids propagation and later problems in production systems.</p> <h3 id=installing-snyk-ide-extension>Installing Snyk IDE Extension</h3> <p>This guide is focusing on Visual Studio Code integration because it is the most popular IDE nowadays. Nevertheless, Snyk offers support for other IDEs as well, such as:</p> <ol> <li><a href=https://docs.snyk.io/ide-tools/eclipse-plugin/ >Eclipse</a>.</li> <li><a href=https://docs.snyk.io/ide-tools/jetbrains-plugins/ >JetBrains</a>.</li> <li><a href=https://docs.snyk.io/ide-tools/visual-studio-extension/ >Visual Studio</a>.</li> <li>Generic integration via <a href=https://docs.snyk.io/ide-tools/language-server/ >language server protocol</a> for any IDE that supports it.</li> </ol> <p>Follow below steps to integrate Snyk with your existing Visual Studio Code installation:</p> <ol> <li> <p>Launch Visual Studio Code, and navigate to the extensions tab:</p> <p><a class=glightbox data-desc-position=bottom data-description data-height=auto data-title data-width=100% href=../assets/images/extensions_menu.png><img alt="VSCode Extensions Menu" src=../assets/images/extensions_menu.png></a></p> </li> <li> <p>Type <code>snyk</code> in the search box. Matched extensions should be present:</p> <p><a class=glightbox data-desc-position=bottom data-description data-height=auto data-title data-width=100% href=../assets/images/extensions_snyk_search.png><img alt="Snyk Extension Search" src=../assets/images/extensions_snyk_search.png></a></p> </li> <li> <p>Install Snyk extension from the list:</p> <p><a class=glightbox data-desc-position=bottom data-description data-height=auto data-title data-width=100% href=../assets/images/snyk_ext_install.png><img alt="Install Snyk Extension" src=../assets/images/snyk_ext_install.png></a></p> </li> </ol> <p>After completing above steps, a Snyk button should appear in the left menu bar:</p> <p><a class=glightbox data-desc-position=bottom data-description data-height=auto data-title data-width=100% href=../assets/images/snyk_ext_config.png><img alt="Snyk Menu" src=../assets/images/snyk_ext_config.png></a></p> <p>From there you should connect your free Snyk account with Visual Studio Code and benefit from the features offered by the extension. Next, you will discover how easy it is to scan an existing project and get detailed information about reported vulnerabilities.</p> <h3 id=scanning-online-boutique-demo-application>Scanning Online Boutique Demo Application</h3> <p>The Snyk extension is able to scan your local projects and report found issues right within your IDE of your choice. This guide is relying on Visual Studio Code but you should get similar experience with other supported IDEs as well.</p> <p>To test Snyk extension features inside Visual Studio Code, launch the IDE and open your microservices-demo project (should be already cloned on your local machine). Then, follow below steps:</p> <ol> <li>Navigate to the Snyk extension menu by clicking the icon from the left menu bar with a dog picture on it.</li> <li> <p>You will be presented with a message asking you to enable Snyk code scanning. This needs to be performed only once for the current project:</p> <p><a class=glightbox data-desc-position=bottom data-description data-height=auto data-title data-width=100% href=../assets/images/snyk_code_ide_enable.png><img alt="Enable Snyk Code within IDE" src=../assets/images/snyk_code_ide_enable.png></a></p> </li> <li> <p>Next, you will be redirected to your Snyk account settings. A new web browser window is opened. Tick the checkbox, and save changes:</p> <p><a class=glightbox data-desc-position=bottom data-description data-height=auto data-title data-width=100% href=../assets/images/enable_snyk_code_feature.png><img alt="Enable Snyk Code Web Account" src=../assets/images/enable_snyk_code_feature.png></a></p> </li> <li> <p>Go back to your VS Code instance - you should see Snyk scanning your project for vulnerabilities. When it finishes, the following report should be presented to you:</p> <p><a class=glightbox data-desc-position=bottom data-description data-height=auto data-title data-width=100% href=../assets/images/snyk_ide_report_listing.png><img alt="Snyk Project Scan Report" src=../assets/images/snyk_ide_report_listing.png></a></p> </li> </ol> <p>If everything looks like above then you have successfully scanned your first project using Snyk right from your IDE. Next, click on each reported issue to see the root cause and get additional details:</p> <p><a class=glightbox data-desc-position=bottom data-description data-height=auto data-title data-width=100% href=../assets/images/snyk_ide_scan_golang.png><img alt="Golang App Security Issue Details" src=../assets/images/snyk_ide_scan_golang.png></a></p> <p>For each reported issue you should get the severity level printed, and additional explanations why it's considered an issue alongside with a possible fix, if it's known. Severity levels are denoted with an uppercase letter, such as <strong>H</strong> for high severity, <strong>M</strong> for medium severity, and so on.</p> <p>Please visit the <a href=https://docs.snyk.io/ide-tools/visual-studio-code-extension>official documentation</a> to learn more about the Snyk IDE extension and all available features.</p> <h2 id=configuring-snyk-for-ci-pipelines>Configuring Snyk for CI Pipelines</h2> <p>Snyk offers very good support in terms of CI pipelines automation via the dedicated <a href=https://docs.snyk.io/snyk-cli/ >CLI</a>. GitHub pipelines support is also available via <a href=https://github.com/snyk/actions>Snyk actions</a>.</p> <p>Before going into the implementation steps it's important to understand how Snyk is architected and used in practice. Without going too much into the inner details, you should know the following:</p> <ol> <li>Snyk is able to scan your <strong>application code</strong> for vulnerabilities. This feature is provided by the <a href=https://docs.snyk.io/products/snyk-code/ >Snyk Code</a> component.</li> <li>Snyk is able to scan <strong>open source projects</strong> and <strong>3rd party dependencies</strong>. This feature is provided by the <a href=https://docs.snyk.io/products/snyk-open-source/ >Snyk Open Source</a> component.</li> <li>Snyk knows how to scan <strong>Infrastructure as Code</strong> (IAC) manifests such as <strong>Kubernetes</strong>, <strong>Terraform</strong>, etc. This feature is provided by the <a href=https://docs.snyk.io/products/snyk-infrastructure-as-code/ >Snyk Infrastructure as Code</a> component.</li> <li>Snyk knows to scan <strong>containers</strong> (e.g. Docker), as well as <strong>Dockerfiles</strong>. This feature is provided by the <a href=https://docs.snyk.io/products/snyk-container/ >Snyk Container</a> component.</li> </ol> <p>Each feature from the above list is available via the free CLI tool offered by Snyk. This guide is focused more on the CLI integration with GitHub pipelines because of the scripting flexibility that it offers. You already configured a CI pipeline for your project in the <a href=../../05-ci-cd/setup-continuous-integration/ >CI chapter</a> available in the Kubernetes adoption journey guide. Whenever a pull request is opened for your repository, a CI GitHub workflow is automatically triggered for validation.</p> <p>You will learn how to integrate Snyk with existing CI workflows to benefit from all features offered by the scanning tool. On each scan, the Snyk CLI will generate a report that you can visualize using the web portal offered for free by Snyk. The tool is also able to generate <strong>SARIF</strong> reports hence the final results will be available right in the <code>Security</code> tab of your GitHub repository. Other supported formats are <strong>JSON</strong> and <strong>HTML</strong>.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Only the IAC manifests scanner is able to upload results to the Snyk web portal at this time of writing.</p> </div> <p>Instead of embedding Snyk logic directly into CI pipelines, you will configure <strong>three separate Snyk workflows</strong> running in parallel with existing ones. Each Snyk workflow deals with a specific task such as scanning and detecting vulnerabilities for application source code, IAC manifests, and Docker containers. In the end, the net effect is the same - Snyk acts as a security gate, thus validating or invalidating a pull request based on the scan results.</p> <p>This approach has the following benefits:</p> <ol> <li>Snyk workflows run in parallel with other flows, such as <a href=../../05-ci-cd/setup-continuous-integration/#configuring-pull-requests-workflow>pull requests CI workflows</a>. If you need to fix something that is Snyk related, only the specific workflow is triggered and not the whole PR flow.</li> <li>Waiting time is reduced - some workflows take more time to finish such as PR workflows which runs automated tests.</li> <li>By decoupling Snyk logic, you avoid adding more complexity to the pull requests workflow thus easing maintenance.</li> </ol> <p>Next, you will learn how to configure each Snyk workflow in turn to scan application source code with 3rd party dependencies, IAC manifests and Docker containers.</p> <h3 id=application-source-code-scanning>Application Source Code Scanning</h3> <p>Snyk uses various heuristics under the hood to perform static analysis of your application source code, as well as 3rd party dependencies. It creates a snapshot for your application source code current state, and runs the analysis. When finished you'll get the scan results printed to standard output in your terminal of choice. Snyk is also able to export scan results in other formats such as <strong>GitHub SARIF</strong>, <strong>JSON</strong>, etc.</p> <p>Each reported issue has a severity level associated as well such as <strong>critical</strong>, <strong>high</strong>, <strong>medium</strong>, and <strong>low</strong>. Usually you will take into account issues marked as critical and high first. Also, some issues may not affect your application even though they're reported. In such case, you have the option to <a href=https://docs.snyk.io/snyk-cli/commands/ignore>exclude or ignore issues</a>.</p> <p><strong>How do you pick the severity threshold?</strong></p> <p>Snyk marks your pipeline as failed if the found issues have a severity level <strong>equal to or higher</strong> than the threshold you set. As an example, if you <strong>set the threshold to high</strong>, then Snyk takes into account all issues reported as <strong>high</strong> and <strong>critical</strong>. If the <strong>threshold is set to medium</strong>, then it will take into account all issues reported as <strong>medium</strong>, <strong>high</strong> and <strong>critical</strong>. In other words, if you lower the bar it gets more and more strict.</p> <p>Follow below steps to configure the Snyk workflow used for application source code scanning:</p> <ol> <li> <p>Clone the <code>microservices-demo</code> repository on your local machine, if not already (make sure to replace the <code>&lt;&gt;</code> placeholders accordingly):</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-0-1 id=__codelineno-0-1 name=__codelineno-0-1></a>git clone https://github.com/&lt;YOUR_GITHUB_ACCOUNT_USERNAME&gt;/microservices-demo.git
</code></pre></div> </li> <li> <p>Change directory to your local copy:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-1-1 id=__codelineno-1-1 name=__codelineno-1-1></a><span class=nb>cd</span> microservices-demo
</code></pre></div> </li> <li> <p>Fetch the <code>online-boutique-snyk-source-code-scan.yaml</code> workflow file from the <a href=https://github.com/digitalocean/kubernetes-sample-apps>kubernetes-sample-apps</a> repository:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-2-1 id=__codelineno-2-1 name=__codelineno-2-1></a>curl https://raw.githubusercontent.com/digitalocean/kubernetes-sample-apps/master/.github/workflows/online-boutique-snyk-source-code-scan.yaml <span class=se>\</span>
<a href=#__codelineno-2-2 id=__codelineno-2-2 name=__codelineno-2-2></a>  -o .github/workflows/online-boutique-snyk-source-code-scan.yaml <span class=se>\</span>
<a href=#__codelineno-2-3 id=__codelineno-2-3 name=__codelineno-2-3></a>  --create-dirs
</code></pre></div> </li> <li> <p>Edit the <code>.github/workflows/online-boutique-snyk-source-code-scan.yaml</code> file using a text editor of your choice, preferably with YAML lint support. For example, you can use <a href=https://code.visualstudio.com/ >VS Code</a>:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-3-1 id=__codelineno-3-1 name=__codelineno-3-1></a>code .github/workflows/online-boutique-snyk-source-code-scan.yaml
</code></pre></div> </li> <li> <p>Uncomment the lines prefixed with a hash mark at the top of the workflow file. The resulting file should look like:</p> <details class=note> <summary>Click to expand the <code>Online Boutique Snyk Source Code Scan</code> workflow file</summary> <div class=highlight><pre><span></span><code><a href=#__codelineno-4-1 id=__codelineno-4-1 name=__codelineno-4-1></a><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Online Boutique Snyk Source Code Scan</span><span class=w></span>
<a href=#__codelineno-4-2 id=__codelineno-4-2 name=__codelineno-4-2></a>
<a href=#__codelineno-4-3 id=__codelineno-4-3 name=__codelineno-4-3></a><span class=nt>on</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-4 id=__codelineno-4-4 name=__codelineno-4-4></a><span class=w>  </span><span class=nt>pull_request</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-5 id=__codelineno-4-5 name=__codelineno-4-5></a><span class=w>    </span><span class=nt>branches</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-6 id=__codelineno-4-6 name=__codelineno-4-6></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">main</span><span class=w></span>
<a href=#__codelineno-4-7 id=__codelineno-4-7 name=__codelineno-4-7></a><span class=w>    </span><span class=nt>paths</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-8 id=__codelineno-4-8 name=__codelineno-4-8></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>"src/**"</span><span class=w></span>
<a href=#__codelineno-4-9 id=__codelineno-4-9 name=__codelineno-4-9></a>
<a href=#__codelineno-4-10 id=__codelineno-4-10 name=__codelineno-4-10></a><span class=w>  </span><span class=c1># Below configuration is used for manual workflow dispatch</span><span class=w></span>
<a href=#__codelineno-4-11 id=__codelineno-4-11 name=__codelineno-4-11></a><span class=w>  </span><span class=nt>workflow_dispatch</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-12 id=__codelineno-4-12 name=__codelineno-4-12></a><span class=w>    </span><span class=nt>inputs</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-13 id=__codelineno-4-13 name=__codelineno-4-13></a><span class=w>      </span><span class=nt>snyk_fail_threshold</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-14 id=__codelineno-4-14 name=__codelineno-4-14></a><span class=w>        </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span><span class=w></span>
<a href=#__codelineno-4-15 id=__codelineno-4-15 name=__codelineno-4-15></a><span class=w>          </span><span class=no>Sets fail threshold for Snyk </span><span class=w></span>
<a href=#__codelineno-4-16 id=__codelineno-4-16 name=__codelineno-4-16></a><span class=w>          </span><span class=no>(low | medium | high | critical)</span><span class=w></span>
<a href=#__codelineno-4-17 id=__codelineno-4-17 name=__codelineno-4-17></a><span class=w>        </span><span class=nt>required</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class=w></span>
<a href=#__codelineno-4-18 id=__codelineno-4-18 name=__codelineno-4-18></a><span class=w>        </span><span class=nt>default</span><span class=p>:</span><span class=w> </span><span class=s>"high"</span><span class=w></span>
<a href=#__codelineno-4-19 id=__codelineno-4-19 name=__codelineno-4-19></a>
<a href=#__codelineno-4-20 id=__codelineno-4-20 name=__codelineno-4-20></a><span class=nt>env</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-21 id=__codelineno-4-21 name=__codelineno-4-21></a><span class=w>  </span><span class=nt>PROJECT_NAME</span><span class=p>:</span><span class=w> </span><span class=s>"online-boutique"</span><span class=w></span>
<a href=#__codelineno-4-22 id=__codelineno-4-22 name=__codelineno-4-22></a><span class=w>  </span><span class=nt>SNYK_FAIL_THRESHOLD</span><span class=p>:</span><span class=w> </span><span class=s>"high"</span><span class=w></span>
<a href=#__codelineno-4-23 id=__codelineno-4-23 name=__codelineno-4-23></a>
<a href=#__codelineno-4-24 id=__codelineno-4-24 name=__codelineno-4-24></a><span class=nt>jobs</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-25 id=__codelineno-4-25 name=__codelineno-4-25></a><span class=w>  </span><span class=nt>source-code-security-check</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-26 id=__codelineno-4-26 name=__codelineno-4-26></a><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span><span class=w></span>
<a href=#__codelineno-4-27 id=__codelineno-4-27 name=__codelineno-4-27></a><span class=w>    </span><span class=nt>strategy</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-28 id=__codelineno-4-28 name=__codelineno-4-28></a><span class=w>      </span><span class=nt>fail-fast</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class=w></span>
<a href=#__codelineno-4-29 id=__codelineno-4-29 name=__codelineno-4-29></a><span class=w>      </span><span class=nt>matrix</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-30 id=__codelineno-4-30 name=__codelineno-4-30></a><span class=w>        </span><span class=nt>include</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-31 id=__codelineno-4-31 name=__codelineno-4-31></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>project_name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">cartservice</span><span class=w></span>
<a href=#__codelineno-4-32 id=__codelineno-4-32 name=__codelineno-4-32></a><span class=w>            </span><span class=nt>project_language</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">dotnet</span><span class=w></span>
<a href=#__codelineno-4-33 id=__codelineno-4-33 name=__codelineno-4-33></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>project_name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">checkoutservice</span><span class=w></span>
<a href=#__codelineno-4-34 id=__codelineno-4-34 name=__codelineno-4-34></a><span class=w>            </span><span class=nt>project_language</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">golang</span><span class=w></span>
<a href=#__codelineno-4-35 id=__codelineno-4-35 name=__codelineno-4-35></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>project_name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">currencyservice</span><span class=w></span>
<a href=#__codelineno-4-36 id=__codelineno-4-36 name=__codelineno-4-36></a><span class=w>            </span><span class=nt>project_language</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">node</span><span class=w></span>
<a href=#__codelineno-4-37 id=__codelineno-4-37 name=__codelineno-4-37></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>project_name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">emailservice</span><span class=w></span>
<a href=#__codelineno-4-38 id=__codelineno-4-38 name=__codelineno-4-38></a><span class=w>            </span><span class=nt>project_language</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">python</span><span class=w></span>
<a href=#__codelineno-4-39 id=__codelineno-4-39 name=__codelineno-4-39></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>project_name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">frontend</span><span class=w></span>
<a href=#__codelineno-4-40 id=__codelineno-4-40 name=__codelineno-4-40></a><span class=w>            </span><span class=nt>project_language</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">golang</span><span class=w></span>
<a href=#__codelineno-4-41 id=__codelineno-4-41 name=__codelineno-4-41></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>project_name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">paymentservice</span><span class=w></span>
<a href=#__codelineno-4-42 id=__codelineno-4-42 name=__codelineno-4-42></a><span class=w>            </span><span class=nt>project_language</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">node</span><span class=w></span>
<a href=#__codelineno-4-43 id=__codelineno-4-43 name=__codelineno-4-43></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>project_name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">productcatalogservice</span><span class=w></span>
<a href=#__codelineno-4-44 id=__codelineno-4-44 name=__codelineno-4-44></a><span class=w>            </span><span class=nt>project_language</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">golang</span><span class=w></span>
<a href=#__codelineno-4-45 id=__codelineno-4-45 name=__codelineno-4-45></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>project_name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">recommendationservice</span><span class=w></span>
<a href=#__codelineno-4-46 id=__codelineno-4-46 name=__codelineno-4-46></a><span class=w>            </span><span class=nt>project_language</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">python</span><span class=w></span>
<a href=#__codelineno-4-47 id=__codelineno-4-47 name=__codelineno-4-47></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>project_name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">shippingservice</span><span class=w></span>
<a href=#__codelineno-4-48 id=__codelineno-4-48 name=__codelineno-4-48></a><span class=w>            </span><span class=nt>project_language</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">golang</span><span class=w></span>
<a href=#__codelineno-4-49 id=__codelineno-4-49 name=__codelineno-4-49></a><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-50 id=__codelineno-4-50 name=__codelineno-4-50></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Checkout</span><span class=w></span>
<a href=#__codelineno-4-51 id=__codelineno-4-51 name=__codelineno-4-51></a><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span><span class=w></span>
<a href=#__codelineno-4-52 id=__codelineno-4-52 name=__codelineno-4-52></a><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-53 id=__codelineno-4-53 name=__codelineno-4-53></a><span class=w>          </span><span class=nt>ref</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${{ github.event.pull_request.head.ref }}</span><span class=w></span>
<a href=#__codelineno-4-54 id=__codelineno-4-54 name=__codelineno-4-54></a><span class=w>          </span><span class=nt>repository</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${{ github.event.pull_request.head.repo.full_name }}</span><span class=w></span>
<a href=#__codelineno-4-55 id=__codelineno-4-55 name=__codelineno-4-55></a>
<a href=#__codelineno-4-56 id=__codelineno-4-56 name=__codelineno-4-56></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Install Snyk</span><span class=w></span>
<a href=#__codelineno-4-57 id=__codelineno-4-57 name=__codelineno-4-57></a><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">snyk/actions/setup@master</span><span class=w></span>
<a href=#__codelineno-4-58 id=__codelineno-4-58 name=__codelineno-4-58></a>
<a href=#__codelineno-4-59 id=__codelineno-4-59 name=__codelineno-4-59></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Setup dotnet</span><span class=w></span>
<a href=#__codelineno-4-60 id=__codelineno-4-60 name=__codelineno-4-60></a><span class=w>        </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${{ matrix.project_language == 'dotnet' }}</span><span class=w></span>
<a href=#__codelineno-4-61 id=__codelineno-4-61 name=__codelineno-4-61></a><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">actions/setup-dotnet@v3</span><span class=w></span>
<a href=#__codelineno-4-62 id=__codelineno-4-62 name=__codelineno-4-62></a><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-63 id=__codelineno-4-63 name=__codelineno-4-63></a><span class=w>          </span><span class=nt>dotnet-version</span><span class=p>:</span><span class=w> </span><span class=s>'6.0'</span><span class=w></span>
<a href=#__codelineno-4-64 id=__codelineno-4-64 name=__codelineno-4-64></a>
<a href=#__codelineno-4-65 id=__codelineno-4-65 name=__codelineno-4-65></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Restore dotnet project dependencies</span><span class=w></span>
<a href=#__codelineno-4-66 id=__codelineno-4-66 name=__codelineno-4-66></a><span class=w>        </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${{ matrix.project_language == 'dotnet' }}</span><span class=w></span>
<a href=#__codelineno-4-67 id=__codelineno-4-67 name=__codelineno-4-67></a><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">dotnet restore</span><span class=w></span>
<a href=#__codelineno-4-68 id=__codelineno-4-68 name=__codelineno-4-68></a><span class=w>        </span><span class=nt>working-directory</span><span class=p>:</span><span class=w> </span><span class=s>"src/${{</span><span class=nv> </span><span class=s>matrix.project_name</span><span class=nv> </span><span class=s>}}"</span><span class=w></span>
<a href=#__codelineno-4-69 id=__codelineno-4-69 name=__codelineno-4-69></a>
<a href=#__codelineno-4-70 id=__codelineno-4-70 name=__codelineno-4-70></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Set up Python env</span><span class=w></span>
<a href=#__codelineno-4-71 id=__codelineno-4-71 name=__codelineno-4-71></a><span class=w>        </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${{ matrix.project_language == 'python' }}</span><span class=w></span>
<a href=#__codelineno-4-72 id=__codelineno-4-72 name=__codelineno-4-72></a><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">actions/setup-python@v3</span><span class=w></span>
<a href=#__codelineno-4-73 id=__codelineno-4-73 name=__codelineno-4-73></a><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-74 id=__codelineno-4-74 name=__codelineno-4-74></a><span class=w>          </span><span class=nt>python-version</span><span class=p>:</span><span class=w> </span><span class=s>"3.7"</span><span class=w></span>
<a href=#__codelineno-4-75 id=__codelineno-4-75 name=__codelineno-4-75></a>
<a href=#__codelineno-4-76 id=__codelineno-4-76 name=__codelineno-4-76></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Install Python project dependencies</span><span class=w></span>
<a href=#__codelineno-4-77 id=__codelineno-4-77 name=__codelineno-4-77></a><span class=w>        </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${{ matrix.project_language == 'python' }}</span><span class=w></span>
<a href=#__codelineno-4-78 id=__codelineno-4-78 name=__codelineno-4-78></a><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">pip install -r requirements.txt</span><span class=w></span>
<a href=#__codelineno-4-79 id=__codelineno-4-79 name=__codelineno-4-79></a><span class=w>        </span><span class=nt>working-directory</span><span class=p>:</span><span class=w> </span><span class=s>"src/${{</span><span class=nv> </span><span class=s>matrix.project_name</span><span class=nv> </span><span class=s>}}"</span><span class=w></span>
<a href=#__codelineno-4-80 id=__codelineno-4-80 name=__codelineno-4-80></a>
<a href=#__codelineno-4-81 id=__codelineno-4-81 name=__codelineno-4-81></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Check application source code for vulnerabilities</span><span class=w></span>
<a href=#__codelineno-4-82 id=__codelineno-4-82 name=__codelineno-4-82></a><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span><span class=w></span>
<a href=#__codelineno-4-83 id=__codelineno-4-83 name=__codelineno-4-83></a><span class=w>          </span><span class=no># Cartservice is an exception regarding project layout</span><span class=w></span>
<a href=#__codelineno-4-84 id=__codelineno-4-84 name=__codelineno-4-84></a><span class=w>          </span><span class=no># It uses a nested src subfolder - `src/cartservice/src`</span><span class=w></span>
<a href=#__codelineno-4-85 id=__codelineno-4-85 name=__codelineno-4-85></a><span class=w>          </span><span class=no>if [[ "${{ matrix.project_name }}" == "cartservice" ]]; then</span><span class=w></span>
<a href=#__codelineno-4-86 id=__codelineno-4-86 name=__codelineno-4-86></a><span class=w>            </span><span class=no>cd src/</span><span class=w></span>
<a href=#__codelineno-4-87 id=__codelineno-4-87 name=__codelineno-4-87></a><span class=w>          </span><span class=no>fi</span><span class=w></span>
<a href=#__codelineno-4-88 id=__codelineno-4-88 name=__codelineno-4-88></a><span class=w>          </span><span class=no>snyk code test \</span><span class=w></span>
<a href=#__codelineno-4-89 id=__codelineno-4-89 name=__codelineno-4-89></a><span class=w>            </span><span class=no>--severity-threshold=${{ github.event.inputs.snyk_fail_threshold || env.SNYK_FAIL_THRESHOLD }}</span><span class=w></span>
<a href=#__codelineno-4-90 id=__codelineno-4-90 name=__codelineno-4-90></a><span class=w>        </span><span class=nt>env</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-91 id=__codelineno-4-91 name=__codelineno-4-91></a><span class=w>          </span><span class=nt>SNYK_TOKEN</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.SNYK_TOKEN }}</span><span class=w></span>
<a href=#__codelineno-4-92 id=__codelineno-4-92 name=__codelineno-4-92></a><span class=w>        </span><span class=nt>working-directory</span><span class=p>:</span><span class=w> </span><span class=s>"src/${{</span><span class=nv> </span><span class=s>matrix.project_name</span><span class=nv> </span><span class=s>}}"</span><span class=w></span>
<a href=#__codelineno-4-93 id=__codelineno-4-93 name=__codelineno-4-93></a>
<a href=#__codelineno-4-94 id=__codelineno-4-94 name=__codelineno-4-94></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Check 3rd party source code for vulnerabilities</span><span class=w></span>
<a href=#__codelineno-4-95 id=__codelineno-4-95 name=__codelineno-4-95></a><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span><span class=w></span>
<a href=#__codelineno-4-96 id=__codelineno-4-96 name=__codelineno-4-96></a><span class=w>          </span><span class=no># Cartservice is an exception regarding project layout </span><span class=w></span>
<a href=#__codelineno-4-97 id=__codelineno-4-97 name=__codelineno-4-97></a><span class=w>          </span><span class=no># It uses a nested src subfolder - `src/cartservice/src`</span><span class=w></span>
<a href=#__codelineno-4-98 id=__codelineno-4-98 name=__codelineno-4-98></a><span class=w>          </span><span class=no>if [[ "${{ matrix.project_name }}" == "cartservice" ]]; then</span><span class=w></span>
<a href=#__codelineno-4-99 id=__codelineno-4-99 name=__codelineno-4-99></a><span class=w>            </span><span class=no>cd src/</span><span class=w></span>
<a href=#__codelineno-4-100 id=__codelineno-4-100 name=__codelineno-4-100></a><span class=w>          </span><span class=no>fi</span><span class=w></span>
<a href=#__codelineno-4-101 id=__codelineno-4-101 name=__codelineno-4-101></a><span class=w>          </span><span class=no>snyk test \</span><span class=w></span>
<a href=#__codelineno-4-102 id=__codelineno-4-102 name=__codelineno-4-102></a><span class=w>            </span><span class=no>--severity-threshold=${{ github.event.inputs.snyk_fail_threshold || env.SNYK_FAIL_THRESHOLD }} \</span><span class=w></span>
<a href=#__codelineno-4-103 id=__codelineno-4-103 name=__codelineno-4-103></a><span class=w>            </span><span class=no>--project-name=${{ env.PROJECT_NAME }} \</span><span class=w></span>
<a href=#__codelineno-4-104 id=__codelineno-4-104 name=__codelineno-4-104></a><span class=w>            </span><span class=no>--target-reference=${{ matrix.project_name }}</span><span class=w></span>
<a href=#__codelineno-4-105 id=__codelineno-4-105 name=__codelineno-4-105></a><span class=w>        </span><span class=nt>env</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-106 id=__codelineno-4-106 name=__codelineno-4-106></a><span class=w>          </span><span class=nt>SNYK_TOKEN</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.SNYK_TOKEN }}</span><span class=w></span>
<a href=#__codelineno-4-107 id=__codelineno-4-107 name=__codelineno-4-107></a><span class=w>        </span><span class=nt>working-directory</span><span class=p>:</span><span class=w> </span><span class=s>"src/${{</span><span class=nv> </span><span class=s>matrix.project_name</span><span class=nv> </span><span class=s>}}"</span><span class=w></span>
</code></pre></div> </details> </li> <li> <p>Save the workflow file, commit, and push changes to your GitHub repository.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Depending on your setup, you may want to adjust the following environment variables at the top of your workflow file: <div class=highlight><pre><span></span><code><a href=#__codelineno-5-1 id=__codelineno-5-1 name=__codelineno-5-1></a><span class=nt>env</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-5-2 id=__codelineno-5-2 name=__codelineno-5-2></a><span class=w>  </span><span class=nt>PROJECT_NAME</span><span class=p>:</span><span class=w> </span><span class=s>"online-boutique"</span><span class=w></span>
<a href=#__codelineno-5-3 id=__codelineno-5-3 name=__codelineno-5-3></a><span class=w>  </span><span class=nt>SNYK_FAIL_THRESHOLD</span><span class=p>:</span><span class=w> </span><span class=s>"high"</span><span class=w></span>
</code></pre></div></p> </div> </li> </ol> <p>Explanations for the <code>Online Boutique Snyk Source Code Scan</code> workflow configuration:</p> <ul> <li><code>on.pull_request</code> - triggers the <code>Online Boutique Snyk Source Code Scan</code> workflow on pull request events only.</li> <li><code>on.pull_request.branches</code> - triggers the <code>Online Boutique Snyk Source Code Scan</code> workflow whenever a pull request event is detected for the specified list of branches. In this case only <code>main</code> branch is desired.</li> <li><code>on.pull_requests.paths</code> - list of repository paths used for filtering. The <code>Online Boutique Snyk Source Code Scan</code> workflow is triggered whenever a change happens for the specified paths. It has to trigger whenever a change happens in the <code>src</code> folder and below (hence the <code>src/**</code> expression), where all microservices source code is stored.</li> <li><code>env</code> - sets environment variables to use for the whole pipeline. Usually, environment variables control workflow logic.</li> <li><code>strategy.matrix</code> - use a matrix build type. Snyk scans run in parallel for each microservices. This approach is a perfect match for projects using multiple components, such as microservices. It also cuts down the time required to test each component for vulnerabilities. Each element from the matrix sets the project name, and the language being used.</li> <li><code>steps</code> - list of steps to execute as part of the workflow jobs. For each project component (or microservice), the following list of actions is executed:<ol> <li>Code checkout, via <code>actions/checkout@v3</code>.</li> <li>Specific tools are installed based on project language (<code>actions/setup-dotnet@v2</code>, <code>actions/setup-python@v3</code>, etc). Snyk requires extra steps for <strong>Python</strong> and <strong>DotNET</strong> projects such as installing required dependencies before starting the actual scan.</li> <li>Application source code and 3rd party dependencies are scanned via <code>snyk code test</code> and <code>snyk test</code> commands.</li> <li>The severity threshold is picked either from the designated workflow environment variable, or from the designated input field if it is manually triggered. The manual trigger option is left as an alternative for testing the workflow - it is not triggered under normal circumstances.</li> </ol> </li> </ul> <div class="admonition note"> <p class=admonition-title>Note</p> <p>The <code>Online Boutique Snyk Source Code Scan</code> GitHub workflow matrix strategy has the <code>fail-fast</code> flag set to <code>false</code>. This is desired in this case because you will want to scan all microservices and wait for the final results to fix all issues, if any.</p> </div> <p>Following diagram shows a high level overview of <code>Online Boutique Snyk Source Code Scan</code> workflow composition:</p> <pre class=mermaid><code>graph LR
A(Source Code Scan Workflow &lt;br&gt; Start) --&gt; B(Snyk Scan Matrix)
B --&gt; C(Cart Service &lt;br&gt; Source Code Scan)
B --&gt; D(Checkout Service &lt;br&gt; Source Code Scan)
B --&gt; E(Currency Service &lt;br&gt; Source Code Scan)
B --&gt; F(Email Service &lt;br&gt; Source Code Scan)
B --&gt; G(Frontend Source Code Scan)
B --&gt; H(Payment Service &lt;br&gt; Source Code Scan)
B --&gt; I(Product Catalog Service &lt;br&gt; Source Code Scan)
B --&gt; J(Recommendation Service &lt;br&gt; Source Code Scan)
B --&gt; K(Shipping Service &lt;br&gt; Source Code Scan)
C &amp; D &amp; E &amp; F &amp; G &amp; H &amp; I &amp; J &amp; K --&gt; L(Source Code Scan Workflow &lt;br&gt; End)</code></pre> <p>Next, you will configure the Snyk GitHub workflow that automatically triggers whenever a change is detected for Kustomize manifests, aka trigger IAC scans.</p> <h3 id=iac-manifests-scanning>IAC Manifests Scanning</h3> <p>Besides application source code you will also have configuration data present in your repository if using a monorepo structure. Configuration data usually represents Kubernetes manifests, Terraform HCL files, etc. Adoption journey guide deals with Kustomize manifests defining Kubernetes manifests for each environment where the online boutique application runs.</p> <p>Kustomize and associated Kubernetes manifests are part of the supply chain as well hence it makes sense to create a dedicated workflow to keep an eye on this part. Argo CD generated manifests from the <a href=../../05-ci-cd/setup-continuous-deployments/ >CD chapter</a> is also part of the supply chain so it's best practice to include it as well in the automated scan process (already done via the GitHub workflow presented below).</p> <p>Follow below steps to configure the Snyk workflow used for IAC manifests scanning (Kustomize + Argo CD):</p> <ol> <li> <p>Clone the <code>microservices-demo</code> repository on your local machine, if not already (make sure to replace the <code>&lt;&gt;</code> placeholders accordingly):</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-6-1 id=__codelineno-6-1 name=__codelineno-6-1></a>git clone https://github.com/&lt;YOUR_GITHUB_ACCOUNT_USERNAME&gt;/microservices-demo.git
</code></pre></div> </li> <li> <p>Change directory to your local copy:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-7-1 id=__codelineno-7-1 name=__codelineno-7-1></a><span class=nb>cd</span> microservices-demo
</code></pre></div> </li> <li> <p>Fetch the <code>online-boutique-snyk-iac-scan.yaml</code> workflow file from the <a href=https://github.com/digitalocean/kubernetes-sample-apps>kubernetes-sample-apps</a> repository:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-8-1 id=__codelineno-8-1 name=__codelineno-8-1></a>curl https://raw.githubusercontent.com/digitalocean/kubernetes-sample-apps/master/.github/workflows/online-boutique-snyk-iac-scan.yaml <span class=se>\</span>
<a href=#__codelineno-8-2 id=__codelineno-8-2 name=__codelineno-8-2></a>  -o .github/workflows/online-boutique-snyk-iac-scan.yaml <span class=se>\</span>
<a href=#__codelineno-8-3 id=__codelineno-8-3 name=__codelineno-8-3></a>  --create-dirs
</code></pre></div> </li> <li> <p>Edit the <code>.github/workflows/online-boutique-snyk-iac-scan.yaml</code> file using a text editor of your choice, preferably with YAML lint support. For example, you can use <a href=https://code.visualstudio.com/ >VS Code</a>:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-9-1 id=__codelineno-9-1 name=__codelineno-9-1></a>code .github/workflows/online-boutique-snyk-iac-scan.yaml
</code></pre></div> </li> <li> <p>Uncomment the lines prefixed with a hash mark at the top of the workflow file. The resulting file should look like:</p> <details class=note> <summary>Click to expand the <code>Online Boutique Snyk IAC Scan</code> workflow file</summary> <div class=highlight><pre><span></span><code><a href=#__codelineno-10-1 id=__codelineno-10-1 name=__codelineno-10-1></a><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Online Boutique Snyk IAC Scan</span><span class=w></span>
<a href=#__codelineno-10-2 id=__codelineno-10-2 name=__codelineno-10-2></a>
<a href=#__codelineno-10-3 id=__codelineno-10-3 name=__codelineno-10-3></a><span class=nt>on</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-10-4 id=__codelineno-10-4 name=__codelineno-10-4></a><span class=w>  </span><span class=nt>pull_request</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-10-5 id=__codelineno-10-5 name=__codelineno-10-5></a><span class=w>    </span><span class=nt>branches</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-10-6 id=__codelineno-10-6 name=__codelineno-10-6></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">main</span><span class=w></span>
<a href=#__codelineno-10-7 id=__codelineno-10-7 name=__codelineno-10-7></a><span class=w>    </span><span class=nt>paths</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-10-8 id=__codelineno-10-8 name=__codelineno-10-8></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>"argocd/**"</span><span class=w></span>
<a href=#__codelineno-10-9 id=__codelineno-10-9 name=__codelineno-10-9></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>"kustomize/**"</span><span class=w></span>
<a href=#__codelineno-10-10 id=__codelineno-10-10 name=__codelineno-10-10></a>
<a href=#__codelineno-10-11 id=__codelineno-10-11 name=__codelineno-10-11></a><span class=w>  </span><span class=c1># Below configuration is used for manual workflow dispatch</span><span class=w></span>
<a href=#__codelineno-10-12 id=__codelineno-10-12 name=__codelineno-10-12></a><span class=w>  </span><span class=nt>workflow_dispatch</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-10-13 id=__codelineno-10-13 name=__codelineno-10-13></a><span class=w>    </span><span class=nt>inputs</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-10-14 id=__codelineno-10-14 name=__codelineno-10-14></a><span class=w>      </span><span class=nt>snyk_fail_threshold</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-10-15 id=__codelineno-10-15 name=__codelineno-10-15></a><span class=w>        </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span><span class=w></span>
<a href=#__codelineno-10-16 id=__codelineno-10-16 name=__codelineno-10-16></a><span class=w>          </span><span class=no>Sets fail threshold for Snyk </span><span class=w></span>
<a href=#__codelineno-10-17 id=__codelineno-10-17 name=__codelineno-10-17></a><span class=w>          </span><span class=no>(low | medium | high | critical)</span><span class=w></span>
<a href=#__codelineno-10-18 id=__codelineno-10-18 name=__codelineno-10-18></a><span class=w>        </span><span class=nt>required</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class=w></span>
<a href=#__codelineno-10-19 id=__codelineno-10-19 name=__codelineno-10-19></a><span class=w>        </span><span class=nt>default</span><span class=p>:</span><span class=w> </span><span class=s>"high"</span><span class=w></span>
<a href=#__codelineno-10-20 id=__codelineno-10-20 name=__codelineno-10-20></a>
<a href=#__codelineno-10-21 id=__codelineno-10-21 name=__codelineno-10-21></a><span class=nt>env</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-10-22 id=__codelineno-10-22 name=__codelineno-10-22></a><span class=w>  </span><span class=nt>PROJECT_NAME</span><span class=p>:</span><span class=w> </span><span class=s>"online-boutique"</span><span class=w></span>
<a href=#__codelineno-10-23 id=__codelineno-10-23 name=__codelineno-10-23></a><span class=w>  </span><span class=nt>SNYK_FAIL_THRESHOLD</span><span class=p>:</span><span class=w> </span><span class=s>"high"</span><span class=w></span>
<a href=#__codelineno-10-24 id=__codelineno-10-24 name=__codelineno-10-24></a>
<a href=#__codelineno-10-25 id=__codelineno-10-25 name=__codelineno-10-25></a><span class=nt>jobs</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-10-26 id=__codelineno-10-26 name=__codelineno-10-26></a><span class=w>  </span><span class=nt>iac-security-check</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-10-27 id=__codelineno-10-27 name=__codelineno-10-27></a><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span><span class=w></span>
<a href=#__codelineno-10-28 id=__codelineno-10-28 name=__codelineno-10-28></a><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-10-29 id=__codelineno-10-29 name=__codelineno-10-29></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Checkout</span><span class=w></span>
<a href=#__codelineno-10-30 id=__codelineno-10-30 name=__codelineno-10-30></a><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span><span class=w></span>
<a href=#__codelineno-10-31 id=__codelineno-10-31 name=__codelineno-10-31></a><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-10-32 id=__codelineno-10-32 name=__codelineno-10-32></a><span class=w>          </span><span class=nt>ref</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${{ github.event.pull_request.head.ref }}</span><span class=w></span>
<a href=#__codelineno-10-33 id=__codelineno-10-33 name=__codelineno-10-33></a><span class=w>          </span><span class=nt>repository</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${{ github.event.pull_request.head.repo.full_name }}</span><span class=w></span>
<a href=#__codelineno-10-34 id=__codelineno-10-34 name=__codelineno-10-34></a>
<a href=#__codelineno-10-35 id=__codelineno-10-35 name=__codelineno-10-35></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Install Snyk</span><span class=w></span>
<a href=#__codelineno-10-36 id=__codelineno-10-36 name=__codelineno-10-36></a><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">snyk/actions/setup@master</span><span class=w></span>
<a href=#__codelineno-10-37 id=__codelineno-10-37 name=__codelineno-10-37></a>
<a href=#__codelineno-10-38 id=__codelineno-10-38 name=__codelineno-10-38></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Check for Kubernetes manifests vulnerabilities</span><span class=w></span>
<a href=#__codelineno-10-39 id=__codelineno-10-39 name=__codelineno-10-39></a><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span><span class=w></span>
<a href=#__codelineno-10-40 id=__codelineno-10-40 name=__codelineno-10-40></a><span class=w>          </span><span class=no>snyk iac test \</span><span class=w></span>
<a href=#__codelineno-10-41 id=__codelineno-10-41 name=__codelineno-10-41></a><span class=w>            </span><span class=no>--severity-threshold=${{ github.event.inputs.snyk_fail_threshold || env.SNYK_FAIL_THRESHOLD }} \</span><span class=w></span>
<a href=#__codelineno-10-42 id=__codelineno-10-42 name=__codelineno-10-42></a><span class=w>            </span><span class=no>--target-name=${{ env.PROJECT_NAME }} \</span><span class=w></span>
<a href=#__codelineno-10-43 id=__codelineno-10-43 name=__codelineno-10-43></a><span class=w>            </span><span class=no>--target-reference="kustomize-PR#${{ github.event.pull_request.number }}" \</span><span class=w></span>
<a href=#__codelineno-10-44 id=__codelineno-10-44 name=__codelineno-10-44></a><span class=w>            </span><span class=no>--report</span><span class=w></span>
<a href=#__codelineno-10-45 id=__codelineno-10-45 name=__codelineno-10-45></a><span class=w>        </span><span class=nt>env</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-10-46 id=__codelineno-10-46 name=__codelineno-10-46></a><span class=w>          </span><span class=nt>SNYK_TOKEN</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.SNYK_TOKEN }}</span><span class=w></span>
<a href=#__codelineno-10-47 id=__codelineno-10-47 name=__codelineno-10-47></a><span class=w>        </span><span class=nt>working-directory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kustomize</span><span class=w></span>
<a href=#__codelineno-10-48 id=__codelineno-10-48 name=__codelineno-10-48></a>
<a href=#__codelineno-10-49 id=__codelineno-10-49 name=__codelineno-10-49></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Check for Argo CD manifests vulnerabilities</span><span class=w></span>
<a href=#__codelineno-10-50 id=__codelineno-10-50 name=__codelineno-10-50></a><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span><span class=w></span>
<a href=#__codelineno-10-51 id=__codelineno-10-51 name=__codelineno-10-51></a><span class=w>          </span><span class=no>snyk iac test \</span><span class=w></span>
<a href=#__codelineno-10-52 id=__codelineno-10-52 name=__codelineno-10-52></a><span class=w>            </span><span class=no>--severity-threshold=${{ github.event.inputs.snyk_fail_threshold || env.SNYK_FAIL_THRESHOLD }} \</span><span class=w></span>
<a href=#__codelineno-10-53 id=__codelineno-10-53 name=__codelineno-10-53></a><span class=w>            </span><span class=no>--target-name=${{ env.PROJECT_NAME }} \</span><span class=w></span>
<a href=#__codelineno-10-54 id=__codelineno-10-54 name=__codelineno-10-54></a><span class=w>            </span><span class=no>--target-reference="argocd-PR#${{ github.event.pull_request.number }}" \</span><span class=w></span>
<a href=#__codelineno-10-55 id=__codelineno-10-55 name=__codelineno-10-55></a><span class=w>            </span><span class=no>--report</span><span class=w></span>
<a href=#__codelineno-10-56 id=__codelineno-10-56 name=__codelineno-10-56></a><span class=w>        </span><span class=nt>env</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-10-57 id=__codelineno-10-57 name=__codelineno-10-57></a><span class=w>          </span><span class=nt>SNYK_TOKEN</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.SNYK_TOKEN }}</span><span class=w></span>
<a href=#__codelineno-10-58 id=__codelineno-10-58 name=__codelineno-10-58></a><span class=w>        </span><span class=nt>working-directory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">argocd</span><span class=w></span>
</code></pre></div> </details> </li> <li> <p>Save the workflow file, commit, and push changes to your GitHub repository.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Depending on your setup, you may want to adjust the following environment variables at the top of your workflow file: <div class=highlight><pre><span></span><code><a href=#__codelineno-11-1 id=__codelineno-11-1 name=__codelineno-11-1></a><span class=nt>env</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-11-2 id=__codelineno-11-2 name=__codelineno-11-2></a><span class=w>  </span><span class=nt>PROJECT_NAME</span><span class=p>:</span><span class=w> </span><span class=s>"online-boutique"</span><span class=w></span>
<a href=#__codelineno-11-3 id=__codelineno-11-3 name=__codelineno-11-3></a><span class=w>  </span><span class=nt>SNYK_FAIL_THRESHOLD</span><span class=p>:</span><span class=w> </span><span class=s>"high"</span><span class=w></span>
</code></pre></div></p> </div> </li> </ol> <p>Explanations for the <code>Online Boutique Snyk IAC Scan</code> workflow configuration:</p> <ul> <li><code>on.pull_request</code> - triggers the <code>Online Boutique Snyk IAC Scan</code> workflow on pull request events only.</li> <li><code>on.pull_request.branches</code> - triggers the <code>Online Boutique Snyk IAC Scan</code> workflow whenever a pull request event is detected for the specified list of branches. In this case only <code>main</code> branch is desired.</li> <li><code>on.pull_requests.paths</code> - list of repository paths used for filtering. The <code>Online Boutique Snyk IAC Scan</code> workflow is triggered whenever a change happens for the specified paths. It has to trigger whenever a change happens in the <code>kustomize</code> folder and below (hence the <code>kustomize/**</code> expression), or for <code>argocd</code> folder in the same manner.</li> <li><code>env</code> - sets environment variables to use for the whole pipeline. Usually, environment variables control workflow logic.</li> <li><code>steps</code> - list of steps to execute as part of the workflow jobs. The following list of actions is executed:<ol> <li>Code checkout, via <code>actions/checkout@v3</code>.</li> <li>Kustomize and Argo CD source manifests are scanned via <code>snyk iac test</code> command.</li> <li>The severity threshold is picked either from the designated workflow environment variable, or from the designated input field if it is manually triggered. The manual trigger option is left as an alternative for testing the workflow - it is not triggered under normal circumstances.</li> <li>You also have the possibility to upload scan result reports to the Snyk web portal via the <code>--report</code> flag, but it is not mandatory. Above workkflow has this feature enabled because it helps to identify issues better. Please bear in mind that this feature is available only for IAC scans at this time of writing.</li> </ol> </li> </ul> <p>Following diagram shows a high level overview of <code>Online Boutique Snyk IAC Scan</code> workflow composition:</p> <pre class=mermaid><code>graph LR
A(Source IAC Scan Workflow &lt;br&gt; Start) --&gt; B(Kustomize Manifests Scan)
B --&gt; C(Argo CD Manifests Scan)
C --&gt; L(Source Code Scan Workflow &lt;br&gt; End)</code></pre> <p>Next, you will configure the Snyk GitHub workflow that deals with scanning and detecting vulnerabilities for application Docker containers.</p> <h3 id=docker-containers-scanning>Docker Containers Scanning</h3> <p>The final piece from the supply chain security covered in this guide is related to application containers scanning. Docker is the most popular solution used today so it makes sense to cover this part as well.</p> <p>Follow below steps to configure the Snyk workflow used for application Docker containers scanning (including <code>Dockerfiles</code>):</p> <ol> <li> <p>Clone the <code>microservices-demo</code> repository on your local machine, if not already (make sure to replace the <code>&lt;&gt;</code> placeholders accordingly):</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-12-1 id=__codelineno-12-1 name=__codelineno-12-1></a>git clone https://github.com/&lt;YOUR_GITHUB_ACCOUNT_USERNAME&gt;/microservices-demo.git
</code></pre></div> </li> <li> <p>Change directory to your local copy:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-13-1 id=__codelineno-13-1 name=__codelineno-13-1></a><span class=nb>cd</span> microservices-demo
</code></pre></div> </li> <li> <p>Fetch the <code>online-boutique-snyk-docker-scan.yaml</code> workflow file from the <a href=https://github.com/digitalocean/kubernetes-sample-apps>kubernetes-sample-apps</a> repository:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-14-1 id=__codelineno-14-1 name=__codelineno-14-1></a>curl https://raw.githubusercontent.com/digitalocean/kubernetes-sample-apps/master/.github/workflows/online-boutique-snyk-docker-scan.yaml <span class=se>\</span>
<a href=#__codelineno-14-2 id=__codelineno-14-2 name=__codelineno-14-2></a>  -o .github/workflows/online-boutique-snyk-docker-scan.yaml <span class=se>\</span>
<a href=#__codelineno-14-3 id=__codelineno-14-3 name=__codelineno-14-3></a>  --create-dirs
</code></pre></div> </li> <li> <p>Edit the <code>.github/workflows/online-boutique-snyk-docker-scan.yaml</code> file using a text editor of your choice, preferably with YAML lint support. For example, you can use <a href=https://code.visualstudio.com/ >VS Code</a>:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-15-1 id=__codelineno-15-1 name=__codelineno-15-1></a>code .github/workflows/online-boutique-snyk-docker-scan.yaml
</code></pre></div> </li> <li> <p>Uncomment the lines prefixed with a hash mark at the top of the workflow file. The resulting file should look like:</p> <details class=note> <summary>Click to expand the <code>Online Boutique Snyk Docker Scan</code> workflow file</summary> <div class=highlight><pre><span></span><code><a href=#__codelineno-16-1 id=__codelineno-16-1 name=__codelineno-16-1></a><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Online Boutique Snyk Docker Scan</span><span class=w></span>
<a href=#__codelineno-16-2 id=__codelineno-16-2 name=__codelineno-16-2></a>
<a href=#__codelineno-16-3 id=__codelineno-16-3 name=__codelineno-16-3></a><span class=nt>on</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-16-4 id=__codelineno-16-4 name=__codelineno-16-4></a><span class=w>  </span><span class=nt>pull_request</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-16-5 id=__codelineno-16-5 name=__codelineno-16-5></a><span class=w>    </span><span class=nt>branches</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-16-6 id=__codelineno-16-6 name=__codelineno-16-6></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">main</span><span class=w></span>
<a href=#__codelineno-16-7 id=__codelineno-16-7 name=__codelineno-16-7></a><span class=w>    </span><span class=nt>paths</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-16-8 id=__codelineno-16-8 name=__codelineno-16-8></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>"src/**/Dockerfile"</span><span class=w></span>
<a href=#__codelineno-16-9 id=__codelineno-16-9 name=__codelineno-16-9></a>
<a href=#__codelineno-16-10 id=__codelineno-16-10 name=__codelineno-16-10></a><span class=w>  </span><span class=c1># Below configuration is used for manual workflow dispatch</span><span class=w></span>
<a href=#__codelineno-16-11 id=__codelineno-16-11 name=__codelineno-16-11></a><span class=w>  </span><span class=nt>workflow_dispatch</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-16-12 id=__codelineno-16-12 name=__codelineno-16-12></a><span class=w>    </span><span class=nt>inputs</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-16-13 id=__codelineno-16-13 name=__codelineno-16-13></a><span class=w>      </span><span class=nt>snyk_fail_threshold</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-16-14 id=__codelineno-16-14 name=__codelineno-16-14></a><span class=w>        </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span><span class=w></span>
<a href=#__codelineno-16-15 id=__codelineno-16-15 name=__codelineno-16-15></a><span class=w>          </span><span class=no>Sets fail threshold for Snyk </span><span class=w></span>
<a href=#__codelineno-16-16 id=__codelineno-16-16 name=__codelineno-16-16></a><span class=w>          </span><span class=no>(low | medium | high | critical)</span><span class=w></span>
<a href=#__codelineno-16-17 id=__codelineno-16-17 name=__codelineno-16-17></a><span class=w>        </span><span class=nt>required</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class=w></span>
<a href=#__codelineno-16-18 id=__codelineno-16-18 name=__codelineno-16-18></a><span class=w>        </span><span class=nt>default</span><span class=p>:</span><span class=w> </span><span class=s>"high"</span><span class=w></span>
<a href=#__codelineno-16-19 id=__codelineno-16-19 name=__codelineno-16-19></a>
<a href=#__codelineno-16-20 id=__codelineno-16-20 name=__codelineno-16-20></a><span class=nt>env</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-16-21 id=__codelineno-16-21 name=__codelineno-16-21></a><span class=w>  </span><span class=nt>DOCR_ENDPOINT</span><span class=p>:</span><span class=w> </span><span class=s>"registry.digitalocean.com/microservices-demo"</span><span class=w></span>
<a href=#__codelineno-16-22 id=__codelineno-16-22 name=__codelineno-16-22></a><span class=w>  </span><span class=nt>PROJECT_NAME</span><span class=p>:</span><span class=w> </span><span class=s>"online-boutique"</span><span class=w></span>
<a href=#__codelineno-16-23 id=__codelineno-16-23 name=__codelineno-16-23></a><span class=w>  </span><span class=nt>SNYK_FAIL_THRESHOLD</span><span class=p>:</span><span class=w> </span><span class=s>"high"</span><span class=w></span>
<a href=#__codelineno-16-24 id=__codelineno-16-24 name=__codelineno-16-24></a>
<a href=#__codelineno-16-25 id=__codelineno-16-25 name=__codelineno-16-25></a><span class=nt>jobs</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-16-26 id=__codelineno-16-26 name=__codelineno-16-26></a><span class=w>  </span><span class=nt>container-security-check</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-16-27 id=__codelineno-16-27 name=__codelineno-16-27></a><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span><span class=w></span>
<a href=#__codelineno-16-28 id=__codelineno-16-28 name=__codelineno-16-28></a><span class=w>    </span><span class=nt>strategy</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-16-29 id=__codelineno-16-29 name=__codelineno-16-29></a><span class=w>      </span><span class=nt>fail-fast</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class=w></span>
<a href=#__codelineno-16-30 id=__codelineno-16-30 name=__codelineno-16-30></a><span class=w>      </span><span class=nt>matrix</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-16-31 id=__codelineno-16-31 name=__codelineno-16-31></a><span class=w>        </span><span class=nt>project</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-16-32 id=__codelineno-16-32 name=__codelineno-16-32></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">cartservice</span><span class=w></span>
<a href=#__codelineno-16-33 id=__codelineno-16-33 name=__codelineno-16-33></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">checkoutservice</span><span class=w></span>
<a href=#__codelineno-16-34 id=__codelineno-16-34 name=__codelineno-16-34></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">currencyservice</span><span class=w></span>
<a href=#__codelineno-16-35 id=__codelineno-16-35 name=__codelineno-16-35></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">emailservice</span><span class=w></span>
<a href=#__codelineno-16-36 id=__codelineno-16-36 name=__codelineno-16-36></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">frontend</span><span class=w></span>
<a href=#__codelineno-16-37 id=__codelineno-16-37 name=__codelineno-16-37></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">paymentservice</span><span class=w></span>
<a href=#__codelineno-16-38 id=__codelineno-16-38 name=__codelineno-16-38></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">productcatalogservice</span><span class=w></span>
<a href=#__codelineno-16-39 id=__codelineno-16-39 name=__codelineno-16-39></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">recommendationservice</span><span class=w></span>
<a href=#__codelineno-16-40 id=__codelineno-16-40 name=__codelineno-16-40></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">shippingservice</span><span class=w></span>
<a href=#__codelineno-16-41 id=__codelineno-16-41 name=__codelineno-16-41></a><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-16-42 id=__codelineno-16-42 name=__codelineno-16-42></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Checkout</span><span class=w></span>
<a href=#__codelineno-16-43 id=__codelineno-16-43 name=__codelineno-16-43></a><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span><span class=w></span>
<a href=#__codelineno-16-44 id=__codelineno-16-44 name=__codelineno-16-44></a><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-16-45 id=__codelineno-16-45 name=__codelineno-16-45></a><span class=w>          </span><span class=nt>ref</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${{ github.event.pull_request.head.ref }}</span><span class=w></span>
<a href=#__codelineno-16-46 id=__codelineno-16-46 name=__codelineno-16-46></a><span class=w>          </span><span class=nt>repository</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${{ github.event.pull_request.head.repo.full_name }}</span><span class=w></span>
<a href=#__codelineno-16-47 id=__codelineno-16-47 name=__codelineno-16-47></a>
<a href=#__codelineno-16-48 id=__codelineno-16-48 name=__codelineno-16-48></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Install Snyk</span><span class=w></span>
<a href=#__codelineno-16-49 id=__codelineno-16-49 name=__codelineno-16-49></a><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">snyk/actions/setup@master</span><span class=w></span>
<a href=#__codelineno-16-50 id=__codelineno-16-50 name=__codelineno-16-50></a>
<a href=#__codelineno-16-51 id=__codelineno-16-51 name=__codelineno-16-51></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Build app image for Snyk container scanning</span><span class=w></span>
<a href=#__codelineno-16-52 id=__codelineno-16-52 name=__codelineno-16-52></a><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">docker/build-push-action@v3</span><span class=w></span>
<a href=#__codelineno-16-53 id=__codelineno-16-53 name=__codelineno-16-53></a><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-16-54 id=__codelineno-16-54 name=__codelineno-16-54></a><span class=w>          </span><span class=c1># Cartservice is an exception - Dockerfile is placed in `src/cartservice/src` subfolder</span><span class=w></span>
<a href=#__codelineno-16-55 id=__codelineno-16-55 name=__codelineno-16-55></a><span class=w>          </span><span class=nt>context</span><span class=p>:</span><span class=w> </span><span class=s>"src/${{</span><span class=nv> </span><span class=s>matrix.project</span><span class=nv> </span><span class=s>}}/${{</span><span class=nv> </span><span class=s>matrix.project</span><span class=nv> </span><span class=s>==</span><span class=nv> </span><span class=s>'cartservice'</span><span class=nv> </span><span class=s>&amp;&amp;</span><span class=nv> </span><span class=s>'src'</span><span class=nv> </span><span class=s>||</span><span class=nv> </span><span class=s>''}}"</span><span class=w></span>
<a href=#__codelineno-16-56 id=__codelineno-16-56 name=__codelineno-16-56></a><span class=w>          </span><span class=nt>push</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class=w></span>
<a href=#__codelineno-16-57 id=__codelineno-16-57 name=__codelineno-16-57></a><span class=w>          </span><span class=nt>tags</span><span class=p>:</span><span class=w> </span><span class=s>"${{</span><span class=nv> </span><span class=s>env.DOCR_ENDPOINT</span><span class=nv> </span><span class=s>}}/${{</span><span class=nv> </span><span class=s>matrix.project</span><span class=nv> </span><span class=s>}}:${{</span><span class=nv> </span><span class=s>github.event.pull_request.head.sha</span><span class=nv> </span><span class=s>}}"</span><span class=w></span>
<a href=#__codelineno-16-58 id=__codelineno-16-58 name=__codelineno-16-58></a>
<a href=#__codelineno-16-59 id=__codelineno-16-59 name=__codelineno-16-59></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Check application container vulnerabilities</span><span class=w></span>
<a href=#__codelineno-16-60 id=__codelineno-16-60 name=__codelineno-16-60></a><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span><span class=w></span>
<a href=#__codelineno-16-61 id=__codelineno-16-61 name=__codelineno-16-61></a><span class=w>          </span><span class=no># Cartservice is an exception regarding project layout</span><span class=w></span>
<a href=#__codelineno-16-62 id=__codelineno-16-62 name=__codelineno-16-62></a><span class=w>          </span><span class=no># It uses a nested src subfolder - `src/cartservice/src`</span><span class=w></span>
<a href=#__codelineno-16-63 id=__codelineno-16-63 name=__codelineno-16-63></a><span class=w>          </span><span class=no>if [[ "${{ matrix.project }}" == "cartservice" ]]; then</span><span class=w></span>
<a href=#__codelineno-16-64 id=__codelineno-16-64 name=__codelineno-16-64></a><span class=w>            </span><span class=no>cd src/</span><span class=w></span>
<a href=#__codelineno-16-65 id=__codelineno-16-65 name=__codelineno-16-65></a><span class=w>          </span><span class=no>fi</span><span class=w></span>
<a href=#__codelineno-16-66 id=__codelineno-16-66 name=__codelineno-16-66></a><span class=w>          </span><span class=no>snyk container test "${{ env.DOCR_ENDPOINT }}/${{ matrix.project }}:${{ github.event.pull_request.head.sha }}" \</span><span class=w></span>
<a href=#__codelineno-16-67 id=__codelineno-16-67 name=__codelineno-16-67></a><span class=w>            </span><span class=no>--file=Dockerfile \</span><span class=w></span>
<a href=#__codelineno-16-68 id=__codelineno-16-68 name=__codelineno-16-68></a><span class=w>            </span><span class=no>--severity-threshold=${{ github.event.inputs.snyk_fail_threshold || env.SNYK_FAIL_THRESHOLD }} \</span><span class=w></span>
<a href=#__codelineno-16-69 id=__codelineno-16-69 name=__codelineno-16-69></a><span class=w>            </span><span class=no>--target-name=${{ env.PROJECT_NAME }} \</span><span class=w></span>
<a href=#__codelineno-16-70 id=__codelineno-16-70 name=__codelineno-16-70></a><span class=w>            </span><span class=no>--target-reference=${{ matrix.project }}</span><span class=w></span>
<a href=#__codelineno-16-71 id=__codelineno-16-71 name=__codelineno-16-71></a><span class=w>        </span><span class=nt>env</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-16-72 id=__codelineno-16-72 name=__codelineno-16-72></a><span class=w>          </span><span class=nt>SNYK_TOKEN</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.SNYK_TOKEN }}</span><span class=w></span>
<a href=#__codelineno-16-73 id=__codelineno-16-73 name=__codelineno-16-73></a><span class=w>        </span><span class=nt>working-directory</span><span class=p>:</span><span class=w> </span><span class=s>"src/${{</span><span class=nv> </span><span class=s>matrix.project</span><span class=nv> </span><span class=s>}}"</span><span class=w></span>
</code></pre></div> </details> </li> <li> <p>Save the workflow file, commit, and push changes to your GitHub repository.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Depending on your setup, you may want to adjust the following environment variables at the top of your workflow file: <div class=highlight><pre><span></span><code><a href=#__codelineno-17-1 id=__codelineno-17-1 name=__codelineno-17-1></a><span class=nt>env</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-17-2 id=__codelineno-17-2 name=__codelineno-17-2></a><span class=w>  </span><span class=nt>DOCR_ENDPOINT</span><span class=p>:</span><span class=w> </span><span class=s>"registry.digitalocean.com/&lt;YOUR_REGISTRY_NAME_HERE&gt;"</span><span class=w></span>
<a href=#__codelineno-17-3 id=__codelineno-17-3 name=__codelineno-17-3></a><span class=w>  </span><span class=nt>PROJECT_NAME</span><span class=p>:</span><span class=w> </span><span class=s>"online-boutique"</span><span class=w></span>
<a href=#__codelineno-17-4 id=__codelineno-17-4 name=__codelineno-17-4></a><span class=w>  </span><span class=nt>SNYK_FAIL_THRESHOLD</span><span class=p>:</span><span class=w> </span><span class=s>"high"</span><span class=w></span>
</code></pre></div></p> </div> </li> </ol> <p>Explanations for the <code>Online Boutique Snyk Docker Scan</code> workflow configuration:</p> <ul> <li><code>on.pull_request</code> - triggers the <code>Online Boutique Snyk Docker Scan</code> workflow on pull request events only.</li> <li><code>on.pull_request.branches</code> - triggers the <code>Online Boutique Snyk Docker Scan</code> workflow whenever a pull request event is detected for the specified list of branches. In this case only <code>main</code> branch is desired.</li> <li><code>on.pull_requests.paths</code> - list of repository paths used for filtering. The <code>Online Boutique Snyk Docker Scan</code> workflow is triggered whenever a change happens for the specified paths. It has to trigger whenever a change happens in the <code>Dockerfile</code> of each microservice from the <code>src</code> folder (hence the <code>src/**/Dockerfile</code> expression).</li> <li><code>env</code> - sets environment variables to use for the whole pipeline. Usually, environment variables control workflow logic.</li> <li><code>steps</code> - list of steps to execute as part of the workflow jobs. The following list of actions is executed:<ol> <li>Code checkout, via <code>actions/checkout@v3</code>.</li> <li>Each microservice container is built and scanned used <code>snyk container test</code> command. The container scan process uses each microservice <code>Dockerfile</code> as a reference.</li> <li>The severity threshold is picked either from the designated workflow environment variable, or from the designated input field if it is manually triggered. The manual trigger option is left as an alternative for testing the workflow - it is not triggered under normal circumstances.</li> </ol> </li> </ul> <p>Following diagram shows a high level overview of <code>Online Boutique Snyk Docker Scan</code> workflow composition:</p> <pre class=mermaid><code>graph LR
A(Container Scan Workflow &lt;br&gt; Start) --&gt; B(Snyk Scan Matrix)
B --&gt; C(Cart Service &lt;br&gt; Container Scan)
B --&gt; D(Checkout Service &lt;br&gt; Container Scan)
B --&gt; E(Currency Service &lt;br&gt; Container Scan)
B --&gt; F(Email Service &lt;br&gt; Container Scan)
B --&gt; G(Frontend Container Scan)
B --&gt; H(Payment Service &lt;br&gt; Container Scan)
B --&gt; I(Product Catalog Service &lt;br&gt; Container Scan)
B --&gt; J(Recommendation Service &lt;br&gt; Container Scan)
B --&gt; K(Shipping Service &lt;br&gt; Container Scan)
C &amp; D &amp; E &amp; F &amp; G &amp; H &amp; I &amp; J &amp; K --&gt; L(Container Scan Workflow &lt;br&gt; End)</code></pre> <p>Next, you will discover how to benefit from the Snyk workflows created so far, and then how to investigate and fix some of the reported security issues.</p> <h2 id=testing-the-final-setup>Testing the Final Setup</h2> <p>To test each Snyk workflow a few PRs are required first, each dealing with a specific area of interest. As seen in previous sections, each Snyk workflow is responsible with scanning a specific area of the Kubernetes supply chain:</p> <ol> <li>Application source code and 3rd party artifacts (such as external libraries).</li> <li>Kubernetes manifests (Kustomize and Argo CD).</li> <li>Docker containers and associated Dockerfiles.</li> </ol> <p>Next, each area of interest is touched briefly with the accompanying examples and explanations.</p> <h3 id=inspecting-and-fixing-application-source-code-vulnerabilities>Inspecting and Fixing Application Source Code Vulnerabilities</h3> <p>Testing the Snyk workflow responsible with detecting application source code vulnerabilities implies the following:</p> <ol> <li>Create a PR addressing source code changes for one (or multiple) application components. For example, change some of the header of footer HTML templates from the frontend component.</li> <li> <p>Verify PR checks window - should show both main PR and Snyk application source code scan workflows running in parallel:</p> <p><a class=glightbox data-desc-position=bottom data-description data-height=auto data-title data-width=100% href=../assets/images/snyk_ci_pr.png><img alt="Snyk PR Workflow Trigger" src=../assets/images/snyk_ci_pr.png></a></p> </li> <li> <p>Watch closely the Snyk application source code scan workflow as it progresses:</p> <p><a class=glightbox data-desc-position=bottom data-description data-height=auto data-title data-width=100% href=../assets/images/snyk_ci_progress.png><img alt="Snyk PR Workflow Progress" src=../assets/images/snyk_ci_progress.png></a></p> </li> </ol> <p>After the Snyk application source code scan workflow finishes you should see if and how each microservice is affected. Below example shows the list of issues reported for the frontend microservice:</p> <p><a class=glightbox data-desc-position=bottom data-description data-height=auto data-title data-width=100% href=../assets/images/snyk_ci_reported_issues.png><img alt="Snyk PR Reported Issues" src=../assets/images/snyk_ci_reported_issues.png></a></p> <p>You will receive some explanations and hints regarding the line of code that imposes a security risk, as well as why it is considered an issue and a possible fix (if it is known). Next, it is the responsibility of the developer to consult with the team and management, and decide if the highlighted issue o(r set of issues) is really a threat. There are situations when it's safe to <a href=https://support.snyk.io/hc/en-us/articles/360000923498-How-can-I-ignore-a-vulnerability->ignore some of the reported issues</a> and add them to the exceptions list.</p> <p>After a decision was made, you either mark the issue(s) as an exception, or proceed and create a set of fixes for the current PR. Push changes, and if everything goes well the workflow checks should pass.</p> <div class="admonition tip"> <p class=admonition-title>Tip</p> <p>To avoid many iterations and thus reducing wait time for each PR, you should benefit from the IDE integration that Snyk offers. This is the first and most important best practice explained in this chapter.</p> </div> <h3 id=inspecting-and-fixing-iac-vulnerabilities>Inspecting and Fixing IAC Vulnerabilities</h3> <p>The process of inspecting and fixing IAC manifests is similar to previous section except that in this case only Kubernetes manifests are scanned. Whenever you open a PR containing changes for the <code>kustomize</code> and/or <code>argocd</code> subfolder, the Snyk IAC scan workflow is automatically triggered.</p> <p>You also get a report in the Snyk web portal that looks like below (after navigating to the projects page):</p> <p><a class=glightbox data-desc-position=bottom data-description data-height=auto data-title data-width=100% href=../assets/images/snyk_iac_project_scan.png><img alt="Snyk IAC Project Scan Results" src=../assets/images/snyk_iac_project_scan.png></a></p> <p>In the above example only a low severity issue is reported. Nevertheless, after expanding <code>kustomize-PR#&lt;YOUR_PR_NUMBER&gt;</code> reports, click on the <code>base/redis.yaml</code> manifest. You should see the following low severity issue reported:</p> <p><a class=glightbox data-desc-position=bottom data-description data-height=auto data-title data-width=100% href=../assets/images/snyk_iac_scan_issue.png><img alt="Snyk IAC Scan Reported Issue" src=../assets/images/snyk_iac_scan_issue.png></a></p> <h3 id=inspecting-and-fixing-docker-containers-vulnerabilities>Inspecting and Fixing Docker Containers Vulnerabilities</h3> <p>Whenever a PR is created containing changes for each microservice Dockerfile, then the associated <code>Online Boutique Snyk Docker Scan</code> workflow is triggered. Below is a sample screenshot about how it looks in practice:</p> <p><a class=glightbox data-desc-position=bottom data-description data-height=auto data-title data-width=100% href=../assets/images/snyk_docker_scan_progress.png><img alt="Snyk Docker Scan Progress" src=../assets/images/snyk_docker_scan_progress.png></a></p> <p>By clicking on one of the scans, you will get additional details about discovered issues:</p> <p><a class=glightbox data-desc-position=bottom data-description data-height=auto data-title data-width=100% href=../assets/images/snyk_docker_scan_results.png><img alt="Snyk Docker Scan Results" src=../assets/images/snyk_docker_scan_results.png></a></p> <p>The process of addressing Docker issues goes the same way as with the previously discussed ones.</p> <h2 id=configuring-snyk-for-docker-registry-scanning>Configuring Snyk for Docker Registry Scanning</h2> <p>Snyk also offers support for various integrations such as DigitalOcean Container Registry, aka DOCR. Integrating your DOCR with Snyk offers the possibility to continuously monitor and get notified about newly disclosed vulnerabilities for each container you use to deploy your applications.</p> <p>This is different from continuously scanning and validating project artifacts on each pull request. The pull request is validated and it's approved at a specific point in time, but this doesn't mean the deployed artifacts are still safe in the near future.</p> <p>Follow below steps to enable this feature:</p> <ol> <li> <p>Log in to your Snyk portal, and navigate to the <code>Integrations</code> menu from the left. Scroll down the page untill you see the <code>Container registries</code> section:</p> <p><a class=glightbox data-desc-position=bottom data-description data-height=auto data-title data-width=100% href=../assets/images/snyk_cr_integrations_page.png><img alt="Snyk CR Integrations" src=../assets/images/snyk_cr_integrations_page.png></a></p> </li> <li> <p>Click on the <code>DigitalOcean</code> tile. In the next page, enter your DO API token, and hit save.</p> </li> <li> <p>Finally, select your project images you want to monitor continuously via Snyk:</p> <p><a class=glightbox data-desc-position=bottom data-description data-height=auto data-title data-width=100% href=../assets/images/snyk_docr_select_images_to_scan.png><img alt="Select Images to Monitor via Snyk" src=../assets/images/snyk_docr_select_images_to_scan.png></a></p> </li> </ol> <p>After clicking the <code>Add Selected Images</code> button at the top you should be ready to go. From now on you will receive periodic emails informing you about newly disclosed vulnerabilities for the selected application containers.</p> <h2 id=continuous-monitoring-of-applications>Continuous Monitoring of Applications</h2> <p>Just as with Docker, Snyk offers another feature for continuously monitoring your applications before each deployment. The Snyk CLI offers this feature via the <code>snyk monitor</code> command. It uploads a snapshot of your app to the Snyk portal. Then, whenever a new vulnerability is disclosed, you will get notified via email.</p> <p>This approach has a major benefit over existing PR checks because new vulnerabilities are disclosed periodically, so you will be always up to date with your project.</p> <p>You will find more information about this feature <a href=https://docs.snyk.io/integrations/ci-cd-integrations/snyk-ci-cd-integration-deployment-and-strategies/snyk-test-and-snyk-monitor-in-ci-cd-integration>here</a>.</p> <h2 id=configuring-slack-notifications>Configuring Slack Notifications</h2> <p>You can set up Snyk to send Slack alerts about new vulnerabilities discovered in your projects, and about new upgrades or patches that have become available.</p> <p>To set it up, you will need to generate a Slack webhook. You can either do this via <a href=https://api.slack.com/messaging/webhooks>Incoming WebHooks</a> or by creating your own <a href=https://api.slack.com/start/building>Slack App</a>. Once you have generated your Slack Webhook URL, go to your <code>Manage organization</code> settings, enter the URL, and click the <code>Connect</code> button:</p> <p><a class=glightbox data-desc-position=bottom data-description data-height=auto data-title data-width=100% href=../assets/images/slack_notifications.png><img alt="Snyk Slack Notifications" src=../assets/images/slack_notifications.png></a></p> <h2 id=additional-best-practices-and-resources>Additional Best Practices and Resources</h2> <p>Although the workflows presented in this guide should give you a good starting point, they may be not so perfect. For example, when working on microservices based projects, each developer works on microservice or on a set of microservices. The workflows presented in this chapter don't have builtin logic to deal with scanning only microservices that actually change between each iteration for the main project. The Snyk workflows presented here trigger and scan all the microservices at once each time. If the company or the team behind the main project decides to allocate a developer per microservice then it makes sense to isolate and trigger each Snyk scan per microservice based on which one has changed.</p> <p>There are two possible ways of achieving this:</p> <ol> <li>Leave the Snyk application source code scan workflow as is and use a GitHub action that detects which files changed from the <code>src</code> folder. Then, for each job in the matrix representing each microservice, add a condition to skip it or not based on the set of files that changed.</li> <li>Split the Snyk workflow in multiple workflows for each microservice. Then, filter using the <code>paths</code> field from the <code>on.pull_request</code> event trigger.</li> </ol> <p>Learn more by reading the following additional resources:</p> <ul> <li><a href=https://github.com/digitalocean/container-blueprints/tree/main/DOKS-supply-chain-security>DigitalOcean Supply Chain Security Guides</a></li> <li><a href=https://snyk.io/learn/kubernetes-security/ >Kubernetes Security Best Practices Article from Snyk</a></li> <li><a href=https://docs.snyk.io/introducing-snyk/snyks-core-concepts/severity-levels>More about Snyk Security Levels</a></li> <li><a href=https://snyk.io/learn/vulnerability-assessment/ >Vulnerability Assessment</a></li> <li><a href=https://docs.snyk.io/introducing-snyk/introduction-to-snyk-projects>Snyk Targets and Projects</a></li> <li><a href=https://docs.snyk.io/ide-tools>Snyk for IDEs</a></li> <li><a href=https://docs.snyk.io/integrations>Discover more Snyk Integrations</a></li> <li><a href=https://docs.snyk.io/features/user-and-group-management>Snyk Portal Users and Group Management</a></li> <li><a href=https://docs.snyk.io/features/fixing-and-prioritizing-issues>Fixing and Prioritizing Issues Reported by Snyk</a></li> <li><a href=https://github.com/snyk/actions>Snyk Github Action Used in this Guide</a></li> </ul> </article> </div> </div> </main> <footer class=md-footer> <nav aria-label=Footer class="md-footer__inner md-grid"> <a aria-label="Previous: Promote releases to upper environments" class="md-footer__link md-footer__link--prev" href=../../06-promote-releases/promote-releases-to-upper-envs/ rel=prev> <div class="md-footer__button md-icon"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Promote releases to upper environments </div> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> DigitalOcean </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ rel=noopener target=_blank> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script> <script src=../../assets/javascripts/bundle.d6c3db9e.min.js></script> <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom"});})</script></body> </html>