<!DOCTYPE html><html class=no-js lang=en> <head><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><meta content="Hands-on tutorial for going from day-1 to production on DigitalOcean Kubernetes." name=description><link href=https://digitalocean.github.io/k8s-adoption-journey/05-ci-cd/setup-continuous-integration/ rel=canonical><link href=../../assets/images/favicon.png rel=icon><meta content="mkdocs-1.4.0, mkdocs-material-8.5.8" name=generator><title>Set up continuous integration - Kubernetes Adoption Journey</title><link href=../../assets/stylesheets/main.20d9efc8.min.css rel=stylesheet><link href=../../assets/stylesheets/palette.815d1a91.min.css rel=stylesheet><link crossorigin href=https://fonts.gstatic.com rel=preconnect><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback" rel=stylesheet><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><link href=../../assets/stylesheets/glightbox.min.css rel=stylesheet><style>
            html.glightbox-open { overflow: initial; height: 100%; }
            .gdesc-inner { font-size: 0.75rem; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            
                .gscrollbar-fixer { padding-right: 15px; }
                </style><script src=../../assets/javascripts/glightbox.min.js></script></head> <body data-md-color-accent data-md-color-primary data-md-color-scheme=default dir=ltr> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input autocomplete=off class=md-toggle data-md-toggle=drawer id=__drawer type=checkbox> <input autocomplete=off class=md-toggle data-md-toggle=search id=__search type=checkbox> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a class=md-skip href=#introduction> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav aria-label=Header class="md-header__inner md-grid"> <a aria-label="Kubernetes Adoption Journey" class="md-header__button md-logo" data-md-component=logo href=../.. title="Kubernetes Adoption Journey"> <img alt=logo src=../../assets/do_logo.png> </a> <label class="md-header__button md-icon" for=__drawer> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Kubernetes Adoption Journey </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Set up continuous integration </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input aria-label="Switch to dark mode" class=md-option data-md-color-accent data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary data-md-color-scheme=default id=__palette_1 name=__palette type=radio> <label class="md-header__button md-icon" for=__palette_2 hidden title="Switch to dark mode"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"></path></svg> </label> <input aria-label="Switch to light mode" class=md-option data-md-color-accent data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary data-md-color-scheme=slate id=__palette_2 name=__palette type=radio> <label class="md-header__button md-icon" for=__palette_1 hidden title="Switch to light mode"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 18a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-2.69L23.31 12 20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69Z"></path></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input aria-label=Search autocapitalize=off autocomplete=off autocorrect=off class=md-search__input data-md-component=search-query name=query placeholder=Search required spellcheck=false type=text> <label class="md-search__icon md-icon" for=__search> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg> </label> <nav aria-label=Search class=md-search__options> <button aria-label=Clear class="md-search__icon md-icon" tabindex=-1 title=Clear type=reset> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a class=md-source data-md-component=source href=https://github.com/digitalocean/k8s-adoption-journey title="Go to repository"> <div class="md-source__icon md-icon"> <svg viewbox="0 0 448 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav aria-label=Navigation class="md-nav md-nav--primary" data-md-level=0> <label class=md-nav__title for=__drawer> <a aria-label="Kubernetes Adoption Journey" class="md-nav__button md-logo" data-md-component=logo href=../.. title="Kubernetes Adoption Journey"> <img alt=logo src=../../assets/do_logo.png> </a> Kubernetes Adoption Journey </label> <div class=md-nav__source> <a class=md-source data-md-component=source href=https://github.com/digitalocean/k8s-adoption-journey title="Go to repository"> <div class="md-source__icon md-icon"> <svg viewbox="0 0 448 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=../..> Intro </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 id=__nav_2 type=checkbox> <label class=md-nav__link for=__nav_2> Getting started <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Getting started" class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Getting started </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../01-getting-started/installing-required-tools/ class=md-nav__link> Installing required tools </a> </li> <li class=md-nav__item> <a href=../../01-getting-started/do-api-auth/ class=md-nav__link> Authenticating with the DigitalOcean API </a> </li> <li class=md-nav__item> <a href=../../01-getting-started/setup-docr/ class=md-nav__link> Set up a Digital Ocean container registry </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_4 id=__nav_2_4 type=checkbox> <label class=md-nav__link for=__nav_2_4> Preparing the demo application <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Preparing the demo application" class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_2_4> <span class="md-nav__icon md-icon"></span> Preparing the demo application </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../01-getting-started/building-and-pushing-docker-images/introduction-and-repository-setup/ class=md-nav__link> Repository setup </a> </li> <li class=md-nav__item> <a href=../../01-getting-started/building-and-pushing-docker-images/building-and-pushing-images-using-docker/ class=md-nav__link> Building and pushing images with Docker </a> </li> <li class=md-nav__item> <a href=../../01-getting-started/building-and-pushing-docker-images/building-and-pushing-images-using-cnb/ class=md-nav__link> Building and pushing images with Cloud Native Buildpacks </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 id=__nav_3 type=checkbox> <label class=md-nav__link for=__nav_3> Development environment <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Development environment" class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Development environment </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../02-development/setup-doks-dev/ class=md-nav__link> Set up Development DOKS </a> </li> <li class=md-nav__item> <a href=../../02-development/tilt-local/ class=md-nav__link> Tilt for local development </a> </li> <li class=md-nav__item> <a href=../../02-development/tilt-remote/ class=md-nav__link> Tilt for remote development </a> </li> <li class=md-nav__item> <a href=../../02-development/setup-ingress-dev/ class=md-nav__link> Set up ingress </a> </li> <li class=md-nav__item> <a href=../../02-development/observability-dev/ class=md-nav__link> Observability </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 id=__nav_4 type=checkbox> <label class=md-nav__link for=__nav_4> Staging environment <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Staging environment" class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Staging environment </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../03-staging/setup-doks-staging/ class=md-nav__link> Set up Staging DOKS </a> </li> <li class=md-nav__item> <a href=../../03-staging/deploying-the-online-boutique-sample-application-staging/ class=md-nav__link> Deploying the online boutique sample application </a> </li> <li class=md-nav__item> <a href=../../03-staging/setup-ingress-staging/ class=md-nav__link> Set up ingress </a> </li> <li class=md-nav__item> <a href=../../03-staging/observability-staging/ class=md-nav__link> Observability </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 id=__nav_5 type=checkbox> <label class=md-nav__link for=__nav_5> Production environment <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Production environment" class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Production environment </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../04-production/setup-doks-production/ class=md-nav__link> Set up Production DOKS </a> </li> <li class=md-nav__item> <a href=../../04-production/deploying-the-online-boutique-sample-application-production/ class=md-nav__link> Deploying the online boutique sample application </a> </li> <li class=md-nav__item> <a href=../../04-production/setup-ingress-production/ class=md-nav__link> Set up ingress </a> </li> <li class=md-nav__item> <a href=../../04-production/observability-production/ class=md-nav__link> Observability </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input checked class="md-nav__toggle md-toggle" data-md-toggle=__nav_6 id=__nav_6 type=checkbox> <label class=md-nav__link for=__nav_6> Continuous integration and deployments <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Continuous integration and deployments" class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Continuous integration and deployments </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc id=__toc type=checkbox> <label class="md-nav__link md-nav__link--active" for=__toc> Set up continuous integration <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Set up continuous integration </a> <nav aria-label="Table of contents" class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=#introduction> Introduction </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#prerequisites> Prerequisites </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#online-boutique-application-ci-flows-configuration> Online Boutique Application CI Flows Configuration </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#configuring-pull-requests-workflow> Configuring Pull Requests Workflow </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#configuring-main-branch-workflow> Configuring Main Branch Workflow </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#infrastructure-manifests-validation-github-workflow> Infrastructure Manifests Validation GitHub Workflow </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#testing-the-online-boutique-application-github-workflows> Testing the Online Boutique Application GitHub Workflows </a> <nav aria-label="Testing the Online Boutique Application GitHub Workflows" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#testing-the-pull-requests-workflow> Testing the Pull Requests Workflow </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#testing-the-main-branch-workflow> Testing the Main Branch Workflow </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#testing-the-infra-manifests-github-workflow> Testing the Infra Manifests GitHub Workflow </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#additional-best-practices> Additional Best Practices </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../setup-continuous-deployments/ class=md-nav__link> Set up continuous deployments </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7 id=__nav_7 type=checkbox> <label class=md-nav__link for=__nav_7> Promote releases <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Promote releases" class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Promote releases </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../06-promote-releases/setup-release-process/ class=md-nav__link> Set up release process </a> </li> <li class=md-nav__item> <a href=../../06-promote-releases/promote-releases-to-upper-envs/ class=md-nav__link> Promote releases to upper environments </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_8 id=__nav_8 type=checkbox> <label class=md-nav__link for=__nav_8> Security <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Security class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> Security </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../07-security/software-supply-chain/ class=md-nav__link> Securing the software supply chain </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav aria-label="Table of contents" class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=#introduction> Introduction </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#prerequisites> Prerequisites </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#online-boutique-application-ci-flows-configuration> Online Boutique Application CI Flows Configuration </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#configuring-pull-requests-workflow> Configuring Pull Requests Workflow </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#configuring-main-branch-workflow> Configuring Main Branch Workflow </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#infrastructure-manifests-validation-github-workflow> Infrastructure Manifests Validation GitHub Workflow </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#testing-the-online-boutique-application-github-workflows> Testing the Online Boutique Application GitHub Workflows </a> <nav aria-label="Testing the Online Boutique Application GitHub Workflows" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#testing-the-pull-requests-workflow> Testing the Pull Requests Workflow </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#testing-the-main-branch-workflow> Testing the Main Branch Workflow </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#testing-the-infra-manifests-github-workflow> Testing the Infra Manifests GitHub Workflow </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#additional-best-practices> Additional Best Practices </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a class="md-content__button md-icon" href=https://github.com/digitalocean/k8s-adoption-journey/edit/master/docs/05-ci-cd/setup-continuous-integration.md title="Edit this page"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"></path></svg> </a> <h1>Set up continuous integration</h1> <h2 id=introduction>Introduction</h2> <p>Continuous integration, or CI for short, is the ongoing process of continuously integrating code into the main or active development branch of a Git repository. Usually, each developer works on a piece of code dealing with a specific functionality. In the end, all pieces merge together via the CI process, thus creating the final product.</p> <p>One typical Git flow is depicted below:</p> <pre class=mermaid><code>gitGraph
  commit
  commit
  branch feature1
  checkout feature1
  commit
  commit
  checkout main
  branch feature2
  checkout feature2
  commit
  commit
  commit
  checkout main
  merge feature1 id: "PR merge feature1" tag: "NEW TAG - v1.0.0" type: HIGHLIGHT
  commit
  checkout feature2
  merge main
  checkout main
  merge feature2 id: "PR merge feature2" tag: "NEW TAG - v1.0.1" type: HIGHLIGHT
  commit</code></pre> <p>The Git flow used in this guide is a simple one - no release branches, no feature branches, etc. It's just the main branch and release tags. Of course, each developer will work in the end on a feature, fixing a bug, etc, so a dedicated branch gets created. But, in the end everything is merged into the main branch via pull requests. There is a list of reviewers which is automatically assigned, as well as automated workflows to automatically validate or invalidate PRs.</p> <p>Then, when a certain amount of bug fixes and/or proposed features are merged in, the owner (or the project manager) of the application repository creates a release. This is a separate process and requires manual intervention from designated team members. In the release process, a new version and tag is created (using semantic versioning), as well as the accompanying changelog (or release notes).</p> <p>GitHub is the most popular solution for collaborative work, sharing open source ideas, and storing application code. It is more than just a frontend for the most reliable source code management tool - <a href=https://git-scm.com/ >Git</a>. It also empowers issue tracking, project management, and most important of all - CI automation. GitHub offers <a href=https://docs.github.com/en/actions>actions</a> and <a href=https://docs.github.com/en/actions/using-workflows>workflows</a> to help you achieve this goal, hence it's a very good candidate.</p> <p>In this section, you will learn how to leverage the power of GitHub actions to implement the CI process required by the online boutique sample application.</p> <h2 id=prerequisites>Prerequisites</h2> <p>To complete this section you will need:</p> <ol> <li>A container registry already set up as explained in the <a href=../../01-getting-started/setup-docr/ >Getting Started -&gt; Set up DOCR</a> section.</li> <li>A development DOKS cluster set up and running as explained in the <a href=../../02-development/setup-doks-dev/ >Development Environment -&gt; Set up DOKS</a> section.</li> <li>The <code>microservices-demo</code> GitHub repository already prepared as explained in the <a href=../../01-getting-started/building-and-pushing-docker-images/introduction-and-repository-setup/ >Preparing demo application GitHub repository</a> section.</li> <li>Main <a href=https://docs.github.com/en/repositories/configuring-branches-and-merges-in-your-repository/defining-the-mergeability-of-pull-requests/about-protected-branches>branch protection</a> is enabled and configured for your repository. Also number of reviewers should be set to at least one.</li> <li>Main branch changes should be allowed only via <a href=https://docs.github.com/en/repositories/configuring-branches-and-merges-in-your-repository/defining-the-mergeability-of-pull-requests>pull requests</a>.</li> <li>Your <a href=../../01-getting-started/do-api-auth/ >DigitalOcean authentication token</a> stored as a GitHub secret named <code>DIGITALOCEAN_ACCESS_TOKEN</code> in the <code>microservices-demo</code> repository. Follow <a href=https://docs.github.com/en/actions/security-guides/encrypted-secrets#creating-encrypted-secrets-for-a-repository>this guide</a> to learn more about creating GitHub secrets.</li> </ol> <h2 id=online-boutique-application-ci-flows-configuration>Online Boutique Application CI Flows Configuration</h2> <p>The CI process used in this guide is comprised of two phases, each with a workflow associated:</p> <ol> <li> <p>Developers open a new pull request (or PR for short). Then, automated tests run via a dedicated GitHub workflow, and validate or invalidate the PR. Also, an additional manual review step is required by setting the number of approvals in the <a href=https://docs.github.com/en/repositories/configuring-branches-and-merges-in-your-repository/defining-the-mergeability-of-pull-requests/managing-a-branch-protection-rule>main branch protection rules</a>. A typical pull request flow is depicted below:</p> <pre class=mermaid><code>graph TD
A(New PR) --&gt; B(Run Automated Tests)
B --&gt; C{Tests Passing?}
C -- No --&gt; D(Reject PR)
C -- Yes --&gt; E{PR Review Passed?}
E -- No --&gt; D
E -- Yes ---&gt; F(Merge PR)</code></pre> </li> <li> <p>If the PR gets approved and code is merged to main branch, a second workflow runs which builds project assets, pushes them to a registry, and deploys the application to the development environment.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>In practice, it's safe to have automated deployments for the development environment. This way, developers or other team members can see immediate results, and test application behavior on the real environment (besides <a href=../../02-development/tilt-remote/ >remote development with Tilt</a>).</p> </div> <p>A typical main branch flow is depicted below:</p> <pre class=mermaid><code>graph TD
A(Close PR) --&gt; B(Merge to Main Branch)
B --&gt; C(Run Integration Tests)
C --&gt; D{Tests Passing?}
D -- No --&gt; E(Reject Build)
D -- Yes --&gt; F(Build &amp; Tag DEV Images)
F --&gt; G(Push DEV Images to Registry)
G --&gt; H(Deploy to DEV Environment)</code></pre> </li> </ol> <p>Next, you will learn how to implement the CI workflows used in this guide for the <a href=https://github.com/digitalocean/kubernetes-sample-apps/tree/master/microservices-demo>online boutique sample application</a>.</p> <h2 id=configuring-pull-requests-workflow>Configuring Pull Requests Workflow</h2> <p>On each pull request a dedicated workflow is triggered responsible with running automated tests, part of PR validation step. Next, manual review is requested by the developer opening the PR. Reviewers can be assigned also <a href=https://docs.github.com/en/organizations/organizing-members-into-teams/managing-code-review-settings-for-your-team#about-auto-assignment>automatically</a>.</p> <p>Follow below steps to configure and enable main branch PR validation workflow provided in this guide:</p> <ol> <li> <p>Clone the <code>microservices-demo</code> repository on your local machine, if not already (make sure to replace the <code>&lt;&gt;</code> placeholders accordingly):</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-0-1 id=__codelineno-0-1 name=__codelineno-0-1></a>git clone https://github.com/&lt;YOUR_GITHUB_ACCOUNT_USERNAME&gt;/microservices-demo.git
</code></pre></div> </li> <li> <p>Change directory to your local copy:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-1-1 id=__codelineno-1-1 name=__codelineno-1-1></a><span class=nb>cd</span> microservices-demo
</code></pre></div> </li> <li> <p>Fetch the CI workflow file from the <a href=https://github.com/digitalocean/kubernetes-sample-apps>kubernetes-sample-apps</a> repo:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-2-1 id=__codelineno-2-1 name=__codelineno-2-1></a>curl https://raw.githubusercontent.com/digitalocean/kubernetes-sample-apps/master/.github/workflows/online-boutique-pr-ci.yaml <span class=se>\</span>
<a href=#__codelineno-2-2 id=__codelineno-2-2 name=__codelineno-2-2></a>  -o .github/workflows/online-boutique-pr-ci.yaml <span class=se>\</span>
<a href=#__codelineno-2-3 id=__codelineno-2-3 name=__codelineno-2-3></a>  --create-dirs
</code></pre></div> </li> <li> <p>Edit the <code>.github/workflows/online-boutique-pr-ci.yaml</code> file using a text editor of your choice, preferably with YAML lint support. For example, you can use <a href=https://code.visualstudio.com/ >VS Code</a>:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-3-1 id=__codelineno-3-1 name=__codelineno-3-1></a>code .github/workflows/online-boutique-pr-ci.yaml
</code></pre></div> </li> <li> <p>Uncomment the lines prefixed with a hash mark at the top of the workflow file. The resulting file should look like:</p> <details class=note> <summary>Click to expand the <code>Online Boutique PR CI</code> workflow file</summary> <div class=highlight><pre><span></span><code><a href=#__codelineno-4-1 id=__codelineno-4-1 name=__codelineno-4-1></a><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Online Boutique PR CI</span><span class=w></span>
<a href=#__codelineno-4-2 id=__codelineno-4-2 name=__codelineno-4-2></a>
<a href=#__codelineno-4-3 id=__codelineno-4-3 name=__codelineno-4-3></a><span class=nt>on</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-4 id=__codelineno-4-4 name=__codelineno-4-4></a><span class=w>  </span><span class=c1># Used for testing only (can be disabled afterwards)</span><span class=w></span>
<a href=#__codelineno-4-5 id=__codelineno-4-5 name=__codelineno-4-5></a><span class=w>  </span><span class=nt>workflow_dispatch</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-6 id=__codelineno-4-6 name=__codelineno-4-6></a><span class=w>  </span><span class=c1># Uncomment below lines to enable this workflow on main branch PR events</span><span class=w></span>
<a href=#__codelineno-4-7 id=__codelineno-4-7 name=__codelineno-4-7></a><span class=w>  </span><span class=nt>pull_request</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-8 id=__codelineno-4-8 name=__codelineno-4-8></a><span class=w>    </span><span class=nt>branches</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-9 id=__codelineno-4-9 name=__codelineno-4-9></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">main</span><span class=w></span>
<a href=#__codelineno-4-10 id=__codelineno-4-10 name=__codelineno-4-10></a><span class=w>    </span><span class=nt>paths-ignore</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-11 id=__codelineno-4-11 name=__codelineno-4-11></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>"**/README.md"</span><span class=w></span>
<a href=#__codelineno-4-12 id=__codelineno-4-12 name=__codelineno-4-12></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>"kustomize/**"</span><span class=w></span>
<a href=#__codelineno-4-13 id=__codelineno-4-13 name=__codelineno-4-13></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>"argocd/**"</span><span class=w></span>
<a href=#__codelineno-4-14 id=__codelineno-4-14 name=__codelineno-4-14></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>".github/workflows/*"</span><span class=w></span>
<a href=#__codelineno-4-15 id=__codelineno-4-15 name=__codelineno-4-15></a>
<a href=#__codelineno-4-16 id=__codelineno-4-16 name=__codelineno-4-16></a><span class=c1># Do not allow concurrent workflows for PRs</span><span class=w></span>
<a href=#__codelineno-4-17 id=__codelineno-4-17 name=__codelineno-4-17></a><span class=c1># If disabled, leads to memory exhaustion on the DOKS dev cluster</span><span class=w></span>
<a href=#__codelineno-4-18 id=__codelineno-4-18 name=__codelineno-4-18></a><span class=nt>concurrency</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">pr-ci-dev</span><span class=w></span>
<a href=#__codelineno-4-19 id=__codelineno-4-19 name=__codelineno-4-19></a>
<a href=#__codelineno-4-20 id=__codelineno-4-20 name=__codelineno-4-20></a><span class=c1># Global environment variables</span><span class=w></span>
<a href=#__codelineno-4-21 id=__codelineno-4-21 name=__codelineno-4-21></a><span class=nt>env</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-22 id=__codelineno-4-22 name=__codelineno-4-22></a><span class=w>  </span><span class=nt>DOCR_ENDPOINT</span><span class=p>:</span><span class=w> </span><span class=s>"registry.digitalocean.com/microservices-demo"</span><span class=w></span>
<a href=#__codelineno-4-23 id=__codelineno-4-23 name=__codelineno-4-23></a><span class=w>  </span><span class=nt>CLUSTER_NAME</span><span class=p>:</span><span class=w> </span><span class=s>"microservices-demo-dev"</span><span class=w></span>
<a href=#__codelineno-4-24 id=__codelineno-4-24 name=__codelineno-4-24></a><span class=w>  </span><span class=nt>REGION</span><span class=p>:</span><span class=w> </span><span class=s>"nyc1"</span><span class=w></span>
<a href=#__codelineno-4-25 id=__codelineno-4-25 name=__codelineno-4-25></a><span class=w>  </span><span class=nt>K8S_NAMESPACE</span><span class=p>:</span><span class=w> </span><span class=s>"microservices-demo-${{</span><span class=nv> </span><span class=s>github.event.pull_request.number</span><span class=nv> </span><span class=s>}}"</span><span class=w></span>
<a href=#__codelineno-4-26 id=__codelineno-4-26 name=__codelineno-4-26></a><span class=w>  </span><span class=nt>PROJECT_NAME</span><span class=p>:</span><span class=w> </span><span class=s>"online-boutique"</span><span class=w></span>
<a href=#__codelineno-4-27 id=__codelineno-4-27 name=__codelineno-4-27></a>
<a href=#__codelineno-4-28 id=__codelineno-4-28 name=__codelineno-4-28></a><span class=nt>jobs</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-29 id=__codelineno-4-29 name=__codelineno-4-29></a><span class=w>  </span><span class=c1># Run unit tests in parallel using below matrix to cut down time</span><span class=w></span>
<a href=#__codelineno-4-30 id=__codelineno-4-30 name=__codelineno-4-30></a><span class=w>  </span><span class=c1># Unit tests are standalone and should not raise conflicts</span><span class=w></span>
<a href=#__codelineno-4-31 id=__codelineno-4-31 name=__codelineno-4-31></a><span class=w>  </span><span class=c1># Each microservice is written in a specific language, hence it's added to the matrix</span><span class=w></span>
<a href=#__codelineno-4-32 id=__codelineno-4-32 name=__codelineno-4-32></a><span class=w>  </span><span class=nt>unit-tests</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-33 id=__codelineno-4-33 name=__codelineno-4-33></a><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span><span class=w></span>
<a href=#__codelineno-4-34 id=__codelineno-4-34 name=__codelineno-4-34></a><span class=w>    </span><span class=nt>strategy</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-35 id=__codelineno-4-35 name=__codelineno-4-35></a><span class=w>      </span><span class=nt>matrix</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-36 id=__codelineno-4-36 name=__codelineno-4-36></a><span class=w>        </span><span class=nt>include</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-37 id=__codelineno-4-37 name=__codelineno-4-37></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>project_name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">cartservice</span><span class=w></span>
<a href=#__codelineno-4-38 id=__codelineno-4-38 name=__codelineno-4-38></a><span class=w>            </span><span class=nt>project_language</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">csharp</span><span class=w></span>
<a href=#__codelineno-4-39 id=__codelineno-4-39 name=__codelineno-4-39></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>project_name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">checkoutservice</span><span class=w></span>
<a href=#__codelineno-4-40 id=__codelineno-4-40 name=__codelineno-4-40></a><span class=w>            </span><span class=nt>project_language</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">golang</span><span class=w></span>
<a href=#__codelineno-4-41 id=__codelineno-4-41 name=__codelineno-4-41></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>project_name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">currencyservice</span><span class=w></span>
<a href=#__codelineno-4-42 id=__codelineno-4-42 name=__codelineno-4-42></a><span class=w>            </span><span class=nt>project_language</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">javascript</span><span class=w></span>
<a href=#__codelineno-4-43 id=__codelineno-4-43 name=__codelineno-4-43></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>project_name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">emailservice</span><span class=w></span>
<a href=#__codelineno-4-44 id=__codelineno-4-44 name=__codelineno-4-44></a><span class=w>            </span><span class=nt>project_language</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">python</span><span class=w></span>
<a href=#__codelineno-4-45 id=__codelineno-4-45 name=__codelineno-4-45></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>project_name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">frontend</span><span class=w></span>
<a href=#__codelineno-4-46 id=__codelineno-4-46 name=__codelineno-4-46></a><span class=w>            </span><span class=nt>project_language</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">golang</span><span class=w></span>
<a href=#__codelineno-4-47 id=__codelineno-4-47 name=__codelineno-4-47></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>project_name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">paymentservice</span><span class=w></span>
<a href=#__codelineno-4-48 id=__codelineno-4-48 name=__codelineno-4-48></a><span class=w>            </span><span class=nt>project_language</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">javascript</span><span class=w></span>
<a href=#__codelineno-4-49 id=__codelineno-4-49 name=__codelineno-4-49></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>project_name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">productcatalogservice</span><span class=w></span>
<a href=#__codelineno-4-50 id=__codelineno-4-50 name=__codelineno-4-50></a><span class=w>            </span><span class=nt>project_language</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">golang</span><span class=w></span>
<a href=#__codelineno-4-51 id=__codelineno-4-51 name=__codelineno-4-51></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>project_name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">recommendationservice</span><span class=w></span>
<a href=#__codelineno-4-52 id=__codelineno-4-52 name=__codelineno-4-52></a><span class=w>            </span><span class=nt>project_language</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">python</span><span class=w></span>
<a href=#__codelineno-4-53 id=__codelineno-4-53 name=__codelineno-4-53></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>project_name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">shippingservice</span><span class=w></span>
<a href=#__codelineno-4-54 id=__codelineno-4-54 name=__codelineno-4-54></a><span class=w>            </span><span class=nt>project_language</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">golang</span><span class=w></span>
<a href=#__codelineno-4-55 id=__codelineno-4-55 name=__codelineno-4-55></a><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-56 id=__codelineno-4-56 name=__codelineno-4-56></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Checkout code</span><span class=w></span>
<a href=#__codelineno-4-57 id=__codelineno-4-57 name=__codelineno-4-57></a><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span><span class=w></span>
<a href=#__codelineno-4-58 id=__codelineno-4-58 name=__codelineno-4-58></a><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-59 id=__codelineno-4-59 name=__codelineno-4-59></a><span class=w>          </span><span class=nt>ref</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${{github.event.pull_request.head.ref}}</span><span class=w></span>
<a href=#__codelineno-4-60 id=__codelineno-4-60 name=__codelineno-4-60></a><span class=w>          </span><span class=nt>repository</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${{github.event.pull_request.head.repo.full_name}}</span><span class=w></span>
<a href=#__codelineno-4-61 id=__codelineno-4-61 name=__codelineno-4-61></a>
<a href=#__codelineno-4-62 id=__codelineno-4-62 name=__codelineno-4-62></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Set up Go env</span><span class=w></span>
<a href=#__codelineno-4-63 id=__codelineno-4-63 name=__codelineno-4-63></a><span class=w>        </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${{ matrix.project_language == 'golang' }}</span><span class=w></span>
<a href=#__codelineno-4-64 id=__codelineno-4-64 name=__codelineno-4-64></a><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">actions/setup-go@v3</span><span class=w></span>
<a href=#__codelineno-4-65 id=__codelineno-4-65 name=__codelineno-4-65></a><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-66 id=__codelineno-4-66 name=__codelineno-4-66></a><span class=w>          </span><span class=nt>go-version</span><span class=p>:</span><span class=w> </span><span class=s>"1.19"</span><span class=w></span>
<a href=#__codelineno-4-67 id=__codelineno-4-67 name=__codelineno-4-67></a>
<a href=#__codelineno-4-68 id=__codelineno-4-68 name=__codelineno-4-68></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Go Unit Tests</span><span class=w></span>
<a href=#__codelineno-4-69 id=__codelineno-4-69 name=__codelineno-4-69></a><span class=w>        </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${{ matrix.project_language == 'golang' }}</span><span class=w></span>
<a href=#__codelineno-4-70 id=__codelineno-4-70 name=__codelineno-4-70></a><span class=w>        </span><span class=nt>timeout-minutes</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5</span><span class=w></span>
<a href=#__codelineno-4-71 id=__codelineno-4-71 name=__codelineno-4-71></a><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span><span class=w></span>
<a href=#__codelineno-4-72 id=__codelineno-4-72 name=__codelineno-4-72></a><span class=w>          </span><span class=no>( </span><span class=w></span>
<a href=#__codelineno-4-73 id=__codelineno-4-73 name=__codelineno-4-73></a><span class=w>            </span><span class=no>cd src/${{ matrix.project_name }}</span><span class=w></span>
<a href=#__codelineno-4-74 id=__codelineno-4-74 name=__codelineno-4-74></a><span class=w>            </span><span class=no>go test </span><span class=w></span>
<a href=#__codelineno-4-75 id=__codelineno-4-75 name=__codelineno-4-75></a><span class=w>          </span><span class=no>)</span><span class=w></span>
<a href=#__codelineno-4-76 id=__codelineno-4-76 name=__codelineno-4-76></a>
<a href=#__codelineno-4-77 id=__codelineno-4-77 name=__codelineno-4-77></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Set up C# env</span><span class=w></span>
<a href=#__codelineno-4-78 id=__codelineno-4-78 name=__codelineno-4-78></a><span class=w>        </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${{ matrix.project_language == 'csharp' }}</span><span class=w></span>
<a href=#__codelineno-4-79 id=__codelineno-4-79 name=__codelineno-4-79></a><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">actions/setup-dotnet@v2</span><span class=w></span>
<a href=#__codelineno-4-80 id=__codelineno-4-80 name=__codelineno-4-80></a><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-81 id=__codelineno-4-81 name=__codelineno-4-81></a><span class=w>          </span><span class=nt>dotnet-version</span><span class=p>:</span><span class=w> </span><span class=s>"6.0"</span><span class=w></span>
<a href=#__codelineno-4-82 id=__codelineno-4-82 name=__codelineno-4-82></a><span class=w>          </span><span class=nt>include-prerelease</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class=w></span>
<a href=#__codelineno-4-83 id=__codelineno-4-83 name=__codelineno-4-83></a>
<a href=#__codelineno-4-84 id=__codelineno-4-84 name=__codelineno-4-84></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">C# Unit Tests</span><span class=w></span>
<a href=#__codelineno-4-85 id=__codelineno-4-85 name=__codelineno-4-85></a><span class=w>        </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${{ matrix.project_language == 'csharp' }}</span><span class=w></span>
<a href=#__codelineno-4-86 id=__codelineno-4-86 name=__codelineno-4-86></a><span class=w>        </span><span class=nt>timeout-minutes</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5</span><span class=w></span>
<a href=#__codelineno-4-87 id=__codelineno-4-87 name=__codelineno-4-87></a><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">dotnet test src/${{ matrix.project_name }}/</span><span class=w></span>
<a href=#__codelineno-4-88 id=__codelineno-4-88 name=__codelineno-4-88></a>
<a href=#__codelineno-4-89 id=__codelineno-4-89 name=__codelineno-4-89></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Set up NodeJS env</span><span class=w></span>
<a href=#__codelineno-4-90 id=__codelineno-4-90 name=__codelineno-4-90></a><span class=w>        </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${{ matrix.project_language == 'javascript' }}</span><span class=w></span>
<a href=#__codelineno-4-91 id=__codelineno-4-91 name=__codelineno-4-91></a><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">actions/setup-node@v3</span><span class=w></span>
<a href=#__codelineno-4-92 id=__codelineno-4-92 name=__codelineno-4-92></a><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-93 id=__codelineno-4-93 name=__codelineno-4-93></a><span class=w>          </span><span class=nt>node-version</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">18</span><span class=w></span>
<a href=#__codelineno-4-94 id=__codelineno-4-94 name=__codelineno-4-94></a>
<a href=#__codelineno-4-95 id=__codelineno-4-95 name=__codelineno-4-95></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Javascript Unit Tests</span><span class=w></span>
<a href=#__codelineno-4-96 id=__codelineno-4-96 name=__codelineno-4-96></a><span class=w>        </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${{ matrix.project_language == 'javascript' }}</span><span class=w></span>
<a href=#__codelineno-4-97 id=__codelineno-4-97 name=__codelineno-4-97></a><span class=w>        </span><span class=nt>timeout-minutes</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5</span><span class=w></span>
<a href=#__codelineno-4-98 id=__codelineno-4-98 name=__codelineno-4-98></a><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span><span class=w></span>
<a href=#__codelineno-4-99 id=__codelineno-4-99 name=__codelineno-4-99></a><span class=w>          </span><span class=no>( </span><span class=w></span>
<a href=#__codelineno-4-100 id=__codelineno-4-100 name=__codelineno-4-100></a><span class=w>            </span><span class=no>cd src/${{ matrix.project_name }}</span><span class=w></span>
<a href=#__codelineno-4-101 id=__codelineno-4-101 name=__codelineno-4-101></a><span class=w>            </span><span class=no>npm install</span><span class=w></span>
<a href=#__codelineno-4-102 id=__codelineno-4-102 name=__codelineno-4-102></a><span class=w>            </span><span class=no>npm run test </span><span class=w></span>
<a href=#__codelineno-4-103 id=__codelineno-4-103 name=__codelineno-4-103></a><span class=w>          </span><span class=no>)</span><span class=w></span>
<a href=#__codelineno-4-104 id=__codelineno-4-104 name=__codelineno-4-104></a>
<a href=#__codelineno-4-105 id=__codelineno-4-105 name=__codelineno-4-105></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Set up Python env</span><span class=w></span>
<a href=#__codelineno-4-106 id=__codelineno-4-106 name=__codelineno-4-106></a><span class=w>        </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${{ matrix.project_language == 'python' }}</span><span class=w></span>
<a href=#__codelineno-4-107 id=__codelineno-4-107 name=__codelineno-4-107></a><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">actions/setup-python@v3</span><span class=w></span>
<a href=#__codelineno-4-108 id=__codelineno-4-108 name=__codelineno-4-108></a><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-109 id=__codelineno-4-109 name=__codelineno-4-109></a><span class=w>          </span><span class=nt>python-version</span><span class=p>:</span><span class=w> </span><span class=s>"3.7"</span><span class=w></span>
<a href=#__codelineno-4-110 id=__codelineno-4-110 name=__codelineno-4-110></a>
<a href=#__codelineno-4-111 id=__codelineno-4-111 name=__codelineno-4-111></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Python Unit Tests</span><span class=w></span>
<a href=#__codelineno-4-112 id=__codelineno-4-112 name=__codelineno-4-112></a><span class=w>        </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${{ matrix.project_language == 'python' }}</span><span class=w></span>
<a href=#__codelineno-4-113 id=__codelineno-4-113 name=__codelineno-4-113></a><span class=w>        </span><span class=nt>timeout-minutes</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5</span><span class=w></span>
<a href=#__codelineno-4-114 id=__codelineno-4-114 name=__codelineno-4-114></a><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span><span class=w></span>
<a href=#__codelineno-4-115 id=__codelineno-4-115 name=__codelineno-4-115></a><span class=w>          </span><span class=no>( </span><span class=w></span>
<a href=#__codelineno-4-116 id=__codelineno-4-116 name=__codelineno-4-116></a><span class=w>            </span><span class=no>cd src/${{ matrix.project_name }}</span><span class=w></span>
<a href=#__codelineno-4-117 id=__codelineno-4-117 name=__codelineno-4-117></a><span class=w>            </span><span class=no>pip install -r requirements.txt</span><span class=w></span>
<a href=#__codelineno-4-118 id=__codelineno-4-118 name=__codelineno-4-118></a><span class=w>            </span><span class=no>pytest</span><span class=w></span>
<a href=#__codelineno-4-119 id=__codelineno-4-119 name=__codelineno-4-119></a><span class=w>          </span><span class=no>)</span><span class=w></span>
<a href=#__codelineno-4-120 id=__codelineno-4-120 name=__codelineno-4-120></a>
<a href=#__codelineno-4-121 id=__codelineno-4-121 name=__codelineno-4-121></a><span class=w>  </span><span class=c1># Run deployment tests (smoke tests)</span><span class=w></span>
<a href=#__codelineno-4-122 id=__codelineno-4-122 name=__codelineno-4-122></a><span class=w>  </span><span class=c1># You can add integration tests as well</span><span class=w></span>
<a href=#__codelineno-4-123 id=__codelineno-4-123 name=__codelineno-4-123></a><span class=w>  </span><span class=c1># Please bear in mind that more tests means increased workflow run time</span><span class=w></span>
<a href=#__codelineno-4-124 id=__codelineno-4-124 name=__codelineno-4-124></a><span class=w>  </span><span class=c1># With workflow concurrency disabled, means more waiting time for other PRs in the queue</span><span class=w></span>
<a href=#__codelineno-4-125 id=__codelineno-4-125 name=__codelineno-4-125></a><span class=w>  </span><span class=nt>deployment-tests</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-126 id=__codelineno-4-126 name=__codelineno-4-126></a><span class=w>    </span><span class=nt>needs</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">unit-tests</span><span class=w></span>
<a href=#__codelineno-4-127 id=__codelineno-4-127 name=__codelineno-4-127></a><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span><span class=w></span>
<a href=#__codelineno-4-128 id=__codelineno-4-128 name=__codelineno-4-128></a><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-129 id=__codelineno-4-129 name=__codelineno-4-129></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Checkout code</span><span class=w></span>
<a href=#__codelineno-4-130 id=__codelineno-4-130 name=__codelineno-4-130></a><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span><span class=w></span>
<a href=#__codelineno-4-131 id=__codelineno-4-131 name=__codelineno-4-131></a><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-132 id=__codelineno-4-132 name=__codelineno-4-132></a><span class=w>          </span><span class=nt>ref</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${{github.event.pull_request.head.ref}}</span><span class=w></span>
<a href=#__codelineno-4-133 id=__codelineno-4-133 name=__codelineno-4-133></a><span class=w>          </span><span class=nt>repository</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${{github.event.pull_request.head.repo.full_name}}</span><span class=w></span>
<a href=#__codelineno-4-134 id=__codelineno-4-134 name=__codelineno-4-134></a>
<a href=#__codelineno-4-135 id=__codelineno-4-135 name=__codelineno-4-135></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Install doctl</span><span class=w></span>
<a href=#__codelineno-4-136 id=__codelineno-4-136 name=__codelineno-4-136></a><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">digitalocean/action-doctl@v2</span><span class=w></span>
<a href=#__codelineno-4-137 id=__codelineno-4-137 name=__codelineno-4-137></a><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-138 id=__codelineno-4-138 name=__codelineno-4-138></a><span class=w>          </span><span class=nt>token</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.DIGITALOCEAN_ACCESS_TOKEN }}</span><span class=w></span>
<a href=#__codelineno-4-139 id=__codelineno-4-139 name=__codelineno-4-139></a>
<a href=#__codelineno-4-140 id=__codelineno-4-140 name=__codelineno-4-140></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Log in to DOCR with short-lived credentials</span><span class=w></span>
<a href=#__codelineno-4-141 id=__codelineno-4-141 name=__codelineno-4-141></a><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">doctl registry login --expiry-seconds 1200</span><span class=w></span>
<a href=#__codelineno-4-142 id=__codelineno-4-142 name=__codelineno-4-142></a>
<a href=#__codelineno-4-143 id=__codelineno-4-143 name=__codelineno-4-143></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Set up K8S tools</span><span class=w></span>
<a href=#__codelineno-4-144 id=__codelineno-4-144 name=__codelineno-4-144></a><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">yokawasa/action-setup-kube-tools@v0.8.2</span><span class=w></span>
<a href=#__codelineno-4-145 id=__codelineno-4-145 name=__codelineno-4-145></a><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-146 id=__codelineno-4-146 name=__codelineno-4-146></a><span class=w>          </span><span class=nt>kubectl</span><span class=p>:</span><span class=w> </span><span class=s>"1.25.2"</span><span class=w></span>
<a href=#__codelineno-4-147 id=__codelineno-4-147 name=__codelineno-4-147></a><span class=w>          </span><span class=nt>kustomize</span><span class=p>:</span><span class=w> </span><span class=s>"4.5.7"</span><span class=w></span>
<a href=#__codelineno-4-148 id=__codelineno-4-148 name=__codelineno-4-148></a><span class=w>          </span><span class=nt>tilt</span><span class=p>:</span><span class=w> </span><span class=s>"0.30.9"</span><span class=w></span>
<a href=#__codelineno-4-149 id=__codelineno-4-149 name=__codelineno-4-149></a>
<a href=#__codelineno-4-150 id=__codelineno-4-150 name=__codelineno-4-150></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Configure kubectl for DOKS with short-lived credentials</span><span class=w></span>
<a href=#__codelineno-4-151 id=__codelineno-4-151 name=__codelineno-4-151></a><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">doctl kubernetes cluster kubeconfig save ${{ env.CLUSTER_NAME }} --expiry-seconds 1200</span><span class=w></span>
<a href=#__codelineno-4-152 id=__codelineno-4-152 name=__codelineno-4-152></a>
<a href=#__codelineno-4-153 id=__codelineno-4-153 name=__codelineno-4-153></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Deploy microservices to DOKS</span><span class=w></span>
<a href=#__codelineno-4-154 id=__codelineno-4-154 name=__codelineno-4-154></a><span class=w>        </span><span class=nt>timeout-minutes</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10</span><span class=w></span>
<a href=#__codelineno-4-155 id=__codelineno-4-155 name=__codelineno-4-155></a><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span><span class=w></span>
<a href=#__codelineno-4-156 id=__codelineno-4-156 name=__codelineno-4-156></a><span class=w>          </span><span class=no># Bring all microservices up using Tilt and wait for all deployments</span><span class=w></span>
<a href=#__codelineno-4-157 id=__codelineno-4-157 name=__codelineno-4-157></a><span class=w>          </span><span class=no>cp tilt-resources/dev/tilt_config.json .</span><span class=w></span>
<a href=#__codelineno-4-158 id=__codelineno-4-158 name=__codelineno-4-158></a><span class=w>          </span><span class=no>tilt ci -- \</span><span class=w></span>
<a href=#__codelineno-4-159 id=__codelineno-4-159 name=__codelineno-4-159></a><span class=w>            </span><span class=no>--allowed_contexts "do-${{ env.REGION }}-${{ env.CLUSTER_NAME }}" \</span><span class=w></span>
<a href=#__codelineno-4-160 id=__codelineno-4-160 name=__codelineno-4-160></a><span class=w>            </span><span class=no>--default_registry "${{ env.DOCR_ENDPOINT }}" \</span><span class=w></span>
<a href=#__codelineno-4-161 id=__codelineno-4-161 name=__codelineno-4-161></a><span class=w>            </span><span class=no>--environment "dev" \</span><span class=w></span>
<a href=#__codelineno-4-162 id=__codelineno-4-162 name=__codelineno-4-162></a><span class=w>            </span><span class=no>--namespace "${{ env.K8S_NAMESPACE }}"</span><span class=w></span>
<a href=#__codelineno-4-163 id=__codelineno-4-163 name=__codelineno-4-163></a>
<a href=#__codelineno-4-164 id=__codelineno-4-164 name=__codelineno-4-164></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Build loadgenerator image</span><span class=w></span>
<a href=#__codelineno-4-165 id=__codelineno-4-165 name=__codelineno-4-165></a><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">docker/build-push-action@v3</span><span class=w></span>
<a href=#__codelineno-4-166 id=__codelineno-4-166 name=__codelineno-4-166></a><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-167 id=__codelineno-4-167 name=__codelineno-4-167></a><span class=w>          </span><span class=nt>context</span><span class=p>:</span><span class=w> </span><span class=s>"src/loadgenerator"</span><span class=w></span>
<a href=#__codelineno-4-168 id=__codelineno-4-168 name=__codelineno-4-168></a><span class=w>          </span><span class=nt>push</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class=w></span>
<a href=#__codelineno-4-169 id=__codelineno-4-169 name=__codelineno-4-169></a><span class=w>          </span><span class=nt>tags</span><span class=p>:</span><span class=w> </span><span class=s>"${{</span><span class=nv> </span><span class=s>env.DOCR_ENDPOINT</span><span class=nv> </span><span class=s>}}/loadgenerator"</span><span class=w></span>
<a href=#__codelineno-4-170 id=__codelineno-4-170 name=__codelineno-4-170></a>
<a href=#__codelineno-4-171 id=__codelineno-4-171 name=__codelineno-4-171></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Smoke tests</span><span class=w></span>
<a href=#__codelineno-4-172 id=__codelineno-4-172 name=__codelineno-4-172></a><span class=w>        </span><span class=nt>timeout-minutes</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10</span><span class=w></span>
<a href=#__codelineno-4-173 id=__codelineno-4-173 name=__codelineno-4-173></a><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span><span class=w></span>
<a href=#__codelineno-4-174 id=__codelineno-4-174 name=__codelineno-4-174></a><span class=w>          </span><span class=no># Prepare load generator</span><span class=w></span>
<a href=#__codelineno-4-175 id=__codelineno-4-175 name=__codelineno-4-175></a><span class=w>          </span><span class=no># Inject workflow custom docker image</span><span class=w></span>
<a href=#__codelineno-4-176 id=__codelineno-4-176 name=__codelineno-4-176></a><span class=w>          </span><span class=no>sed -i "s#&lt;LOAD_GENERATOR_IMAGE&gt;#${{ env.DOCR_ENDPOINT }}/loadgenerator#g" loadgenerator.yaml</span><span class=w></span>
<a href=#__codelineno-4-177 id=__codelineno-4-177 name=__codelineno-4-177></a>
<a href=#__codelineno-4-178 id=__codelineno-4-178 name=__codelineno-4-178></a><span class=w>          </span><span class=no># Deploy load generator</span><span class=w></span>
<a href=#__codelineno-4-179 id=__codelineno-4-179 name=__codelineno-4-179></a><span class=w>          </span><span class=no>kubectl apply -f loadgenerator.yaml -n ${{ env.K8S_NAMESPACE }}</span><span class=w></span>
<a href=#__codelineno-4-180 id=__codelineno-4-180 name=__codelineno-4-180></a>
<a href=#__codelineno-4-181 id=__codelineno-4-181 name=__codelineno-4-181></a><span class=w>          </span><span class=no># Wait for load generator deployment to be ready</span><span class=w></span>
<a href=#__codelineno-4-182 id=__codelineno-4-182 name=__codelineno-4-182></a><span class=w>          </span><span class=no>kubectl wait --for=condition=available --timeout=60s deployment/loadgenerator -n ${{ env.K8S_NAMESPACE }} || {</span><span class=w></span>
<a href=#__codelineno-4-183 id=__codelineno-4-183 name=__codelineno-4-183></a><span class=w>            </span><span class=no># Show why load generator failed to start</span><span class=w></span>
<a href=#__codelineno-4-184 id=__codelineno-4-184 name=__codelineno-4-184></a><span class=w>            </span><span class=no>echo "[INFO] Load generator pod events"</span><span class=w></span>
<a href=#__codelineno-4-185 id=__codelineno-4-185 name=__codelineno-4-185></a><span class=w>            </span><span class=no>kubectl describe pod -l app=loadgenerator -n ${{ env.K8S_NAMESPACE }} | tail -10</span><span class=w></span>
<a href=#__codelineno-4-186 id=__codelineno-4-186 name=__codelineno-4-186></a><span class=w>            </span><span class=no>exit 1</span><span class=w></span>
<a href=#__codelineno-4-187 id=__codelineno-4-187 name=__codelineno-4-187></a><span class=w>          </span><span class=no>}</span><span class=w></span>
<a href=#__codelineno-4-188 id=__codelineno-4-188 name=__codelineno-4-188></a>
<a href=#__codelineno-4-189 id=__codelineno-4-189 name=__codelineno-4-189></a><span class=w>          </span><span class=no># Run smoke tests</span><span class=w></span>
<a href=#__codelineno-4-190 id=__codelineno-4-190 name=__codelineno-4-190></a><span class=w>          </span><span class=no>REQUEST_COUNT="0"</span><span class=w></span>
<a href=#__codelineno-4-191 id=__codelineno-4-191 name=__codelineno-4-191></a><span class=w>          </span><span class=no>while [[ "$REQUEST_COUNT"  -lt "50"  ]]; do</span><span class=w></span>
<a href=#__codelineno-4-192 id=__codelineno-4-192 name=__codelineno-4-192></a><span class=w>            </span><span class=no>sleep 5</span><span class=w></span>
<a href=#__codelineno-4-193 id=__codelineno-4-193 name=__codelineno-4-193></a><span class=w>            </span><span class=no>REQUEST_COUNT=$(kubectl logs -l app=loadgenerator -n ${{ env.K8S_NAMESPACE }} | grep Aggregated | awk '{print $2}')</span><span class=w></span>
<a href=#__codelineno-4-194 id=__codelineno-4-194 name=__codelineno-4-194></a><span class=w>          </span><span class=no>done</span><span class=w></span>
<a href=#__codelineno-4-195 id=__codelineno-4-195 name=__codelineno-4-195></a><span class=w>          </span><span class=no># ensure there are no errors hitting endpoints</span><span class=w></span>
<a href=#__codelineno-4-196 id=__codelineno-4-196 name=__codelineno-4-196></a><span class=w>          </span><span class=no>ERROR_COUNT=$(kubectl logs -l app=loadgenerator -n ${{ env.K8S_NAMESPACE }} | grep Aggregated | awk '{print $3}' | sed "s/[(][^)]*[)]//g")</span><span class=w></span>
<a href=#__codelineno-4-197 id=__codelineno-4-197 name=__codelineno-4-197></a><span class=w>          </span><span class=no>if [[ "$ERROR_COUNT" -gt "0" ]]; then</span><span class=w></span>
<a href=#__codelineno-4-198 id=__codelineno-4-198 name=__codelineno-4-198></a><span class=w>            </span><span class=no># Print final results</span><span class=w></span>
<a href=#__codelineno-4-199 id=__codelineno-4-199 name=__codelineno-4-199></a><span class=w>            </span><span class=no>echo "[INFO] Load generator results"</span><span class=w></span>
<a href=#__codelineno-4-200 id=__codelineno-4-200 name=__codelineno-4-200></a><span class=w>            </span><span class=no>kubectl logs -l app=loadgenerator -n ${{ env.K8S_NAMESPACE }} | tail -20</span><span class=w></span>
<a href=#__codelineno-4-201 id=__codelineno-4-201 name=__codelineno-4-201></a><span class=w>            </span><span class=no>exit 1</span><span class=w></span>
<a href=#__codelineno-4-202 id=__codelineno-4-202 name=__codelineno-4-202></a><span class=w>          </span><span class=no>fi</span><span class=w></span>
<a href=#__codelineno-4-203 id=__codelineno-4-203 name=__codelineno-4-203></a>
<a href=#__codelineno-4-204 id=__codelineno-4-204 name=__codelineno-4-204></a><span class=w>          </span><span class=no># Print final results</span><span class=w></span>
<a href=#__codelineno-4-205 id=__codelineno-4-205 name=__codelineno-4-205></a><span class=w>          </span><span class=no>echo "[INFO] Load generator results"</span><span class=w></span>
<a href=#__codelineno-4-206 id=__codelineno-4-206 name=__codelineno-4-206></a><span class=w>          </span><span class=no>kubectl logs -l app=loadgenerator -n ${{ env.K8S_NAMESPACE }} | tail -20</span><span class=w></span>
<a href=#__codelineno-4-207 id=__codelineno-4-207 name=__codelineno-4-207></a><span class=w>        </span><span class=nt>working-directory</span><span class=p>:</span><span class=w> </span><span class=s>"src/loadgenerator"</span><span class=w></span>
<a href=#__codelineno-4-208 id=__codelineno-4-208 name=__codelineno-4-208></a>
<a href=#__codelineno-4-209 id=__codelineno-4-209 name=__codelineno-4-209></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Clean up Tilt microservices environment</span><span class=w></span>
<a href=#__codelineno-4-210 id=__codelineno-4-210 name=__codelineno-4-210></a><span class=w>        </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${{ always() }}</span><span class=w></span>
<a href=#__codelineno-4-211 id=__codelineno-4-211 name=__codelineno-4-211></a><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span><span class=w></span>
<a href=#__codelineno-4-212 id=__codelineno-4-212 name=__codelineno-4-212></a><span class=w>          </span><span class=no># Remove all microservices and the namespace created by Tilt</span><span class=w></span>
<a href=#__codelineno-4-213 id=__codelineno-4-213 name=__codelineno-4-213></a><span class=w>          </span><span class=no>tilt down --delete-namespaces -- --namespace "${{ env.K8S_NAMESPACE }}"</span><span class=w></span>
<a href=#__codelineno-4-214 id=__codelineno-4-214 name=__codelineno-4-214></a>
<a href=#__codelineno-4-215 id=__codelineno-4-215 name=__codelineno-4-215></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Clean up Tilt docker images from registry</span><span class=w></span>
<a href=#__codelineno-4-216 id=__codelineno-4-216 name=__codelineno-4-216></a><span class=w>        </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${{ always() }}</span><span class=w></span>
<a href=#__codelineno-4-217 id=__codelineno-4-217 name=__codelineno-4-217></a><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span><span class=w></span>
<a href=#__codelineno-4-218 id=__codelineno-4-218 name=__codelineno-4-218></a><span class=w>          </span><span class=no># Remove Tilt docker images from registry</span><span class=w></span>
<a href=#__codelineno-4-219 id=__codelineno-4-219 name=__codelineno-4-219></a><span class=w>          </span><span class=no>for tilt_repo in $(docker images --format "{{.Repository}}:{{.Tag}}" | grep "tilt-.*[a-z|0-9]"); do</span><span class=w></span>
<a href=#__codelineno-4-220 id=__codelineno-4-220 name=__codelineno-4-220></a><span class=w>            </span><span class=no>repo_and_tag="${tilt_repo##*/}"</span><span class=w></span>
<a href=#__codelineno-4-221 id=__codelineno-4-221 name=__codelineno-4-221></a><span class=w>            </span><span class=no>repo="${repo_and_tag%%:*}"</span><span class=w></span>
<a href=#__codelineno-4-222 id=__codelineno-4-222 name=__codelineno-4-222></a><span class=w>            </span><span class=no>tag="${repo_and_tag##*:}"</span><span class=w></span>
<a href=#__codelineno-4-223 id=__codelineno-4-223 name=__codelineno-4-223></a><span class=w>            </span><span class=no>echo "[INFO] Deleting tag $tag from repo $repo ..."</span><span class=w></span>
<a href=#__codelineno-4-224 id=__codelineno-4-224 name=__codelineno-4-224></a><span class=w>            </span><span class=no>doctl registry repository delete-tag "$repo" "$tag" -f</span><span class=w></span>
<a href=#__codelineno-4-225 id=__codelineno-4-225 name=__codelineno-4-225></a><span class=w>          </span><span class=no>done</span><span class=w></span>
<a href=#__codelineno-4-226 id=__codelineno-4-226 name=__codelineno-4-226></a><span class=w>          </span><span class=no>echo "[INFO] Remember to run the DOCR garbage collector from time to time!"</span><span class=w></span>
</code></pre></div> </details> </li> <li> <p>Save the workflow file, commit, and push changes to your git repository <code>main</code> branch (<strong>you may need to temporarily disable <code>main</code> branch protection first</strong>).</p> <div class="admonition note"> <p class=admonition-title>Note</p> <ul> <li>Depending on your setup, you may want to adjust the following environment variables at the top of your workflow file: <div class=highlight><pre><span></span><code><a href=#__codelineno-5-1 id=__codelineno-5-1 name=__codelineno-5-1></a><span class=nt>env</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-5-2 id=__codelineno-5-2 name=__codelineno-5-2></a><span class=w>  </span><span class=nt>DOCR_ENDPOINT</span><span class=p>:</span><span class=w> </span><span class=s>"registry.digitalocean.com/&lt;YOUR_REGISTRY_NAME_HERE&gt;"</span><span class=w></span>
<a href=#__codelineno-5-3 id=__codelineno-5-3 name=__codelineno-5-3></a><span class=w>  </span><span class=nt>CLUSTER_NAME</span><span class=p>:</span><span class=w> </span><span class=s>"&lt;YOUR_DEV_DOKS_CLUSTER_NAME_HERE&gt;"</span><span class=w></span>
<a href=#__codelineno-5-4 id=__codelineno-5-4 name=__codelineno-5-4></a><span class=w>  </span><span class=nt>REGION</span><span class=p>:</span><span class=w> </span><span class=s>"&lt;YOUR_DEV_DOKS_CLUSTER_REGION_HERE&gt;"</span><span class=w></span>
<a href=#__codelineno-5-5 id=__codelineno-5-5 name=__codelineno-5-5></a><span class=w>  </span><span class=nt>K8S_NAMESPACE</span><span class=p>:</span><span class=w> </span><span class=s>"&lt;YOUR_PROJECT_CUSTOM_NAMESPACE_HERE&gt;-${{</span><span class=nv> </span><span class=s>github.event.pull_request.number</span><span class=nv> </span><span class=s>}}"</span><span class=w></span>
</code></pre></div></li> <li>In order to run deployment tests, the example CI workflow provided in this guide creates a dedicated Kubernetes namespace to deploy microservices on your target DOKS development cluster. It is suffixed using the PR number which is unique across PRs. When it finishes, it will try to clean up all associated resources such as the provisioned Kubernetes namespace, and docker images from the registry. For docker registry, you still need to run garbage collection (not triggered automatically in the workflow because it puts the DOCR in read-only mode, hence other PR workflows will fail at the docker clean up step).</li> </ul> </div> </li> </ol> <p>Explanation for the above configuration:</p> <ul> <li><code>on.pull_request</code> - triggers the <code>Online Boutique PR CI</code> workflow on pull request events only.</li> <li><code>on.pull_request.branches</code> - triggers the <code>Online Boutique PR CI</code> workflow whenever a pull request event is detected for the specified list of branches. In this case only <code>main</code> branch is desired.</li> <li><code>on.pull_requests.paths-ignore</code> - list of repository paths used for filtering. The <code>Online Boutique PR CI</code> workflow is triggered only on paths <strong>not present</strong> in the <code>paths-ignore</code> list. Basically, everything is included (microservices as well), except for Kustomize logic, README files, and workflows logic. Kustomize configuration is dealt in a separate workflow, because it's not related to microservices application logic.</li> <li><code>env</code> - sets environment variables to use for the whole pipeline. Usually, environment variables control workflow logic.</li> <li><code>jobs</code> - defines list of job to run inside the pipeline such as unit tests, deployment tests, etc.</li> <li><code>strategy.matrix</code> - use a matrix build type. Runs the unit tests in parallel for each project type combination. This approach is a perfect match for projects using multiple components, such as microservices. It also cuts down the time required to build and test each component. Each element from the matrix sets the project name, and the language being used.</li> <li><code>steps</code> - list of steps to execute as part of the workflow jobs. For each project component (or microservice), the following list of actions is executed:<ol> <li>Code checkout, via <code>actions/checkout@v3</code>.</li> <li>Specific tools are installed based on project language (<code>actions/setup-dotnet@v2</code>, <code>actions/setup-go@v3</code>, etc).</li> <li>Unit tests are executed for each project.</li> <li>For deployment tests, the whole suite of microservices is deployed to the DEV environment in a dedicated namespace (unique across PRs) using Tilt. The <a href=https://github.com/digitalocean/kubernetes-sample-apps/tree/master/microservices-demo/tilt-resources/dev>dev</a> profile is being used.</li> <li>Then, load tests are performed via the smoke tests step.</li> <li>Finally, clean up is performed. The microservices setup allocated for the PR is destroyed, including associated Docker images pushed to the registry.</li> </ol> </li> </ul> <p>Following diagram shows the <code>Online Boutique PR CI</code> workflow composition:</p> <pre class=mermaid><code>graph LR
A(PR Workflow Start) --&gt; B(Unit Tests Matrix)
B --&gt; C(Cart Service &lt;br&gt; Tests)
B --&gt; D(Checkout Service &lt;br&gt; Tests)
B --&gt; E(Currency Service &lt;br&gt; Tests)
B --&gt; F(Email Service &lt;br&gt; Tests)
B --&gt; G(Frontend Tests)
B --&gt; H(Payment Service &lt;br&gt; Tests)
B --&gt; I(Product Catalog Service &lt;br&gt; Tests)
B --&gt; J(Recommendation Service &lt;br&gt; Tests)
B --&gt; K(Shipping Service &lt;br&gt; Tests)
C &amp; D &amp; E &amp; F &amp; G &amp; H &amp; I &amp; J &amp; K --&gt; L(Deployment Tests)
L --&gt; M(Env Clean Up)</code></pre> <p>Next, you learn how to configure and enable the main branch workflow that gets triggered whenever changes are pushed to the <code>main</code> branch after each PR merge.</p> <h2 id=configuring-main-branch-workflow>Configuring Main Branch Workflow</h2> <p>Whenever a PR is closed and code is merged into the main branch, a dedicated GitHub workflow is triggered. Main purpose of the main branch workflow is to test the whole application as a whole after merging various features via integration tests. Then, it will build and tag images using latest commit id, push them to registry, and finally deploy everything to the development environment. Usually you want the development environment to continuously reflect the latest changes from the development (or main) branch.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <ul> <li>There's no point to run unit tests again after each PR merge. Unit testing deals with changes for the affected components only. This part it is already taken care in the PR workflow. What makes more sense is to run integration tests as part of the main branch CI flow. This way, you check if application functionality is impacted after merging features in.</li> <li>Adding a <a href=https://docs.github.com/en/actions/monitoring-and-troubleshooting-workflows/adding-a-workflow-status-badge>GitHub badge</a> in the main project README is another great benefit, giving visual feedback for the latest build state - passing or failing.</li> </ul> </div> <p>Follow below steps to configure and enable the main branch workflow provided in this guide:</p> <ol> <li> <p>Clone the <code>microservices-demo</code> repository on your local machine, if not already (make sure to replace the <code>&lt;&gt;</code> placeholders accordingly):</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-6-1 id=__codelineno-6-1 name=__codelineno-6-1></a>git clone https://github.com/&lt;YOUR_GITHUB_ACCOUNT_USERNAME&gt;/microservices-demo.git
</code></pre></div> </li> <li> <p>Change directory to your local copy:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-7-1 id=__codelineno-7-1 name=__codelineno-7-1></a><span class=nb>cd</span> microservices-demo
</code></pre></div> </li> <li> <p>Fetch the CI workflow file from the <a href=https://github.com/digitalocean/kubernetes-sample-apps>kubernetes-sample-apps</a> repo:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-8-1 id=__codelineno-8-1 name=__codelineno-8-1></a>curl https://raw.githubusercontent.com/digitalocean/kubernetes-sample-apps/master/.github/workflows/online-boutique-main-ci.yaml <span class=se>\</span>
<a href=#__codelineno-8-2 id=__codelineno-8-2 name=__codelineno-8-2></a>  -o .github/workflows/online-boutique-main-ci.yaml <span class=se>\</span>
<a href=#__codelineno-8-3 id=__codelineno-8-3 name=__codelineno-8-3></a>  --create-dirs
</code></pre></div> </li> <li> <p>Edit the <code>.github/workflows/online-boutique-main-ci.yaml</code> file using a text editor of your choice, preferably with YAML lint support. For example, you can use <a href=https://code.visualstudio.com/ >VS Code</a>:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-9-1 id=__codelineno-9-1 name=__codelineno-9-1></a>code .github/workflows/online-boutique-main-ci.yaml
</code></pre></div> </li> <li> <p>Uncomment the lines prefixed with a hash mark at the top of the workflow file. The resulting file should look like:</p> <details class=note> <summary>Click to expand the <code>Online Boutique CI Main</code> workflow file</summary> <div class=highlight><pre><span></span><code><a href=#__codelineno-10-1 id=__codelineno-10-1 name=__codelineno-10-1></a><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Online Boutique CI Main</span><span class=w></span>
<a href=#__codelineno-10-2 id=__codelineno-10-2 name=__codelineno-10-2></a>
<a href=#__codelineno-10-3 id=__codelineno-10-3 name=__codelineno-10-3></a><span class=nt>on</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-10-4 id=__codelineno-10-4 name=__codelineno-10-4></a><span class=w>  </span><span class=c1># Used for testing only (can be disabled afterwards)</span><span class=w></span>
<a href=#__codelineno-10-5 id=__codelineno-10-5 name=__codelineno-10-5></a><span class=w>  </span><span class=nt>workflow_dispatch</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-10-6 id=__codelineno-10-6 name=__codelineno-10-6></a><span class=w>  </span><span class=c1># Uncomment below lines to enable this workflow on push to main events</span><span class=w></span>
<a href=#__codelineno-10-7 id=__codelineno-10-7 name=__codelineno-10-7></a><span class=w>  </span><span class=nt>push</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-10-8 id=__codelineno-10-8 name=__codelineno-10-8></a><span class=w>    </span><span class=nt>branches</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-10-9 id=__codelineno-10-9 name=__codelineno-10-9></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">main</span><span class=w></span>
<a href=#__codelineno-10-10 id=__codelineno-10-10 name=__codelineno-10-10></a><span class=w>    </span><span class=nt>paths-ignore</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-10-11 id=__codelineno-10-11 name=__codelineno-10-11></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>"**/README.md"</span><span class=w></span>
<a href=#__codelineno-10-12 id=__codelineno-10-12 name=__codelineno-10-12></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>"kustomize/**"</span><span class=w></span>
<a href=#__codelineno-10-13 id=__codelineno-10-13 name=__codelineno-10-13></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>"argocd/**"</span><span class=w></span>
<a href=#__codelineno-10-14 id=__codelineno-10-14 name=__codelineno-10-14></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>".github/workflows/*"</span><span class=w></span>
<a href=#__codelineno-10-15 id=__codelineno-10-15 name=__codelineno-10-15></a>
<a href=#__codelineno-10-16 id=__codelineno-10-16 name=__codelineno-10-16></a><span class=c1># Do not allow concurrent workflows</span><span class=w></span>
<a href=#__codelineno-10-17 id=__codelineno-10-17 name=__codelineno-10-17></a><span class=c1># Changes should be delivered one a time as code is merged into the main branch</span><span class=w></span>
<a href=#__codelineno-10-18 id=__codelineno-10-18 name=__codelineno-10-18></a><span class=nt>concurrency</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">main-ci-dev</span><span class=w></span>
<a href=#__codelineno-10-19 id=__codelineno-10-19 name=__codelineno-10-19></a>
<a href=#__codelineno-10-20 id=__codelineno-10-20 name=__codelineno-10-20></a><span class=c1># Global environment variables</span><span class=w></span>
<a href=#__codelineno-10-21 id=__codelineno-10-21 name=__codelineno-10-21></a><span class=nt>env</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-10-22 id=__codelineno-10-22 name=__codelineno-10-22></a><span class=w>  </span><span class=nt>CI_COMMIT_AUTHOR</span><span class=p>:</span><span class=w> </span><span class=s>"GitHub</span><span class=nv> </span><span class=s>CI</span><span class=nv> </span><span class=s>Actions"</span><span class=w></span>
<a href=#__codelineno-10-23 id=__codelineno-10-23 name=__codelineno-10-23></a><span class=w>  </span><span class=nt>CI_COMMIT_AUTHOR_EMAIL</span><span class=p>:</span><span class=w> </span><span class=s>"gh-ci-actions@noreply.github.com"</span><span class=w></span>
<a href=#__codelineno-10-24 id=__codelineno-10-24 name=__codelineno-10-24></a><span class=w>  </span><span class=nt>DOCR_ENDPOINT</span><span class=p>:</span><span class=w> </span><span class=s>"registry.digitalocean.com/microservices-demo"</span><span class=w></span>
<a href=#__codelineno-10-25 id=__codelineno-10-25 name=__codelineno-10-25></a><span class=w>  </span><span class=nt>PROJECT_NAME</span><span class=p>:</span><span class=w> </span><span class=s>"online-boutique"</span><span class=w></span>
<a href=#__codelineno-10-26 id=__codelineno-10-26 name=__codelineno-10-26></a>
<a href=#__codelineno-10-27 id=__codelineno-10-27 name=__codelineno-10-27></a><span class=nt>jobs</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-10-28 id=__codelineno-10-28 name=__codelineno-10-28></a><span class=w>  </span><span class=c1># There's no point to run unit tests again after PR merge</span><span class=w></span>
<a href=#__codelineno-10-29 id=__codelineno-10-29 name=__codelineno-10-29></a><span class=w>  </span><span class=c1># Unit testing deals with changes for the affected components,</span><span class=w></span>
<a href=#__codelineno-10-30 id=__codelineno-10-30 name=__codelineno-10-30></a><span class=w>  </span><span class=c1>#   and that it is already taken care in the PR workflow</span><span class=w></span>
<a href=#__codelineno-10-31 id=__codelineno-10-31 name=__codelineno-10-31></a>
<a href=#__codelineno-10-32 id=__codelineno-10-32 name=__codelineno-10-32></a><span class=w>  </span><span class=c1># What it makes sense, is to run integration tests,</span><span class=w></span>
<a href=#__codelineno-10-33 id=__codelineno-10-33 name=__codelineno-10-33></a><span class=w>  </span><span class=c1>#   to see if the whole application is impacted after merging the changes</span><span class=w></span>
<a href=#__codelineno-10-34 id=__codelineno-10-34 name=__codelineno-10-34></a><span class=w>  </span><span class=c1>#</span><span class=w></span>
<a href=#__codelineno-10-35 id=__codelineno-10-35 name=__codelineno-10-35></a><span class=w>  </span><span class=c1># Run deployment tests (integration tests)</span><span class=w></span>
<a href=#__codelineno-10-36 id=__codelineno-10-36 name=__codelineno-10-36></a><span class=w>  </span><span class=c1># Please bear in mind that more tests means increased workflow run time</span><span class=w></span>
<a href=#__codelineno-10-37 id=__codelineno-10-37 name=__codelineno-10-37></a><span class=w>  </span><span class=c1># With workflow concurrency disabled, means more waiting time for other PRs in the queue</span><span class=w></span>
<a href=#__codelineno-10-38 id=__codelineno-10-38 name=__codelineno-10-38></a><span class=w>  </span><span class=nt>deployment-tests</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-10-39 id=__codelineno-10-39 name=__codelineno-10-39></a><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span><span class=w></span>
<a href=#__codelineno-10-40 id=__codelineno-10-40 name=__codelineno-10-40></a><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-10-41 id=__codelineno-10-41 name=__codelineno-10-41></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Checkout code</span><span class=w></span>
<a href=#__codelineno-10-42 id=__codelineno-10-42 name=__codelineno-10-42></a><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span><span class=w></span>
<a href=#__codelineno-10-43 id=__codelineno-10-43 name=__codelineno-10-43></a>
<a href=#__codelineno-10-44 id=__codelineno-10-44 name=__codelineno-10-44></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Run integration tests</span><span class=w></span>
<a href=#__codelineno-10-45 id=__codelineno-10-45 name=__codelineno-10-45></a><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span><span class=w></span>
<a href=#__codelineno-10-46 id=__codelineno-10-46 name=__codelineno-10-46></a><span class=w>          </span><span class=no>echo "[INFO] Not implemented yet!"</span><span class=w></span>
<a href=#__codelineno-10-47 id=__codelineno-10-47 name=__codelineno-10-47></a>
<a href=#__codelineno-10-48 id=__codelineno-10-48 name=__codelineno-10-48></a><span class=w>  </span><span class=c1># Build and push project images in parallel using a matrix strategy</span><span class=w></span>
<a href=#__codelineno-10-49 id=__codelineno-10-49 name=__codelineno-10-49></a><span class=w>  </span><span class=c1># Cuts down build time</span><span class=w></span>
<a href=#__codelineno-10-50 id=__codelineno-10-50 name=__codelineno-10-50></a><span class=w>  </span><span class=nt>build-and-push-images</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-10-51 id=__codelineno-10-51 name=__codelineno-10-51></a><span class=w>    </span><span class=nt>needs</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">deployment-tests</span><span class=w></span>
<a href=#__codelineno-10-52 id=__codelineno-10-52 name=__codelineno-10-52></a><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span><span class=w></span>
<a href=#__codelineno-10-53 id=__codelineno-10-53 name=__codelineno-10-53></a><span class=w>    </span><span class=nt>strategy</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-10-54 id=__codelineno-10-54 name=__codelineno-10-54></a><span class=w>      </span><span class=nt>matrix</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-10-55 id=__codelineno-10-55 name=__codelineno-10-55></a><span class=w>        </span><span class=nt>project</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-10-56 id=__codelineno-10-56 name=__codelineno-10-56></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">cartservice</span><span class=w></span>
<a href=#__codelineno-10-57 id=__codelineno-10-57 name=__codelineno-10-57></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">checkoutservice</span><span class=w></span>
<a href=#__codelineno-10-58 id=__codelineno-10-58 name=__codelineno-10-58></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">currencyservice</span><span class=w></span>
<a href=#__codelineno-10-59 id=__codelineno-10-59 name=__codelineno-10-59></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">emailservice</span><span class=w></span>
<a href=#__codelineno-10-60 id=__codelineno-10-60 name=__codelineno-10-60></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">frontend</span><span class=w></span>
<a href=#__codelineno-10-61 id=__codelineno-10-61 name=__codelineno-10-61></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">paymentservice</span><span class=w></span>
<a href=#__codelineno-10-62 id=__codelineno-10-62 name=__codelineno-10-62></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">productcatalogservice</span><span class=w></span>
<a href=#__codelineno-10-63 id=__codelineno-10-63 name=__codelineno-10-63></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">recommendationservice</span><span class=w></span>
<a href=#__codelineno-10-64 id=__codelineno-10-64 name=__codelineno-10-64></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">shippingservice</span><span class=w></span>
<a href=#__codelineno-10-65 id=__codelineno-10-65 name=__codelineno-10-65></a><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-10-66 id=__codelineno-10-66 name=__codelineno-10-66></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Checkout code</span><span class=w></span>
<a href=#__codelineno-10-67 id=__codelineno-10-67 name=__codelineno-10-67></a><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span><span class=w></span>
<a href=#__codelineno-10-68 id=__codelineno-10-68 name=__codelineno-10-68></a>
<a href=#__codelineno-10-69 id=__codelineno-10-69 name=__codelineno-10-69></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Install doctl</span><span class=w></span>
<a href=#__codelineno-10-70 id=__codelineno-10-70 name=__codelineno-10-70></a><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">digitalocean/action-doctl@v2</span><span class=w></span>
<a href=#__codelineno-10-71 id=__codelineno-10-71 name=__codelineno-10-71></a><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-10-72 id=__codelineno-10-72 name=__codelineno-10-72></a><span class=w>          </span><span class=nt>token</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.DIGITALOCEAN_ACCESS_TOKEN }}</span><span class=w></span>
<a href=#__codelineno-10-73 id=__codelineno-10-73 name=__codelineno-10-73></a>
<a href=#__codelineno-10-74 id=__codelineno-10-74 name=__codelineno-10-74></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Log in to DOCR with short-lived credentials</span><span class=w></span>
<a href=#__codelineno-10-75 id=__codelineno-10-75 name=__codelineno-10-75></a><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">doctl registry login --expiry-seconds 600</span><span class=w></span>
<a href=#__codelineno-10-76 id=__codelineno-10-76 name=__codelineno-10-76></a>
<a href=#__codelineno-10-77 id=__codelineno-10-77 name=__codelineno-10-77></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Build and push image</span><span class=w></span>
<a href=#__codelineno-10-78 id=__codelineno-10-78 name=__codelineno-10-78></a><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">docker/build-push-action@v3</span><span class=w></span>
<a href=#__codelineno-10-79 id=__codelineno-10-79 name=__codelineno-10-79></a><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-10-80 id=__codelineno-10-80 name=__codelineno-10-80></a><span class=w>          </span><span class=c1># cartservice is an exception - Dockerfile is placed in src/cartservice/src subfolder</span><span class=w></span>
<a href=#__codelineno-10-81 id=__codelineno-10-81 name=__codelineno-10-81></a><span class=w>          </span><span class=nt>context</span><span class=p>:</span><span class=w> </span><span class=s>"src/${{</span><span class=nv> </span><span class=s>matrix.project</span><span class=nv> </span><span class=s>}}/${{</span><span class=nv> </span><span class=s>matrix.project</span><span class=nv> </span><span class=s>==</span><span class=nv> </span><span class=s>'cartservice'</span><span class=nv> </span><span class=s>&amp;&amp;</span><span class=nv> </span><span class=s>'src'</span><span class=nv> </span><span class=s>||</span><span class=nv> </span><span class=s>''}}"</span><span class=w></span>
<a href=#__codelineno-10-82 id=__codelineno-10-82 name=__codelineno-10-82></a><span class=w>          </span><span class=nt>push</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class=w></span>
<a href=#__codelineno-10-83 id=__codelineno-10-83 name=__codelineno-10-83></a><span class=w>          </span><span class=nt>tags</span><span class=p>:</span><span class=w> </span><span class=s>"${{</span><span class=nv> </span><span class=s>env.DOCR_ENDPOINT</span><span class=nv> </span><span class=s>}}/${{</span><span class=nv> </span><span class=s>matrix.project</span><span class=nv> </span><span class=s>}}:${{</span><span class=nv> </span><span class=s>github.sha</span><span class=nv> </span><span class=s>}}"</span><span class=w></span>
<a href=#__codelineno-10-84 id=__codelineno-10-84 name=__codelineno-10-84></a>
<a href=#__codelineno-10-85 id=__codelineno-10-85 name=__codelineno-10-85></a><span class=w>  </span><span class=c1># Kustomize image field for each microservice present in the `src/` dir</span><span class=w></span>
<a href=#__codelineno-10-86 id=__codelineno-10-86 name=__codelineno-10-86></a><span class=w>  </span><span class=c1># Finally, commit changes to main branch and let ArgoCD take over afterwards</span><span class=w></span>
<a href=#__codelineno-10-87 id=__codelineno-10-87 name=__codelineno-10-87></a><span class=w>  </span><span class=nt>apply-kustomize-changes</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-10-88 id=__codelineno-10-88 name=__codelineno-10-88></a><span class=w>    </span><span class=nt>needs</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">build-and-push-images</span><span class=w></span>
<a href=#__codelineno-10-89 id=__codelineno-10-89 name=__codelineno-10-89></a><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span><span class=w></span>
<a href=#__codelineno-10-90 id=__codelineno-10-90 name=__codelineno-10-90></a><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-10-91 id=__codelineno-10-91 name=__codelineno-10-91></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Checkout code</span><span class=w></span>
<a href=#__codelineno-10-92 id=__codelineno-10-92 name=__codelineno-10-92></a><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span><span class=w></span>
<a href=#__codelineno-10-93 id=__codelineno-10-93 name=__codelineno-10-93></a>
<a href=#__codelineno-10-94 id=__codelineno-10-94 name=__codelineno-10-94></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Set up K8S tools</span><span class=w></span>
<a href=#__codelineno-10-95 id=__codelineno-10-95 name=__codelineno-10-95></a><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">yokawasa/action-setup-kube-tools@v0.8.2</span><span class=w></span>
<a href=#__codelineno-10-96 id=__codelineno-10-96 name=__codelineno-10-96></a><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-10-97 id=__codelineno-10-97 name=__codelineno-10-97></a><span class=w>          </span><span class=nt>kustomize</span><span class=p>:</span><span class=w> </span><span class=s>"4.5.7"</span><span class=w></span>
<a href=#__codelineno-10-98 id=__codelineno-10-98 name=__codelineno-10-98></a>
<a href=#__codelineno-10-99 id=__codelineno-10-99 name=__codelineno-10-99></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Kustomize dev environment images</span><span class=w></span>
<a href=#__codelineno-10-100 id=__codelineno-10-100 name=__codelineno-10-100></a><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span><span class=w></span>
<a href=#__codelineno-10-101 id=__codelineno-10-101 name=__codelineno-10-101></a><span class=w>          </span><span class=no>for microservice in src/*/; do</span><span class=w></span>
<a href=#__codelineno-10-102 id=__codelineno-10-102 name=__codelineno-10-102></a><span class=w>            </span><span class=no>microservice="$(basename $microservice)"</span><span class=w></span>
<a href=#__codelineno-10-103 id=__codelineno-10-103 name=__codelineno-10-103></a><span class=w>            </span><span class=no>if [[ "$microservice" == "loadgenerator" ]]; then</span><span class=w></span>
<a href=#__codelineno-10-104 id=__codelineno-10-104 name=__codelineno-10-104></a><span class=w>              </span><span class=no>continue</span><span class=w></span>
<a href=#__codelineno-10-105 id=__codelineno-10-105 name=__codelineno-10-105></a><span class=w>            </span><span class=no>fi</span><span class=w></span>
<a href=#__codelineno-10-106 id=__codelineno-10-106 name=__codelineno-10-106></a><span class=w>            </span><span class=no>(</span><span class=w></span>
<a href=#__codelineno-10-107 id=__codelineno-10-107 name=__codelineno-10-107></a><span class=w>              </span><span class=no>cd kustomize/dev</span><span class=w></span>
<a href=#__codelineno-10-108 id=__codelineno-10-108 name=__codelineno-10-108></a><span class=w>              </span><span class=no>kustomize edit set image $microservice=${{ env.DOCR_ENDPOINT }}/${microservice}:${{ github.sha }}</span><span class=w></span>
<a href=#__codelineno-10-109 id=__codelineno-10-109 name=__codelineno-10-109></a><span class=w>            </span><span class=no>)</span><span class=w></span>
<a href=#__codelineno-10-110 id=__codelineno-10-110 name=__codelineno-10-110></a><span class=w>          </span><span class=no>done</span><span class=w></span>
<a href=#__codelineno-10-111 id=__codelineno-10-111 name=__codelineno-10-111></a>
<a href=#__codelineno-10-112 id=__codelineno-10-112 name=__codelineno-10-112></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Commit Kustomize manifests for dev env</span><span class=w></span>
<a href=#__codelineno-10-113 id=__codelineno-10-113 name=__codelineno-10-113></a><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span><span class=w></span>
<a href=#__codelineno-10-114 id=__codelineno-10-114 name=__codelineno-10-114></a><span class=w>          </span><span class=no>git config --global user.name "${{ env.CI_COMMIT_AUTHOR }}"</span><span class=w></span>
<a href=#__codelineno-10-115 id=__codelineno-10-115 name=__codelineno-10-115></a><span class=w>          </span><span class=no>git config --global user.email "${{ env.CI_COMMIT_AUTHOR_EMAIL }}"</span><span class=w></span>
<a href=#__codelineno-10-116 id=__codelineno-10-116 name=__codelineno-10-116></a><span class=w>          </span><span class=no>git add kustomize/dev/</span><span class=w></span>
<a href=#__codelineno-10-117 id=__codelineno-10-117 name=__codelineno-10-117></a><span class=w>          </span><span class=no>git commit -m "[CI] Bump docker images tag to ${{ github.sha }}"</span><span class=w></span>
<a href=#__codelineno-10-118 id=__codelineno-10-118 name=__codelineno-10-118></a>
<a href=#__codelineno-10-119 id=__codelineno-10-119 name=__codelineno-10-119></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Push changes</span><span class=w></span>
<a href=#__codelineno-10-120 id=__codelineno-10-120 name=__codelineno-10-120></a><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ad-m/github-push-action@master</span><span class=w></span>
<a href=#__codelineno-10-121 id=__codelineno-10-121 name=__codelineno-10-121></a><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-10-122 id=__codelineno-10-122 name=__codelineno-10-122></a><span class=w>          </span><span class=nt>github_token</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.GITHUB_TOKEN }}</span><span class=w></span>
</code></pre></div> </details> </li> <li> <p>Save the workflow file, commit, and push changes to your git repository <code>main</code> branch (<strong>you may need to temporarily disable <code>main</code> branch protection first</strong>).</p> <div class="admonition note"> <p class=admonition-title>Note</p> <ul> <li>The <code>deployment-tests</code> job from the <code>Online Boutique CI Main</code> workflow example contains only a placeholder for integration tests. This part is implementation specific, and it is left for the user to configure.</li> <li>Depending on your setup, you may want to adjust the following environment variables at the top of your workflow file: <div class=highlight><pre><span></span><code><a href=#__codelineno-11-1 id=__codelineno-11-1 name=__codelineno-11-1></a><span class=nt>env</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-11-2 id=__codelineno-11-2 name=__codelineno-11-2></a><span class=w>  </span><span class=nt>CI_COMMIT_AUTHOR</span><span class=p>:</span><span class=w> </span><span class=s>"CI</span><span class=nv> </span><span class=s>GitHub</span><span class=nv> </span><span class=s>Actions"</span><span class=w></span>
<a href=#__codelineno-11-3 id=__codelineno-11-3 name=__codelineno-11-3></a><span class=w>  </span><span class=nt>CI_COMMIT_AUTHOR_EMAIL</span><span class=p>:</span><span class=w> </span><span class=s>"gh-actions@noreply.github.com"</span><span class=w></span>
<a href=#__codelineno-11-4 id=__codelineno-11-4 name=__codelineno-11-4></a><span class=w>  </span><span class=nt>DOCR_ENDPOINT</span><span class=p>:</span><span class=w> </span><span class=s>"registry.digitalocean.com/&lt;YOUR_REGISTRY_NAME_HERE&gt;"</span><span class=w></span>
</code></pre></div></li> </ul> </div> </li> </ol> <p>Explanation for the above configuration:</p> <ul> <li><code>on.push</code> - triggers the <code>Online Boutique Main CI</code> workflow on push events only.</li> <li><code>on.push.branches</code> - triggers the <code>Online Boutique Main CI</code> workflow whenever a push event is detected for the specified list of branches. In this case only <code>main</code> branch is desired.</li> <li><code>on.push.paths-ignore</code> - list of repository paths used for filtering. The <code>Online Boutique Main CI</code> workflow is triggered only on paths <strong>not present</strong> in the <code>paths-ignore</code> list. Basically, everything is included (microservices as well), except for Kustomize logic, README files, and workflows logic. Kustomize configuration is dealt in a separate workflow, because it's not related to microservices application logic.</li> <li><code>env</code> - sets environment variables to use for the whole pipeline. Usually, environment variables control workflow logic.</li> <li><code>jobs</code> - defines list of job to run inside the pipeline such as integration tests, build and push docker images, apply Kustomize changes, etc.</li> <li><code>steps</code> - list of steps implementing workflow jobs logic.</li> </ul> <p>Following diagram shows the <code>Online Boutique Main CI</code> workflow composition:</p> <pre class=mermaid><code>graph TD
A(Main Branch Workflow Start) --&gt; B(Deployment Tests)
B --&gt; C{Tests Passing?}
C -- No --&gt; D(Reject build)
C -- Yes --&gt; E(Build and Push Images)
E --&gt; F(Kustomize Dev Env Images Tag)
F --&gt; G(Commit Kustomize Changes)
G -. Trigger .-&gt; H(Argo CD Dev Env Sync)
style H stroke-dasharray: 5 5</code></pre> <div class="admonition note"> <p class=admonition-title>Note</p> <p>The final step from above flow chart - <code>Argo CD Dev Env Sync</code> is discussed and implemented in the next chapter - <a href=../setup-continuous-deployments/ >Continous Deployments</a>.</p> </div> <p>Next, you learn how to configure and enable the Kustomize manifests validation workflow that gets triggered whenever changes are requested via pull requests affecting the <code>kustomize/**</code> path in your GitHub repository.</p> <h2 id=infrastructure-manifests-validation-github-workflow>Infrastructure Manifests Validation GitHub Workflow</h2> <p>So far you created CI workflows for main application code verification. What about Kubernetes manifests or infrastructure configuration files validation? This guide is using a monorepo structure, hence infrastructure configuration files live in the same repository as application code.</p> <p>This part is handled via a separate GitHub workflow called <code>Online Boutique PR Kustomize Validation</code>. Main role is to perform static checks (or linting) for all Kustomize manifests used in each overlay. It represents an additional step to validate or invalidate pull requests handling infra changes for each environment via Kustomize.</p> <p>Following diagram shows the <code>Online Boutique PR Kustomize Validation</code> workflow logic:</p> <pre class=mermaid><code>graph TD
A(New Kustomize PR) --&gt; B(Run Validation Tests)
B --&gt; C{Tests Passing?}
C -- No --&gt; D(Reject PR)
C -- Yes --&gt; E{PR Review Passed?}
E -- No --&gt; D
E -- Yes ---&gt; F(Merge PR)</code></pre> <p>Follow below steps to enable the Kustomize checks workflow for PRs:</p> <ol> <li> <p>Clone the <code>microservices-demo</code> repository on your local machine, if not already (make sure to replace the <code>&lt;&gt;</code> placeholders accordingly):</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-12-1 id=__codelineno-12-1 name=__codelineno-12-1></a>git clone https://github.com/&lt;YOUR_GITHUB_ACCOUNT_USERNAME&gt;/microservices-demo.git
</code></pre></div> </li> <li> <p>Change directory to your local copy:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-13-1 id=__codelineno-13-1 name=__codelineno-13-1></a><span class=nb>cd</span> microservices-demo
</code></pre></div> </li> <li> <p>Fetch the <code>online-boutique-pr-kustomize-validation.yaml</code> workflow file from the <a href=https://github.com/digitalocean/kubernetes-sample-apps>kubernetes-sample-apps</a> repo:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-14-1 id=__codelineno-14-1 name=__codelineno-14-1></a>curl https://raw.githubusercontent.com/digitalocean/kubernetes-sample-apps/master/.github/workflows/online-boutique-pr-kustomize-validation.yaml <span class=se>\</span>
<a href=#__codelineno-14-2 id=__codelineno-14-2 name=__codelineno-14-2></a>  -o .github/workflows/online-boutique-pr-kustomize-validation.yaml <span class=se>\</span>
<a href=#__codelineno-14-3 id=__codelineno-14-3 name=__codelineno-14-3></a>  --create-dirs
</code></pre></div> </li> <li> <p>Edit the <code>.github/workflows/online-boutique-pr-kustomize-validation.yaml</code> file using a text editor of your choice, preferably with YAML lint support. For example, you can use <a href=https://code.visualstudio.com/ >VS Code</a>:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-15-1 id=__codelineno-15-1 name=__codelineno-15-1></a>code .github/workflows/online-boutique-pr-kustomize-validation.yaml
</code></pre></div> </li> <li> <p>Uncomment the lines prefixed with a hash mark at the top of the workflow file. The resulting file should look like:</p> <details class=note> <summary>Click to expand the <code>Online Boutique PR Kustomize Validation</code> workflow file</summary> <div class=highlight><pre><span></span><code><a href=#__codelineno-16-1 id=__codelineno-16-1 name=__codelineno-16-1></a><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Online Boutique PR Kustomize Validation</span><span class=w></span>
<a href=#__codelineno-16-2 id=__codelineno-16-2 name=__codelineno-16-2></a>
<a href=#__codelineno-16-3 id=__codelineno-16-3 name=__codelineno-16-3></a><span class=nt>on</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-16-4 id=__codelineno-16-4 name=__codelineno-16-4></a><span class=w>  </span><span class=nt>workflow_dispatch</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-16-5 id=__codelineno-16-5 name=__codelineno-16-5></a><span class=w>  </span><span class=nt>pull_request</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-16-6 id=__codelineno-16-6 name=__codelineno-16-6></a><span class=w>    </span><span class=nt>branches</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-16-7 id=__codelineno-16-7 name=__codelineno-16-7></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">main</span><span class=w></span>
<a href=#__codelineno-16-8 id=__codelineno-16-8 name=__codelineno-16-8></a><span class=w>    </span><span class=nt>paths</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-16-9 id=__codelineno-16-9 name=__codelineno-16-9></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>"kustomize/**"</span><span class=w></span>
<a href=#__codelineno-16-10 id=__codelineno-16-10 name=__codelineno-16-10></a>
<a href=#__codelineno-16-11 id=__codelineno-16-11 name=__codelineno-16-11></a><span class=nt>env</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-16-12 id=__codelineno-16-12 name=__codelineno-16-12></a><span class=w>  </span><span class=nt>KUBECONFORM_VERSION</span><span class=p>:</span><span class=w> </span><span class=s>"0.5.0"</span><span class=w></span>
<a href=#__codelineno-16-13 id=__codelineno-16-13 name=__codelineno-16-13></a><span class=w>  </span><span class=nt>KUBERNETES_VERSION</span><span class=p>:</span><span class=w> </span><span class=s>"1.24.4"</span><span class=w></span>
<a href=#__codelineno-16-14 id=__codelineno-16-14 name=__codelineno-16-14></a>
<a href=#__codelineno-16-15 id=__codelineno-16-15 name=__codelineno-16-15></a><span class=nt>jobs</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-16-16 id=__codelineno-16-16 name=__codelineno-16-16></a><span class=w>  </span><span class=nt>job</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-16-17 id=__codelineno-16-17 name=__codelineno-16-17></a><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span><span class=w></span>
<a href=#__codelineno-16-18 id=__codelineno-16-18 name=__codelineno-16-18></a><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-16-19 id=__codelineno-16-19 name=__codelineno-16-19></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Checkout code</span><span class=w></span>
<a href=#__codelineno-16-20 id=__codelineno-16-20 name=__codelineno-16-20></a><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span><span class=w></span>
<a href=#__codelineno-16-21 id=__codelineno-16-21 name=__codelineno-16-21></a>
<a href=#__codelineno-16-22 id=__codelineno-16-22 name=__codelineno-16-22></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Set up kubeconform</span><span class=w></span>
<a href=#__codelineno-16-23 id=__codelineno-16-23 name=__codelineno-16-23></a><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span><span class=w></span>
<a href=#__codelineno-16-24 id=__codelineno-16-24 name=__codelineno-16-24></a><span class=w>          </span><span class=no>(</span><span class=w></span>
<a href=#__codelineno-16-25 id=__codelineno-16-25 name=__codelineno-16-25></a><span class=w>            </span><span class=no>cd /tmp</span><span class=w></span>
<a href=#__codelineno-16-26 id=__codelineno-16-26 name=__codelineno-16-26></a><span class=w>            </span><span class=no>wget "https://github.com/yannh/kubeconform/releases/download/v${{ env.KUBECONFORM_VERSION }}/kubeconform-linux-amd64.tar.gz"</span><span class=w></span>
<a href=#__codelineno-16-27 id=__codelineno-16-27 name=__codelineno-16-27></a><span class=w>            </span><span class=no>tar xvf kubeconform-linux-amd64.tar.gz</span><span class=w></span>
<a href=#__codelineno-16-28 id=__codelineno-16-28 name=__codelineno-16-28></a><span class=w>            </span><span class=no>chmod u+x ./kubeconform</span><span class=w></span>
<a href=#__codelineno-16-29 id=__codelineno-16-29 name=__codelineno-16-29></a><span class=w>          </span><span class=no>)</span><span class=w></span>
<a href=#__codelineno-16-30 id=__codelineno-16-30 name=__codelineno-16-30></a>
<a href=#__codelineno-16-31 id=__codelineno-16-31 name=__codelineno-16-31></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Kustomize linting using kubeconform</span><span class=w></span>
<a href=#__codelineno-16-32 id=__codelineno-16-32 name=__codelineno-16-32></a><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span><span class=w></span>
<a href=#__codelineno-16-33 id=__codelineno-16-33 name=__codelineno-16-33></a><span class=w>          </span><span class=no># Test each overlay using kubeconform</span><span class=w></span>
<a href=#__codelineno-16-34 id=__codelineno-16-34 name=__codelineno-16-34></a><span class=w>          </span><span class=no>for kustomize_overlay in kustomize/*/; do</span><span class=w></span>
<a href=#__codelineno-16-35 id=__codelineno-16-35 name=__codelineno-16-35></a><span class=w>            </span><span class=no>kustomize build "$kustomize_overlay" | \</span><span class=w></span>
<a href=#__codelineno-16-36 id=__codelineno-16-36 name=__codelineno-16-36></a><span class=w>              </span><span class=no>/tmp/kubeconform -kubernetes-version "${{env.KUBERNETES_VERSION}}" -summary -verbose</span><span class=w></span>
<a href=#__codelineno-16-37 id=__codelineno-16-37 name=__codelineno-16-37></a><span class=w>          </span><span class=no>done</span><span class=w></span>
</code></pre></div> </details> </li> <li> <p>Save the workflow file, commit, and push changes to your git repository <code>main</code> branch (<strong>you may need to temporarily disable <code>main</code> branch protection first</strong>).</p> <div class="admonition note"> <p class=admonition-title>Note</p> </div> <p>Depending on your setup, you may want to adjust the following environment variable at the top of your workflow file: <div class=highlight><pre><span></span><code><a href=#__codelineno-17-1 id=__codelineno-17-1 name=__codelineno-17-1></a><span class=nt>env</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-17-2 id=__codelineno-17-2 name=__codelineno-17-2></a><span class=w>  </span><span class=nt>KUBERNETES_VERSION</span><span class=p>:</span><span class=w> </span><span class=s>"1.24.4"</span><span class=w></span>
</code></pre></div></p> </li> </ol> <p>Above workflow will validate each Kubernetes manifest using <a href=https://github.com/yannh/kubeconform/ >Kubeconform</a> after rendering via Kustomize. Kubeconform is a tool for validating Kubernetes YAML files using the OpenAPI specifications.</p> <p>Next, you will test each workflow to check if it meets the required functionality.</p> <h2 id=testing-the-online-boutique-application-github-workflows>Testing the Online Boutique Application GitHub Workflows</h2> <p>In this section you will test each workflow functionality for each event - pull requests and main branch code merge.</p> <h3 id=testing-the-pull-requests-workflow>Testing the Pull Requests Workflow</h3> <p>Follow below steps to test the PR workflow for the online boutique application:</p> <ol> <li> <p>Clone the <code>microservices-demo</code> repository on your local machine, if not already (make sure to replace the <code>&lt;&gt;</code> placeholders accordingly):</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-18-1 id=__codelineno-18-1 name=__codelineno-18-1></a>git clone https://github.com/&lt;YOUR_GITHUB_ACCOUNT_USERNAME&gt;/microservices-demo.git
</code></pre></div> </li> <li> <p>Change directory to your local copy:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-19-1 id=__codelineno-19-1 name=__codelineno-19-1></a><span class=nb>cd</span> microservices-demo
</code></pre></div> </li> <li> <p>Checkout to a new branch to add a new feature:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-20-1 id=__codelineno-20-1 name=__codelineno-20-1></a>git checkout -b features/musical_instruments
</code></pre></div> </li> <li> <p>Open the header template file for the frontend microservice using a text editor of your choice, preferably with HTML lint support. For example, you can use <a href=https://code.visualstudio.com/ >VS Code</a>:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-21-1 id=__codelineno-21-1 name=__codelineno-21-1></a>code src/frontend/templates/header.html
</code></pre></div> </li> <li> <p>Change the <code>Cymbal Shops</code> string from title section to something different (e.g. <code>Musical Instruments</code>):</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-22-1 id=__codelineno-22-1 name=__codelineno-22-1></a><span class=p>&lt;</span><span class=nt>title</span><span class=p>&gt;</span>
<a href=#__codelineno-22-2 id=__codelineno-22-2 name=__codelineno-22-2></a>    {{ if $.is_cymbal_brand }}
<a href=#__codelineno-22-3 id=__codelineno-22-3 name=__codelineno-22-3></a>    Musical Instruments
<a href=#__codelineno-22-4 id=__codelineno-22-4 name=__codelineno-22-4></a>    {{ else }}
<a href=#__codelineno-22-5 id=__codelineno-22-5 name=__codelineno-22-5></a>    Online Boutique
<a href=#__codelineno-22-6 id=__codelineno-22-6 name=__codelineno-22-6></a>    {{ end }}
<a href=#__codelineno-22-7 id=__codelineno-22-7 name=__codelineno-22-7></a><span class=p>&lt;/</span><span class=nt>title</span><span class=p>&gt;</span>
</code></pre></div> <div class="admonition tip"> <p class=admonition-title>Tip</p> <p>You can quickly spin up a local environment using Tilt to test the changes first, as explained in the <a href=../../02-development/tilt-local/ >local development using Tilt</a> section. You will get live updates for each change which helps in the iterative development process.</p> </div> </li> <li> <p>Save changes, commit and push new branch to remote:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-23-1 id=__codelineno-23-1 name=__codelineno-23-1></a>git commit -am <span class=s2>"New feature - musical instruments."</span>
<a href=#__codelineno-23-2 id=__codelineno-23-2 name=__codelineno-23-2></a>git push origin features/musical_instruments
</code></pre></div> </li> <li> <p>Navigate to your GitHub repository page, and open a new pull request against main branch using the <code>features/musical_instruments</code> branch as the base.</p> </li> </ol> <p>At this point, the <code>Online Boutique PR CI</code> should kick in. Branch merging should be blocked until the workflow finishes successfully, and at least one approval is present (explained in the <a href=#prerequisites>prerequisites</a> section):</p> <p><a class=glightbox data-desc-position=bottom data-description data-height=auto data-title data-width=100% href=../assets/images/ci/pr_ci_wf.png><img alt="PR CI Workflow" src=../assets/images/ci/pr_ci_wf.png></a></p> <p>Next, navigate to the <code>Actions</code> tab of your GitHub repository and inspect PR workflow progress:</p> <p><a class=glightbox data-desc-position=bottom data-description data-height=auto data-title data-width=100% href=../assets/images/ci/pr_wf_progress.png><img alt="PR Workflow Progress" src=../assets/images/ci/pr_wf_progress.png></a></p> <p>If everything goes as planned, the workflow should pass and the PR can be merged. This is the happy flow. You should also check what happens if introducing a change that breaks things - change one of the unit tests so that it doesn't compile successfully.</p> <p>Next, you will check the main branch workflow and see if applies required kustomize changes for the development environment.</p> <h3 id=testing-the-main-branch-workflow>Testing the Main Branch Workflow</h3> <p>The second workflow should automatically start after merging code into main branch via the pull request created in the previous step. Navigate to the actions tab of your GitHub repository to see it in action:</p> <p><a class=glightbox data-desc-position=bottom data-description data-height=auto data-title data-width=100% href=../assets/images/ci/ci_main_wf_progress.png><img alt="Main Branch Workflow Progress" src=../assets/images/ci/ci_main_wf_progress.png></a></p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Automated deployments to the development environment cluster are disabled for now until configuring continuous deployments via ArgoCD in the next chapter. So, nothing gets deployed yet to the dev environment.</p> </div> <p>You should also see a new commit added in the Git history of your repo. It shows kustomize changes for each image that was built and tagged using latest PR merge commit id:</p> <p><a class=glightbox data-desc-position=bottom data-description data-height=auto data-title data-width=100% href=../assets/images/ci/kustomize_apply_img_changes.png><img alt="Main Branch Workflow Kustomize Changes" src=../assets/images/ci/kustomize_apply_img_changes.png></a></p> <h3 id=testing-the-infra-manifests-github-workflow>Testing the Infra Manifests GitHub Workflow</h3> <p>This goes the same way as with the previous workflows testing, the only thing that's different is that it triggers only for changes present in the <code>kustomize/</code> folder from your GitHub repository. You should be able to test it quickly by changing something in one of the Kustomize overlays of the online boutique project, and then create a new PR. Wait for the validation workflow to star, and check the progress. If everything goes well you should be able to merge the new PR.</p> <div class="admonition tip"> <p class=admonition-title>Tip</p> <p>You should also test what happens if you introduce changes breaking Kustomize functionality, such as a misspelled key name in one of the YAML manifests from the <code>kustomize/</code> folder. The validation workflow should fail, and the associated PR rejected.</p> </div> <h2 id=additional-best-practices>Additional Best Practices</h2> <p>Going further, you should be able to enhance the CI process even more by following some additional best practices, such as:</p> <ol> <li>Run tests only for affected microservices. Should improve workflow run time even more.</li> <li>Strategy matrix used to speed up actions inside the workflow such as running unit tests and building docker images is static. It is possible to create a strategy matrix with dynamic values. For example, the <code>tilt_config.json</code> file from the dev profile already contains the list of project microservices, so the matrix can read the values directly from the list.</li> <li>Use <a href=https://docs.github.com/en/actions/using-workflows/caching-dependencies-to-speed-up-workflows>artifacts caching</a> inside workflows whenever possible.</li> <li>Decouple application code and Kubernetes configuration by using a dedicated Git repository. Application code should not be dependent on Kubernetes configuration, hence it make sense to stay in a different repository. Also, whenever changes are required on the Kubernetes side, you don't need to open PRs and merge Kubernetes specific commits into the application repository.</li> </ol> <p>Next, ArgoCD should pickup the changes and deploy the application automatically to your development environment DOKS cluster. In order for this part to work you need to set it up in the following section.</p> </article> </div> </div> </main> <footer class=md-footer> <nav aria-label=Footer class="md-footer__inner md-grid"> <a aria-label="Previous: Observability" class="md-footer__link md-footer__link--prev" href=../../04-production/observability-production/ rel=prev> <div class="md-footer__button md-icon"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Observability </div> </div> </a> <a aria-label="Next: Set up continuous deployments" class="md-footer__link md-footer__link--next" href=../setup-continuous-deployments/ rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Set up continuous deployments </div> </div> <div class="md-footer__button md-icon"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"></path></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> DigitalOcean </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ rel=noopener target=_blank> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script> <script src=../../assets/javascripts/bundle.d6c3db9e.min.js></script> <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom"});})</script></body> </html>